{"ast":null,"code":"import React,{useState,useRef}from'react';import{Button}from'./ui/button';import{Card}from'./ui/card';import{Upload,Download,Trash2,Eye,X,AlertCircle}from'lucide-react';import{Dialog,DialogContent,DialogHeader,DialogTitle}from'./ui/dialog';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";export function FileUpload(_ref){let{attachments=[],// Default to empty array\nonAttachmentsChange,currentUser='Unknown User',// Default value\nmaxFileSize=5,allowedTypes=['image/*','application/pdf','.doc','.docx','.xls','.xlsx','.txt'],disabled=false,onUpload}=_ref;const fileInputRef=useRef(null);const[uploading,setUploading]=useState(false);const[error,setError]=useState(null);const[previewFile,setPreviewFile]=useState(null);// Ensure attachments is always an array\nconst safeAttachments=Array.isArray(attachments)?attachments:[];const formatFileSize=bytes=>{if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i];};const getFileIcon=type=>{if(type.startsWith('image/'))return'ðŸ–¼ï¸';if(type==='application/pdf')return'ðŸ“„';if(type.includes('word')||type.includes('doc'))return'ðŸ“';if(type.includes('sheet')||type.includes('excel'))return'ðŸ“Š';if(type.includes('text'))return'ðŸ“„';return'ðŸ“';};const handleFileSelect=async event=>{const files=event.target.files;if(!files||files.length===0)return;setError(null);setUploading(true);try{const newAttachments=[];for(let i=0;i<files.length;i++){const file=files[i];// Validate file size\nif(file.size>maxFileSize*1024*1024){setError(\"File \\\"\".concat(file.name,\"\\\" is too large. Maximum size is \").concat(maxFileSize,\"MB.\"));continue;}// Validate file type\nconst isValidType=allowedTypes.some(type=>{if(type.includes('*')){return file.type.startsWith(type.replace('*',''));}return file.type===type||file.name.toLowerCase().endsWith(type);});if(!isValidType){setError(\"File \\\"\".concat(file.name,\"\\\" is not a supported file type.\"));continue;}// Convert file to base64\nconst base64Data=await new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=()=>resolve(reader.result);reader.onerror=reject;reader.readAsDataURL(file);});const attachment={id:\"file_\".concat(Date.now(),\"_\").concat(i),name:file.name,size:file.size,type:file.type,data:base64Data,uploadedAt:new Date().toISOString(),uploadedBy:currentUser};newAttachments.push(attachment);}if(newAttachments.length>0){// Use onUpload callback if provided, otherwise use onAttachmentsChange\nif(onUpload){onUpload(newAttachments);}else{onAttachmentsChange([...safeAttachments,...newAttachments]);}}}catch(err){setError('Failed to upload files. Please try again.');console.error('File upload error:',err);}finally{setUploading(false);if(fileInputRef.current){fileInputRef.current.value='';}}};const handleDownload=attachment=>{try{const link=document.createElement('a');link.href=attachment.data;link.download=attachment.name;document.body.appendChild(link);link.click();document.body.removeChild(link);}catch(error){console.error('Download error:',error);setError('Failed to download file.');}};const handleDelete=attachmentId=>{try{const updatedAttachments=safeAttachments.filter(att=>att.id!==attachmentId);onAttachmentsChange(updatedAttachments);}catch(error){console.error('Delete error:',error);setError('Failed to delete file.');}};const handlePreview=attachment=>{setPreviewFile(attachment);};const canPreview=type=>{return type.startsWith('image/')||type==='application/pdf'||type.startsWith('text/');};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",multiple:true,accept:allowedTypes.join(','),onChange:handleFileSelect,className:\"hidden\",disabled:disabled}),/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},disabled:uploading||disabled,className:\"w-full\",children:uploading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mr-2\"}),\"Uploading...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Upload,{className:\"w-4 h-4 mr-2\"}),\"Upload Files\"]})}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-2 bg-red-50 border border-red-200 rounded-md flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-red-700\",children:error}),/*#__PURE__*/_jsx(Button,{variant:\"ghost\",size:\"sm\",onClick:()=>setError(null),className:\"ml-auto p-1 h-auto\",children:/*#__PURE__*/_jsx(X,{className:\"w-3 h-3\"})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Maximum file size: \",maxFileSize,\"MB. Supported formats: Images, PDF, Documents, Spreadsheets\"]})]}),safeAttachments&&safeAttachments.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium text-gray-900\",children:[\"Attached Files (\",safeAttachments.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:safeAttachments.map(attachment=>/*#__PURE__*/_jsx(Card,{className:\"p-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-lg\",children:getFileIcon(attachment.type)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900 truncate\",children:attachment.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 text-xs text-gray-500\",children:[/*#__PURE__*/_jsx(\"span\",{children:formatFileSize(attachment.size)}),/*#__PURE__*/_jsxs(\"span\",{children:[\"by \",attachment.uploadedBy]}),/*#__PURE__*/_jsx(\"span\",{children:new Date(attachment.uploadedAt).toLocaleDateString()})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[canPreview(attachment.type)&&/*#__PURE__*/_jsx(Button,{variant:\"ghost\",size:\"sm\",onClick:()=>handlePreview(attachment),className:\"p-2\",children:/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(Button,{variant:\"ghost\",size:\"sm\",onClick:()=>handleDownload(attachment),className:\"p-2\",children:/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4\"})}),!disabled&&/*#__PURE__*/_jsx(Button,{variant:\"ghost\",size:\"sm\",onClick:()=>handleDelete(attachment.id),className:\"p-2 text-red-600 hover:text-red-700\",children:/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"})})]})]})},attachment.id))})]}),previewFile&&/*#__PURE__*/_jsx(Dialog,{open:!!previewFile,onOpenChange:()=>setPreviewFile(null),children:/*#__PURE__*/_jsxs(DialogContent,{className:\"max-w-4xl max-h-[80vh]\",children:[/*#__PURE__*/_jsx(DialogHeader,{children:/*#__PURE__*/_jsx(DialogTitle,{children:previewFile.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"overflow-auto\",children:[previewFile.type.startsWith('image/')&&/*#__PURE__*/_jsx(\"img\",{src:previewFile.data,alt:previewFile.name,className:\"max-w-full h-auto\"}),previewFile.type==='application/pdf'&&/*#__PURE__*/_jsx(\"iframe\",{src:previewFile.data,className:\"w-full h-96\",title:previewFile.name}),previewFile.type.startsWith('text/')&&/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:/*#__PURE__*/_jsx(\"pre\",{className:\"whitespace-pre-wrap text-sm\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Text file preview not available. Please download to view.\"})})})]})]})})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}