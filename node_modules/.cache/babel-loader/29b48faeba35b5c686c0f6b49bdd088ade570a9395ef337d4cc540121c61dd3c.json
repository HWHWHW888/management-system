{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Button}from'./ui/button';import{Input}from'./ui/input';import{Textarea}from'./ui/textarea';import{Label}from'./ui/label';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Dialog,DialogContent,DialogDescription,DialogHeader,DialogTitle,DialogTrigger}from'./ui/dialog';import{AlertDialog,AlertDialogAction,AlertDialogCancel,AlertDialogContent,AlertDialogDescription,AlertDialogFooter,AlertDialogHeader,AlertDialogTitle,AlertDialogTrigger}from'./ui/alert-dialog';import{Select,SelectContent,SelectItem,SelectTrigger,SelectValue}from'./ui/select';import{Badge}from'./ui/badge';import{Tabs,TabsContent,TabsList,TabsTrigger}from'./ui/tabs';import{Collapsible,CollapsibleContent,CollapsibleTrigger}from'./ui/collapsible';import{FileUpload}from'./FileUpload';import{withErrorHandler}from'./withErrorHandler';import{PhotoDisplay}from'./common/PhotoDisplay';import{isReadOnlyRole,canViewFinancialData}from'../utils/permissions';import{db}from'../utils/supabase/supabaseClients';import{apiClient}from'../utils/api/apiClient';import{Plus,Edit,Mail,DollarSign,TrendingUp,TrendingDown,Paperclip,MapPin,Target,ChevronDown,ChevronUp,User as UserIcon,UserCheck,Eye,IdCard,Heart,FileText,ArrowUpCircle,ArrowDownCircle,Receipt,Wallet,Save,Activity,CheckCircle}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function CustomerManagementComponent(_ref){var _details24,_details24$passport_p,_details25,_details25$passport_p,_details26;let{user,showError,clearError}=_ref;const isReadOnly=isReadOnlyRole(user.role);const canSeeFinancials=canViewFinancialData(user.role);const[customers,setCustomers]=useState([]);const[agents,setAgents]=useState([]);const[trips,setTrips]=useState([]);const[rollingRecords,setRollingRecords]=useState([]);const[buyInOutRecords,setBuyInOutRecords]=useState([]);const[isDialogOpen,setIsDialogOpen]=useState(false);const[isDetailDialogOpen,setIsDetailDialogOpen]=useState(false);const[editingCustomer,setEditingCustomer]=useState(null);const[selectedCustomer,setSelectedCustomer]=useState(null);const[expandedCustomer,setExpandedCustomer]=useState(null);const[deletingCustomer,setDeletingCustomer]=useState(null);const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[imagePreview,setImagePreview]=useState({isOpen:false,src:'',title:''});// Basic customer form data\nconst[formData,setFormData]=useState({name:'',email:'',phone:'',agentId:'',vip_level:'silver',status:'active'});// Extended customer details form data (only non-basic fields)\nconst[detailFormData,setDetailFormData]=useState({// Identity & Personal\npassportNumber:'',passportFile:null,idNumber:'',nationality:'',dateOfBirth:'',address:'',occupation:'',// Preferences & Lifestyle\nhobby:'',gamingPreferences:'',emergencyContact:'',emergencyPhone:'',// Additional Details\nmaritalStatus:'',educationLevel:'',incomeRange:'',preferredLanguage:'English',notes:'',specialRequirements:''});// Load real-time data from Supabase\nconst loadRealTimeData=useCallback(async()=>{try{clearError();console.log('🔄 Loading real-time customer data from Supabase...');// Load all required data from Supabase in parallel\nconst[customersData,agentsData,tripsData,rollingData,buyInOutData]=await Promise.all([db.get('customers',[]),db.get('agents',[]),db.get('trips',[]),db.get('rollingRecords',[]),db.get('buyInOutRecords',[])]);// Load customer details for all customers\nconst customerDetailsPromises=customersData.map(async customer=>{try{const detailsResponse=await apiClient.getCustomerDetails(customer.id);return{customerId:customer.id,details:detailsResponse.success?detailsResponse.data:null};}catch(error){console.log(\"No details found for customer \".concat(customer.id));return{customerId:customer.id,details:null};}});const customerDetailsResults=await Promise.all(customerDetailsPromises);const customerDetailsMap=new Map();customerDetailsResults.forEach(result=>{if(result.details){customerDetailsMap.set(result.customerId,result.details);}});console.log('🔍 Customer details loaded:',customerDetailsResults.length,'customers');console.log('🔍 Customer details map size:',customerDetailsMap.size);if(customerDetailsMap.size>0){console.log('🔍 Sample customer details:',Array.from(customerDetailsMap.entries())[0]);}// Process customers using database totals directly (no manual calculations)\nconst processedCustomers=customersData.map(customer=>{// Get customer details from the map\nconst customerDetails=customerDetailsMap.get(customer.id);// Debug log for each customer's database totals\nconsole.log(\"\\uD83D\\uDD0D Customer \".concat(customer.name,\" database totals:\"),{total_rolling:customer.total_rolling,total_win_loss:customer.total_win_loss,total_buy_in:customer.total_buy_in,total_buy_out:customer.total_buy_out});return _objectSpread(_objectSpread({},customer),{},{// Use database totals directly - these are kept up-to-date by the backend\ntotalRolling:parseFloat(String(customer.total_rolling||0))||0,totalWinLoss:parseFloat(String(customer.total_win_loss||0))||0,totalBuyIn:parseFloat(String(customer.total_buy_in||0))||0,totalBuyOut:parseFloat(String(customer.total_buy_out||0))||0,// Customer details merged into customer object\ndetails:customerDetails,// Get attachments from customer details instead of customer table\nattachments:(customerDetails===null||customerDetails===void 0?void 0:customerDetails.attachments)||[],// Backward compatibility\nisAgent:customer.isAgent||false,sourceAgentId:customer.sourceAgentId||undefined,rollingPercentage:parseFloat(String(customer.rolling_percentage||1.4))||1.4,creditLimit:parseFloat(String(customer.credit_limit||0))||0,availableCredit:parseFloat(String(customer.available_credit||0))||0});});// Process trips with real-time win/loss calculations\nconst processedTrips=tripsData.map(trip=>{var _trip$customers;return _objectSpread(_objectSpread({},trip),{},{calculatedTotalRolling:(trip.totalRolling||0)*0.014,attachments:trip.attachments||[],customers:((_trip$customers=trip.customers)===null||_trip$customers===void 0?void 0:_trip$customers.map(customer=>{// Calculate real-time win/loss for this customer in this trip\nconst tripRollingRecords=rollingData.filter(record=>record.customerId===customer.customerId&&record.recordedAt>=trip.date);const realTimeTripWinLoss=tripRollingRecords.reduce((sum,record)=>sum+(record.winLoss||0),0);return _objectSpread(_objectSpread({},customer),{},{// Update win/loss with real-time data\nwinLoss:realTimeTripWinLoss,rollingPercentage:customer.rollingPercentage||1.4,calculatedRollingAmount:customer.calculatedRollingAmount||(customer.rollingAmount||0)*0.014});}))||[]});});setCustomers(processedCustomers);setAgents(agentsData);setTrips(processedTrips);setRollingRecords(rollingData);setBuyInOutRecords(buyInOutData);console.log(\"\\u2705 Loaded real-time data: \".concat(processedCustomers.length,\" customers, \").concat(agentsData.length,\" agents, \").concat(processedTrips.length,\" trips, \").concat(rollingData.length,\" rolling records\"));}catch(error){console.error('❌ Error loading real-time customer data:',error);showError(\"Failed to load customer data: \".concat(error instanceof Error?error.message:'Unknown error occurred'));}finally{setLoading(false);}},[clearError,showError]);// Load data on component mount\nuseEffect(()=>{loadRealTimeData();},[loadRealTimeData]);// Filter customers based on user role\nconst getFilteredCustomers=()=>{if(user.role==='agent'&&user.agentId){return customers.filter(customer=>customer.agentId===user.agentId);}return customers;};const filteredCustomers=getFilteredCustomers();const getCustomerTripHistory=customerId=>{const customerTrips=[];trips.forEach(trip=>{var _trip$customers2;const customerInTrip=(_trip$customers2=trip.customers)===null||_trip$customers2===void 0?void 0:_trip$customers2.find(tc=>tc.customerId===customerId);if(customerInTrip){customerTrips.push({tripId:trip.id,tripName:trip.name,tripDate:trip.date,tripStatus:trip.status,agentName:trip.agentName||'Unknown Agent',customerData:customerInTrip});}});// Sort by date (most recent first)\nreturn customerTrips.sort((a,b)=>new Date(b.tripDate||'').getTime()-new Date(a.tripDate||'').getTime());};// Get customer rolling records for detailed view\nconst getCustomerRollingRecords=customerId=>{return rollingRecords.filter(record=>record.customerId===customerId).sort((a,b)=>new Date(b.recordedAt).getTime()-new Date(a.recordedAt).getTime());};// Get customer buy-in/buy-out records\nconst getCustomerBuyInOutRecords=customerId=>{return buyInOutRecords.filter(record=>record.customerId===customerId).sort((a,b)=>new Date(b.timestamp).getTime()-new Date(a.timestamp).getTime());};const handleSubmit=async e=>{e.preventDefault();try{const selectedAgent=agents.find(agent=>agent.id===formData.agentId);if(!selectedAgent){showError('Please select a valid agent');return;}if(editingCustomer){// Update existing customer - only send allowed fields to backend\nconst updateData={name:formData.name,email:formData.email,phone:formData.phone||null,vip_level:formData.vip_level||'Silver',status:formData.status||'active'};const response=await apiClient.updateCustomer(editingCustomer.id,updateData);if(!response.success){throw new Error(response.error||'Failed to update customer');}// Refresh data to get updated customer\nawait loadRealTimeData();}else{// Add new customer - only send required fields to backend\nconst customerData={name:formData.name,email:formData.email,phone:formData.phone||null,agent_id:formData.agentId,vip_level:formData.vip_level||'Silver',status:formData.status||'active'};// Create customer via API\nconst response=await apiClient.createCustomer(customerData);if(!response.success){throw new Error(response.error||'Failed to create customer 1');}// Refresh data to get the new customer\nawait loadRealTimeData();}// Data already saved via API, just update local state\n// Reset form and close dialog\nsetFormData({name:'',email:'',phone:'',agentId:'',vip_level:'Silver',status:'active'});setEditingCustomer(null);setIsDialogOpen(false);}catch(error){// Error already handled in saveCustomersToSupabase\n}};const handleDetailSubmit=async e=>{e.preventDefault();if(!selectedCustomer)return;try{setSaving(true);// Handle passport file upload first if there's a file\nlet passportFileUrl=null;if(detailFormData.passportFile){var _passportUploadRespon,_passportUploadRespon2;console.log('🔍 Uploading passport file:',detailFormData.passportFile.name);// Convert file to base64 for upload\nconst fileData=await new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=()=>resolve(reader.result);reader.onerror=reject;reader.readAsDataURL(detailFormData.passportFile);});// Upload passport file via API\nconst passportUploadResponse=await apiClient.uploadCustomerPassport(selectedCustomer.id,{name:detailFormData.passportFile.name,type:detailFormData.passportFile.type,size:detailFormData.passportFile.size,data:fileData,uploadedAt:new Date().toISOString()});if(!passportUploadResponse.success){throw new Error(passportUploadResponse.error||'Failed to upload passport file');}passportFileUrl=(_passportUploadRespon=passportUploadResponse.data)===null||_passportUploadRespon===void 0?void 0:(_passportUploadRespon2=_passportUploadRespon.passport_photo)===null||_passportUploadRespon2===void 0?void 0:_passportUploadRespon2.data;console.log('✅ Passport file uploaded successfully:',passportFileUrl);}// Prepare customer details data\nconst detailsData={// Identity & Personal fields\npassport_number:detailFormData.passportNumber||null,id_number:detailFormData.idNumber||null,nationality:detailFormData.nationality||null,date_of_birth:detailFormData.dateOfBirth||null,address:detailFormData.address||null,occupation:detailFormData.occupation||null,// Preferences & Lifestyle fields\nhobby:detailFormData.hobby||null,gaming_preferences:detailFormData.gamingPreferences||null,emergency_contact:detailFormData.emergencyContact||null,emergency_phone:detailFormData.emergencyPhone||null,// Additional Details\nmarital_status:detailFormData.maritalStatus||null,education_level:detailFormData.educationLevel||null,income_range:detailFormData.incomeRange||null,preferred_language:detailFormData.preferredLanguage||'English',notes:detailFormData.notes||null,special_requirements:detailFormData.specialRequirements||null};// 🔍 Frontend Debug: Log data being sent to backend\nconsole.log('🔍 Frontend - updateData being sent:',detailsData);console.log('🔍 Frontend - Customer ID:',selectedCustomer.id);console.log('🔍 Frontend - Form data:',detailFormData);// Use PUT endpoint which handles both create and update\nconst response=await apiClient.updateCustomerDetails(selectedCustomer.id,detailsData);if(!response.success){throw new Error(response.error||'Failed to update customer details');}console.log('✅ Customer details saved successfully');// Refresh data to get updated customer\nawait loadRealTimeData();// 重新加载当前客户的详情数据以显示最新信息\nif(selectedCustomer){const updatedDetailsResponse=await apiClient.getCustomerDetails(selectedCustomer.id);if(updatedDetailsResponse.success&&updatedDetailsResponse.data){console.log('✅ Loaded updated customer details:',updatedDetailsResponse.data);// 更新表单数据以显示最新保存的信息\nconst details=updatedDetailsResponse.data;setDetailFormData({passportNumber:details.passport_number||'',passportFile:null,idNumber:details.id_number||'',nationality:details.nationality||'',dateOfBirth:details.date_of_birth||'',address:details.address||'',occupation:details.occupation||'',hobby:details.hobby||'',gamingPreferences:details.gaming_preferences||'',emergencyContact:details.emergency_contact||'',emergencyPhone:details.emergency_phone||'',maritalStatus:details.marital_status||'',educationLevel:details.education_level||'',incomeRange:details.income_range||'',preferredLanguage:details.preferred_language||'English',notes:details.notes||'',specialRequirements:details.special_requirements||''});// 同步更新 selectedCustomer 对象以确保基本信息显示最新数据\nconst updatedCustomer=customers.find(c=>c.id===selectedCustomer.id);if(updatedCustomer){setSelectedCustomer(_objectSpread({},updatedCustomer));}}}setIsDetailDialogOpen(false);setSelectedCustomer(null);}catch(error){console.error('Error updating customer details:',error);showError(\"Failed to update customer details: \".concat(error instanceof Error?error.message:'Unknown error occurred'));}finally{setSaving(false);}};const handleImagePreview=(src,title)=>{setImagePreview({isOpen:true,src,title});};const closeImagePreview=()=>{setImagePreview({isOpen:false,src:'',title:''});};const handleEdit=customer=>{setEditingCustomer(customer);setFormData({name:customer.name,email:customer.email,phone:customer.phone,agentId:customer.agentId,vip_level:customer.vip_level||'Silver',status:customer.status||'active'});setIsDialogOpen(true);};const handleEditDetails=async customer=>{setSelectedCustomer(customer);try{// Load existing customer details from API\nconst response=await apiClient.getCustomerDetails(customer.id);if(response.success&&response.data){// Use existing details from API\nconst details=response.data;// Type assertion to fix TypeScript errors\nsetDetailFormData({// Identity & Personal\npassportNumber:details.passport_number||'',passportFile:null,idNumber:details.id_number||'',nationality:details.nationality||'',dateOfBirth:details.date_of_birth||'',address:details.address||'',occupation:details.occupation||'',// Preferences & Lifestyle\nhobby:details.hobby||'',gamingPreferences:details.gaming_preferences||'',emergencyContact:details.emergency_contact||'',emergencyPhone:details.emergency_phone||'',// Additional Details\nmaritalStatus:details.marital_status||'',educationLevel:details.education_level||'',incomeRange:details.income_range||'',preferredLanguage:details.preferred_language||'English',notes:details.notes||'',specialRequirements:details.special_requirements||''});}else{// No existing details, use empty form\nsetDetailFormData({// Identity & Personal\npassportNumber:'',passportFile:null,idNumber:'',nationality:'',dateOfBirth:'',address:'',occupation:'',// Preferences & Lifestyle\nhobby:'',gamingPreferences:'',emergencyContact:'',emergencyPhone:'',// Additional Details\nmaritalStatus:'',educationLevel:'',incomeRange:'',preferredLanguage:'English',notes:'',specialRequirements:''});}}catch(error){console.error('Error loading customer details:',error);showError('Failed to load customer details');// Use empty form as fallback\nsetDetailFormData({passportNumber:'',passportFile:null,idNumber:'',nationality:'',dateOfBirth:'',address:'',occupation:'',hobby:'',gamingPreferences:'',emergencyContact:'',emergencyPhone:'',maritalStatus:'',educationLevel:'',incomeRange:'',preferredLanguage:'English',notes:'',specialRequirements:''});}setIsDetailDialogOpen(true);};const toggleCustomerExpansion=customerId=>{setExpandedCustomer(expandedCustomer===customerId?null:customerId);};const handleDeleteCustomer=async()=>{if(!deletingCustomer)return;try{setSaving(true);clearError();console.log('🗑️ Deleting customer:',deletingCustomer.name,deletingCustomer.id);// Call backend API to delete customer\nconst response=await apiClient.deleteCustomer(deletingCustomer.id);if(!response.success){throw new Error(response.error||'Failed to delete customer');}console.log('✅ Customer deleted successfully');// Refresh data to get updated customer list\nawait loadRealTimeData();// Close dialog and reset state\nsetDeletingCustomer(null);}catch(error){console.error('❌ Error deleting customer:',error);showError(\"Failed to delete customer: \".concat(error instanceof Error?error.message:'Unknown error occurred'));}finally{setSaving(false);}};const updateCustomerAttachments=async(customerId,attachments)=>{try{console.log('🔍 Frontend - Updating customer attachments:',customerId,attachments.length);// Update local state immediately for UI responsiveness\nconst updatedCustomers=customers.map(customer=>customer.id===customerId?_objectSpread(_objectSpread({},customer),{},{attachments}):customer);setCustomers(updatedCustomers);// Save to backend via API\nconst response=await apiClient.uploadCustomerAttachments(customerId,attachments);if(!response.success){throw new Error(response.error||'Failed to upload attachments');}console.log('✅ Customer attachments updated successfully');// Refresh data to ensure consistency\nawait loadRealTimeData();}catch(error){console.error('❌ Error updating customer attachments:',error);showError(\"Failed to update attachments: \".concat(error instanceof Error?error.message:'Unknown error occurred'));// Revert local state on error\nawait loadRealTimeData();}};const handleFileUpload=async(customerId,newAttachments)=>{try{console.log('🔍 Frontend - Uploading new files:',customerId,newAttachments.length);// Get current customer\nconst customer=customers.find(c=>c.id===customerId);if(!customer){throw new Error('Customer not found');}// Merge with existing attachments\nconst existingAttachments=customer.attachments||[];const allAttachments=[...existingAttachments,...newAttachments];// Update via the existing function\nawait updateCustomerAttachments(customerId,allAttachments);}catch(error){console.error('❌ Error uploading files:',error);showError(\"Failed to upload files: \".concat(error instanceof Error?error.message:'Unknown error occurred'));}};// Attachment deletion function (currently unused but available for future use)\n// const handleDeleteAttachment = async (customerId: string, attachmentId: string) => {\n//   try {\n//     console.log('🔍 Frontend - Deleting attachment:', customerId, attachmentId);\n//     \n//     // Delete via API\n//     const response = await apiClient.deleteCustomerAttachment(customerId, attachmentId);\n//     if (!response.success) {\n//       throw new Error(response.error || 'Failed to delete attachment');\n//     }\n//     console.log('✅ Attachment deleted successfully');\n//     \n//     // Refresh data to get updated attachments\n//     await loadRealTimeData();\n//   } catch (error) {\n//     console.error('❌ Error deleting attachment:', error);\n//     showError(`Failed to delete attachment: ${error instanceof Error ? error.message : 'Unknown error occurred'}`);\n//   }\n// };\nconst openNewCustomerDialog=()=>{setEditingCustomer(null);setFormData({name:'',email:'',phone:'',agentId:user.role==='agent'&&user.agentId?user.agentId:'',vip_level:'Silver',status:'active'});setIsDialogOpen(true);};// Get available agents based on user role\nconst getAvailableAgents=()=>{if(user.role==='agent'&&user.agentId){return agents.filter(agent=>agent.id===user.agentId);}return agents.filter(agent=>agent.status==='active');};const availableAgents=getAvailableAgents();const getStatusColor=status=>{switch(status){case'planned':return'bg-blue-100 text-blue-800';case'ongoing':return'bg-yellow-100 text-yellow-800';case'completed':return'bg-green-100 text-green-800';default:return'bg-gray-100 text-gray-800';}};const getWinLossIndicator=winLoss=>{if(winLoss===0){return{text:'Break Even',icon:Target,bgColor:'bg-gray-100',textColor:'text-gray-700',iconColor:'text-gray-600'};}else if(winLoss>0){return{text:'Customer Win',icon:TrendingUp,bgColor:'bg-green-100',textColor:'text-green-700',iconColor:'text-green-600'};}else{return{text:'House Win',icon:TrendingDown,bgColor:'bg-red-100',textColor:'text-red-700',iconColor:'text-red-600'};}};const isAdmin=user.role==='admin';const isAgent=user.role==='agent';const isStaff=user.role==='staff';// Show loading state\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Loading real-time customer data from Supabase...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[isStaff&&/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-blue-50 border border-blue-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Eye,{className:\"w-5 h-5 text-blue-600 mr-2\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-blue-800\",children:\"Customer Information - View Only\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-600\",children:\"You have read-only access to customer information, trip history, and documents.\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Customer Management\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:isAgent?'Manage your customers with real-time rolling data and complete profile editing':isStaff?'View customer information, real-time data, and trip history':'Manage all customers with live data updates and comprehensive profile management'})]}),!isReadOnly&&/*#__PURE__*/_jsxs(Dialog,{open:isDialogOpen,onOpenChange:setIsDialogOpen,children:[/*#__PURE__*/_jsx(DialogTrigger,{asChild:true,children:/*#__PURE__*/_jsxs(Button,{onClick:openNewCustomerDialog,disabled:saving,children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add Customer\"]})}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:editingCustomer?'Edit Customer':'Add New Customer'}),/*#__PURE__*/_jsx(DialogDescription,{children:editingCustomer?'Update basic customer information':'Add a new customer with basic details. You can add extended details after creation.'})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"name\",children:\"Name\"}),/*#__PURE__*/_jsx(Input,{id:\"name\",value:formData.name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{name:e.target.value})),placeholder:\"Customer full name\",required:true,disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"email\",children:\"Email\"}),/*#__PURE__*/_jsx(Input,{id:\"email\",type:\"email\",value:formData.email,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{email:e.target.value})),placeholder:\"customer@email.com\",required:true,disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"phone\",children:\"Phone\"}),/*#__PURE__*/_jsx(Input,{id:\"phone\",value:formData.phone,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{phone:e.target.value})),placeholder:\"+1234567890\",required:true,disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"agent\",children:\"Agent\"}),/*#__PURE__*/_jsxs(Select,{value:formData.agentId,onValueChange:value=>setFormData(_objectSpread(_objectSpread({},formData),{},{agentId:value})),disabled:user.role==='agent'||saving,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select an agent\"})}),/*#__PURE__*/_jsx(SelectContent,{children:availableAgents.map(agent=>/*#__PURE__*/_jsx(SelectItem,{value:agent.id,children:agent.name},agent.id))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>setIsDialogOpen(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:saving,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2 animate-spin\"}),\"Saving to Supabase...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[editingCustomer?'Update':'Add',\" Customer\"]})})]})]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-6\",children:filteredCustomers.length===0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"text-center py-12\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-500\",children:[\"No customers found. \",isStaff?'Contact an administrator to add customers.':'Add your first customer to get started.']})})}):filteredCustomers.map(customer=>{var _customer$attachments,_details,_details$passport_pho,_details2,_details3,_details3$passport_ph,_details4,_details4$passport_ph,_details5,_details6,_details6$passport_ph,_details7,_details8,_details8$passport_ph,_details9,_details0,_details1,_details10,_details11,_details12,_details13,_details14,_details15,_details16,_details16$passport_p,_details17,_details17$passport_p,_details18,_details19,_details19$passport_p,_details20,_details21,_details21$passport_p,_details22,_details23,_details23$passport_p;const tripHistory=getCustomerTripHistory(customer.id);const rollingHistory=getCustomerRollingRecords(customer.id);const buyInOutHistory=getCustomerBuyInOutRecords(customer.id);const isExpanded=expandedCustomer===customer.id;return/*#__PURE__*/_jsx(Collapsible,{open:isExpanded,onOpenChange:()=>toggleCustomerExpansion(customer.id),children:/*#__PURE__*/_jsxs(Card,{className:\"overflow-hidden\",children:[/*#__PURE__*/_jsx(CollapsibleTrigger,{asChild:true,children:/*#__PURE__*/_jsx(CardHeader,{className:\"cursor-pointer hover:bg-gray-50 transition-colors\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:customer.name}),/*#__PURE__*/_jsx(Badge,{variant:customer.isActive?\"default\":\"secondary\",children:customer.isActive?'Active':'Inactive'}),customer.attachments&&customer.attachments.length>0&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-3 h-3\"}),/*#__PURE__*/_jsx(\"span\",{children:customer.attachments.length})]}),tripHistory.length>0&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-3 h-3\"}),/*#__PURE__*/_jsxs(\"span\",{children:[tripHistory.length,\" trips\"]})]}),rollingHistory.length>0&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-green-50 text-green-700 border-green-200\",children:[/*#__PURE__*/_jsx(Receipt,{className:\"w-3 h-3 mr-1\"}),rollingHistory.length,\" records\"]}),customer.isAgent&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-blue-50 text-blue-700 border-blue-200\",children:[/*#__PURE__*/_jsx(UserCheck,{className:\"w-3 h-3 mr-1\"}),\"Agent\"]}),isStaff&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-yellow-50 text-yellow-700 border-yellow-200\",children:[/*#__PURE__*/_jsx(Eye,{className:\"w-3 h-3 mr-1\"}),\"View Only\"]}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-green-50 text-green-700 border-green-200\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-3 h-3 mr-1\"}),\"Live Data\"]})]}),/*#__PURE__*/_jsxs(CardDescription,{children:[\"Customer since \",customer.createdAt,\" \\u2022 Agent: \",customer.agentName]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2\",children:isExpanded?/*#__PURE__*/_jsx(ChevronUp,{className:\"w-5 h-5 text-gray-400\"}):/*#__PURE__*/_jsx(ChevronDown,{className:\"w-5 h-5 text-gray-400\"})})]})})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4 text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:customer.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Phone:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:customer.phone})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-4 h-4 text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:customer.details?'Details available':'No details available'})]}),canSeeFinancials&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(DollarSign,{className:\"w-4 h-4 text-blue-600\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium\",children:[\"Rolling: $\",(customer.totalRolling||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[(customer.totalWinLoss||0)>=0?/*#__PURE__*/_jsx(TrendingUp,{className:\"w-4 h-4 text-green-600\"}):/*#__PURE__*/_jsx(TrendingDown,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium \".concat((customer.totalWinLoss||0)>=0?'text-green-600':'text-red-600'),children:[\"W/L: $\",Math.abs(customer.totalWinLoss||0).toLocaleString()]})]})]})]}),!isReadOnly&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>handleEdit(customer),disabled:saving,children:[/*#__PURE__*/_jsx(Edit,{className:\"w-4 h-4 mr-2\"}),\"Edit Basic Info\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>handleEditDetails(customer),disabled:saving,children:[/*#__PURE__*/_jsx(FileText,{className:\"w-4 h-4 mr-2\"}),\"Edit Details\"]}),isAdmin&&/*#__PURE__*/_jsxs(AlertDialog,{open:(deletingCustomer===null||deletingCustomer===void 0?void 0:deletingCustomer.id)===customer.id,onOpenChange:open=>!open&&setDeletingCustomer(null),children:[/*#__PURE__*/_jsx(AlertDialogTrigger,{asChild:true,children:/*#__PURE__*/_jsx(Button,{variant:\"destructive\",size:\"sm\",onClick:()=>setDeletingCustomer(customer),disabled:saving,className:\"bg-red-600 hover:bg-red-700 text-white\",children:\"Delete\"})}),/*#__PURE__*/_jsxs(AlertDialogContent,{children:[/*#__PURE__*/_jsxs(AlertDialogHeader,{children:[/*#__PURE__*/_jsx(AlertDialogTitle,{children:\"Delete Customer\"}),/*#__PURE__*/_jsxs(AlertDialogDescription,{children:[\"Are you sure you want to permanently delete \\\"\",customer.name,\"\\\"? This action cannot be undone and will remove all customer data, trip history, transactions, and associated records from the system.\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"Warning:\"}),\" This will also affect any trips this customer participated in and may impact financial calculations.\"]})]}),/*#__PURE__*/_jsxs(AlertDialogFooter,{children:[/*#__PURE__*/_jsx(AlertDialogCancel,{disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(AlertDialogAction,{onClick:handleDeleteCustomer,className:\"bg-red-600 text-white hover:bg-red-700\",disabled:saving,children:saving?'Deleting...':'Delete Customer'})]})]})]})]}),/*#__PURE__*/_jsx(CollapsibleContent,{className:\"mt-6\",children:/*#__PURE__*/_jsxs(Tabs,{defaultValue:\"info\",className:\"w-full\",children:[/*#__PURE__*/_jsxs(TabsList,{className:\"grid w-full grid-cols-5\",children:[/*#__PURE__*/_jsxs(TabsTrigger,{value:\"info\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Profile\"})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"trips\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Trips (\",tripHistory.length,\")\"]})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"rolling\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Receipt,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Rolling (\",rollingHistory.length,\")\"]})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"cash\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Wallet,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Cash Flow (\",buyInOutHistory.length,\")\"]})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"files\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Files (\",(((_customer$attachments=customer.attachments)===null||_customer$attachments===void 0?void 0:_customer$attachments.length)||0)+((_details=customer.details)!==null&&_details!==void 0&&(_details$passport_pho=_details.passport_photo)!==null&&_details$passport_pho!==void 0&&_details$passport_pho.data?1:0),\")\"]})]})]}),/*#__PURE__*/_jsxs(TabsContent,{value:\"info\",className:\"space-y-4 mt-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium text-gray-900 flex items-center\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-4 h-4 mr-2\"}),\"Basic Information\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg\",children:customer.name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Email\"}),/*#__PURE__*/_jsx(\"p\",{children:customer.email})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Phone\"}),/*#__PURE__*/_jsx(\"p\",{children:customer.phone})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Agent\"}),/*#__PURE__*/_jsx(\"p\",{children:customer.agentName})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Status\"}),/*#__PURE__*/_jsx(Badge,{variant:customer.isActive?\"default\":\"secondary\",children:customer.isActive?'Active':'Inactive'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Member Since\"}),/*#__PURE__*/_jsx(\"p\",{children:customer.createdAt})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium text-gray-900 flex items-center\",children:[/*#__PURE__*/_jsx(IdCard,{className:\"w-4 h-4 mr-2\"}),\"Identity & Personal\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Passport Number\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details2=customer.details)===null||_details2===void 0?void 0:_details2.passport_number)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Passport Photo\"}),(_details3=customer.details)!==null&&_details3!==void 0&&(_details3$passport_ph=_details3.passport_photo)!==null&&_details3$passport_ph!==void 0&&_details3$passport_ph.data?/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-4 h-4 text-blue-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-blue-600\",children:((_details4=customer.details)===null||_details4===void 0?void 0:(_details4$passport_ph=_details4.passport_photo)===null||_details4$passport_ph===void 0?void 0:_details4$passport_ph.name)||((_details5=customer.details)===null||_details5===void 0?void 0:_details5.passport_file_name)||'Passport Photo'})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[\"Uploaded: \",(_details6=customer.details)!==null&&_details6!==void 0&&(_details6$passport_ph=_details6.passport_photo)!==null&&_details6$passport_ph!==void 0&&_details6$passport_ph.uploadedAt?new Date(customer.details.passport_photo.uploadedAt).toLocaleDateString():(_details7=customer.details)!==null&&_details7!==void 0&&_details7.passport_uploaded_at?new Date(customer.details.passport_uploaded_at).toLocaleDateString():'Unknown date']}),((_details8=customer.details)===null||_details8===void 0?void 0:(_details8$passport_ph=_details8.passport_photo)===null||_details8$passport_ph===void 0?void 0:_details8$passport_ph.data)&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(PhotoDisplay,{photos:[{id:'passport',photo:{data:customer.details.passport_photo.data,filename:customer.details.passport_photo.name||'passport.jpg',size:customer.details.passport_photo.size,type:customer.details.passport_photo.type},upload_date:customer.details.passport_photo.uploaded_at}],type:\"passport\",size:\"medium\",maxPhotos:1})})]}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Not provided\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"ID Number\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details9=customer.details)===null||_details9===void 0?void 0:_details9.id_number)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Nationality\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details0=customer.details)===null||_details0===void 0?void 0:_details0.nationality)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Date of Birth\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details1=customer.details)===null||_details1===void 0?void 0:_details1.date_of_birth)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Address\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details10=customer.details)===null||_details10===void 0?void 0:_details10.address)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Occupation\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details11=customer.details)===null||_details11===void 0?void 0:_details11.occupation)||'Not provided'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium text-gray-900 flex items-center\",children:[/*#__PURE__*/_jsx(Heart,{className:\"w-4 h-4 mr-2\"}),\"Preferences & Financial\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Hobby\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details12=customer.details)===null||_details12===void 0?void 0:_details12.hobby)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Gaming Preferences\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details13=customer.details)===null||_details13===void 0?void 0:_details13.gaming_preferences)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Emergency Contact\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details14=customer.details)===null||_details14===void 0?void 0:_details14.emergency_contact)||'Not provided'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Emergency Phone\"}),/*#__PURE__*/_jsx(\"p\",{children:((_details15=customer.details)===null||_details15===void 0?void 0:_details15.emergency_phone)||'Not provided'})]})]})]}),canSeeFinancials&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium text-gray-900 mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4 mr-2\"}),\"Real-time Financial Summary\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Total Rolling\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold text-blue-600\",children:[\"$\",(customer.totalRolling||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Total Win/Loss\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold \".concat((customer.totalWinLoss||0)>=0?'text-green-600':'text-red-600'),children:[\"$\",Math.abs(customer.totalWinLoss||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Buy-in Total\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold text-blue-500\",children:[\"$\",(customer.totalBuyIn||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Buy-out Total\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold text-purple-500\",children:[\"$\",(customer.totalBuyOut||0).toLocaleString()]})]})]})]})]}),/*#__PURE__*/_jsx(TabsContent,{value:\"trips\",className:\"space-y-4 mt-6\",children:tripHistory.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-12 h-12 mx-auto text-gray-300 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No trip history available\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:\"Trip Participation History\"}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-green-50 text-green-700\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-3 h-3 mr-1\"}),\"Live Data\"]})]}),tripHistory.map(trip=>{const winLossIndicator=getWinLossIndicator(trip.customerData.winLoss||0);const IconComponent=winLossIndicator.icon;return/*#__PURE__*/_jsx(Card,{className:\"p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-start\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium\",children:trip.tripName}),/*#__PURE__*/_jsx(Badge,{className:getStatusColor(trip.tripStatus),children:trip.tripStatus}),/*#__PURE__*/_jsxs(Badge,{className:\"\".concat(winLossIndicator.bgColor,\" \").concat(winLossIndicator.textColor,\" flex items-center space-x-1\"),children:[/*#__PURE__*/_jsx(IconComponent,{className:\"w-3 h-3 \".concat(winLossIndicator.iconColor)}),/*#__PURE__*/_jsx(\"span\",{children:winLossIndicator.text})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Date\"}),/*#__PURE__*/_jsx(\"p\",{children:trip.tripDate})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Rolling Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[\"$\",(trip.customerData.rollingAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Win/Loss (Real-time)\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium \".concat((trip.customerData.winLoss||0)>=0?'text-green-600':'text-red-600'),children:[\"$\",Math.abs(trip.customerData.winLoss||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Agent\"}),/*#__PURE__*/_jsx(\"p\",{children:trip.agentName})]})]})]})})},trip.tripId);})]})}),/*#__PURE__*/_jsx(TabsContent,{value:\"rolling\",className:\"space-y-4 mt-6\",children:rollingHistory.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(Receipt,{className:\"w-12 h-12 mx-auto text-gray-300 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No rolling records available\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:\"Rolling Records\"}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-green-50 text-green-700\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-3 h-3 mr-1\"}),\"Live Data\"]})]}),rollingHistory.slice(0,10).map(record=>{const winLossIndicator=getWinLossIndicator(record.winLoss||0);const IconComponent=winLossIndicator.icon;return/*#__PURE__*/_jsx(Card,{className:\"p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-start\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium\",children:record.gameType}),record.verified&&/*#__PURE__*/_jsxs(Badge,{variant:\"default\",className:\"bg-green-100 text-green-800\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-3 h-3 mr-1\"}),\"Verified\"]}),/*#__PURE__*/_jsxs(Badge,{className:\"\".concat(winLossIndicator.bgColor,\" \").concat(winLossIndicator.textColor,\" flex items-center space-x-1\"),children:[/*#__PURE__*/_jsx(IconComponent,{className:\"w-3 h-3 \".concat(winLossIndicator.iconColor)}),/*#__PURE__*/_jsx(\"span\",{children:winLossIndicator.text})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-5 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Rolling Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[\"$\",(record.rollingAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Win/Loss\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium \".concat((record.winLoss||0)>=0?'text-green-600':'text-red-600'),children:[\"$\",Math.abs(record.winLoss||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Buy-in\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium text-blue-600\",children:[\"$\",(record.buyInAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Buy-out\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium text-purple-600\",children:[\"$\",(record.buyOutAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Recorded\"}),/*#__PURE__*/_jsx(\"p\",{children:new Date(record.recordedAt).toLocaleDateString()})]})]})]})})},record.id);}),rollingHistory.length>10&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-sm text-gray-500\",children:[\"Showing 10 most recent records out of \",rollingHistory.length,\" total\"]})]})}),/*#__PURE__*/_jsx(TabsContent,{value:\"cash\",className:\"space-y-4 mt-6\",children:buyInOutHistory.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(Wallet,{className:\"w-12 h-12 mx-auto text-gray-300 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No cash flow records available\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:\"Cash Flow Records\"}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-green-50 text-green-700\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-3 h-3 mr-1\"}),\"Live Data\"]})]}),buyInOutHistory.slice(0,10).map(record=>/*#__PURE__*/_jsx(Card,{className:\"p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-start\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium capitalize\",children:record.transactionType}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:record.transactionType==='buy-in'?'bg-blue-50 text-blue-700':'bg-purple-50 text-purple-700',children:[record.transactionType==='buy-in'?/*#__PURE__*/_jsx(ArrowDownCircle,{className:\"w-3 h-3 mr-1\"}):/*#__PURE__*/_jsx(ArrowUpCircle,{className:\"w-3 h-3 mr-1\"}),record.transactionType]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium \".concat(record.transactionType==='buy-in'?'text-blue-600':'text-purple-600'),children:[\"$\",record.amount.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Venue\"}),/*#__PURE__*/_jsx(\"p\",{children:record.venue||'Not specified'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Staff\"}),/*#__PURE__*/_jsx(\"p\",{children:record.staffName})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-gray-500\",children:\"Date\"}),/*#__PURE__*/_jsx(\"p\",{children:new Date(record.timestamp).toLocaleDateString()})]})]})]})})},record.id)),buyInOutHistory.length>10&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-sm text-gray-500\",children:[\"Showing 10 most recent records out of \",buyInOutHistory.length,\" total\"]})]})}),/*#__PURE__*/_jsxs(TabsContent,{value:\"files\",className:\"space-y-4 mt-6\",children:[!isStaff&&/*#__PURE__*/_jsx(FileUpload,{attachments:customer.attachments||[],onAttachmentsChange:attachments=>updateCustomerAttachments(customer.id,attachments),onUpload:newAttachments=>handleFileUpload(customer.id,newAttachments),disabled:isStaff,currentUser:user.username||user.email||'Unknown User'}),((_details16=customer.details)===null||_details16===void 0?void 0:(_details16$passport_p=_details16.passport_photo)===null||_details16$passport_p===void 0?void 0:_details16$passport_p.data)&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium text-gray-900 flex items-center\",children:[/*#__PURE__*/_jsx(IdCard,{className:\"w-4 h-4 mr-2\"}),\"Passport Photo\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-4 h-4 text-blue-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium truncate\",children:((_details17=customer.details)===null||_details17===void 0?void 0:(_details17$passport_p=_details17.passport_photo)===null||_details17$passport_p===void 0?void 0:_details17$passport_p.name)||((_details18=customer.details)===null||_details18===void 0?void 0:_details18.passport_file_name)||'Passport Photo'}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[(_details19=customer.details)!==null&&_details19!==void 0&&(_details19$passport_p=_details19.passport_photo)!==null&&_details19$passport_p!==void 0&&_details19$passport_p.size?\"\".concat((customer.details.passport_photo.size/1024).toFixed(1),\" KB\"):(_details20=customer.details)!==null&&_details20!==void 0&&_details20.passport_file_size?\"\".concat((customer.details.passport_file_size/1024).toFixed(1),\" KB\"):'Unknown size',\" \\u2022 \",(_details21=customer.details)!==null&&_details21!==void 0&&(_details21$passport_p=_details21.passport_photo)!==null&&_details21$passport_p!==void 0&&_details21$passport_p.uploadedAt?new Date(customer.details.passport_photo.uploadedAt).toLocaleDateString():(_details22=customer.details)!==null&&_details22!==void 0&&_details22.passport_uploaded_at?new Date(customer.details.passport_uploaded_at).toLocaleDateString():'Unknown date']})]})]}),((_details23=customer.details)===null||_details23===void 0?void 0:(_details23$passport_p=_details23.passport_photo)===null||_details23$passport_p===void 0?void 0:_details23$passport_p.data)&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(PhotoDisplay,{photos:[{id:'passport',photo:{data:customer.details.passport_photo.data,filename:customer.details.passport_photo.name||'passport.jpg',size:customer.details.passport_photo.size,type:customer.details.passport_photo.type},upload_date:customer.details.passport_photo.uploaded_at}],type:\"passport\",size:\"large\",maxPhotos:1})})]})})]}),customer.attachments&&customer.attachments.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:\"Attached Files\"}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:customer.attachments.map(attachment=>/*#__PURE__*/_jsxs(Card,{className:\"p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-4 h-4 text-gray-400\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium truncate\",children:attachment.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[(attachment.size/1024).toFixed(1),\" KB \\u2022 \",new Date(attachment.uploadedAt).toLocaleDateString()]})]})]}),attachment.type.startsWith('image/')&&/*#__PURE__*/_jsx(\"img\",{src:attachment.data,alt:attachment.name,className:\"mt-2 w-full h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity\",onClick:()=>handleImagePreview(attachment.data,\"\".concat(customer.name,\" - \").concat(attachment.name))})]},attachment.id))})]})]})]})})]})]})},customer.id);})}),/*#__PURE__*/_jsx(Dialog,{open:isDetailDialogOpen,onOpenChange:setIsDetailDialogOpen,children:/*#__PURE__*/_jsxs(DialogContent,{className:\"max-w-4xl max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Edit Customer Details\"}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Update comprehensive customer information\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleDetailSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(Tabs,{defaultValue:\"identity\",className:\"w-full\",children:[/*#__PURE__*/_jsxs(TabsList,{className:\"grid w-full grid-cols-3\",children:[/*#__PURE__*/_jsx(TabsTrigger,{value:\"identity\",children:\"Identity & Personal\"}),/*#__PURE__*/_jsx(TabsTrigger,{value:\"preferences\",children:\"Preferences & Lifestyle\"}),/*#__PURE__*/_jsx(TabsTrigger,{value:\"additional\",children:\"Additional Details\"})]}),/*#__PURE__*/_jsx(TabsContent,{value:\"identity\",className:\"space-y-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-6 rounded-lg border\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(IdCard,{className:\"w-5 h-5 mr-2 text-blue-600\"}),\"Identity & Personal Information\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"passportNumber\",children:\"Passport Number\"}),/*#__PURE__*/_jsx(Input,{id:\"passportNumber\",value:detailFormData.passportNumber,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{passportNumber:e.target.value})),placeholder:\"Not provided\",disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"passportFile\",children:\"Passport Photo\"}),(selectedCustomer===null||selectedCustomer===void 0?void 0:(_details24=selectedCustomer.details)===null||_details24===void 0?void 0:(_details24$passport_p=_details24.passport_photo)===null||_details24$passport_p===void 0?void 0:_details24$passport_p.data)&&!detailFormData.passportFile&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3 p-3 border rounded-lg bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"Current Passport Photo:\"}),/*#__PURE__*/_jsxs(Button,{type:\"button\",variant:\"outline\",size:\"sm\",onClick:()=>selectedCustomer&&handleImagePreview(selectedCustomer.details.passport_photo.data,\"\".concat(selectedCustomer.name,\" - Current Passport Photo\")),children:[/*#__PURE__*/_jsx(Eye,{className:\"w-3 h-3 mr-1\"}),\"View\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-4 h-4 text-blue-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:((_details25=selectedCustomer.details)===null||_details25===void 0?void 0:(_details25$passport_p=_details25.passport_photo)===null||_details25$passport_p===void 0?void 0:_details25$passport_p.name)||((_details26=selectedCustomer.details)===null||_details26===void 0?void 0:_details26.passport_file_name)||'passport.jpg'})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Upload a new file to replace the current passport photo\"})]}),/*#__PURE__*/_jsx(Input,{id:\"passportFile\",type:\"file\",accept:\"image/*,.pdf\",onChange:e=>{var _e$target$files;const file=((_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0])||null;setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{passportFile:file}));},disabled:saving,className:\"cursor-pointer\"}),detailFormData.passportFile&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"New file selected: \",detailFormData.passportFile.name,\" (\",(detailFormData.passportFile.size/1024).toFixed(1),\" KB)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"idNumber\",children:\"ID Number\"}),/*#__PURE__*/_jsx(Input,{id:\"idNumber\",value:detailFormData.idNumber,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{idNumber:e.target.value})),placeholder:\"Not provided\",disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"nationality\",children:\"Nationality\"}),/*#__PURE__*/_jsx(Input,{id:\"nationality\",value:detailFormData.nationality,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{nationality:e.target.value})),placeholder:\"Not provided\",disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"dateOfBirth\",children:\"Date of Birth\"}),/*#__PURE__*/_jsx(Input,{id:\"dateOfBirth\",type:\"date\",value:detailFormData.dateOfBirth,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{dateOfBirth:e.target.value})),disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-2\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"address\",children:\"Address\"}),/*#__PURE__*/_jsx(Textarea,{id:\"address\",value:detailFormData.address,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{address:e.target.value})),placeholder:\"Not provided\",disabled:saving,rows:3})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"occupation\",children:\"Occupation\"}),/*#__PURE__*/_jsx(Input,{id:\"occupation\",value:detailFormData.occupation,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{occupation:e.target.value})),placeholder:\"Not provided\",disabled:saving})]})]})]})}),/*#__PURE__*/_jsx(TabsContent,{value:\"preferences\",className:\"space-y-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 p-6 rounded-lg border\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(Heart,{className:\"w-5 h-5 mr-2 text-pink-600\"}),\"Preferences & Lifestyle\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"hobby\",children:\"Hobby\"}),/*#__PURE__*/_jsx(Input,{id:\"hobby\",value:detailFormData.hobby,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{hobby:e.target.value})),placeholder:\"Not provided\",disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"gamingPreferences\",children:\"Gaming Preferences\"}),/*#__PURE__*/_jsx(Input,{id:\"gamingPreferences\",value:detailFormData.gamingPreferences,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{gamingPreferences:e.target.value})),placeholder:\"Not provided\",disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"emergencyContact\",children:\"Emergency Contact\"}),/*#__PURE__*/_jsx(Input,{id:\"emergencyContact\",value:detailFormData.emergencyContact,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{emergencyContact:e.target.value})),placeholder:\"Not provided\",disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"emergencyPhone\",children:\"Emergency Phone\"}),/*#__PURE__*/_jsx(Input,{id:\"emergencyPhone\",value:detailFormData.emergencyPhone,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{emergencyPhone:e.target.value})),placeholder:\"Not provided\",disabled:saving})]})]})]})}),/*#__PURE__*/_jsx(TabsContent,{value:\"additional\",className:\"space-y-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 p-6 rounded-lg border\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"w-5 h-5 mr-2 text-green-600\"}),\"Additional Details\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"maritalStatus\",children:\"Marital Status\"}),/*#__PURE__*/_jsxs(Select,{value:detailFormData.maritalStatus,onValueChange:value=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{maritalStatus:value})),disabled:saving,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select status\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"single\",children:\"Single\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"married\",children:\"Married\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"divorced\",children:\"Divorced\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"widowed\",children:\"Widowed\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"educationLevel\",children:\"Education Level\"}),/*#__PURE__*/_jsxs(Select,{value:detailFormData.educationLevel,onValueChange:value=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{educationLevel:value})),disabled:saving,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select education\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"high_school\",children:\"High School\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"bachelor\",children:\"Bachelor's Degree\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"master\",children:\"Master's Degree\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"doctorate\",children:\"Doctorate\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"other\",children:\"Other\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"incomeRange\",children:\"Income Range\"}),/*#__PURE__*/_jsxs(Select,{value:detailFormData.incomeRange,onValueChange:value=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{incomeRange:value})),disabled:saving,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select range\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"under_50k\",children:\"Under $50,000\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"50k_100k\",children:\"$50,000 - $100,000\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"100k_250k\",children:\"$100,000 - $250,000\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"250k_500k\",children:\"$250,000 - $500,000\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"over_500k\",children:\"Over $500,000\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"preferredLanguage\",children:\"Preferred Language\"}),/*#__PURE__*/_jsxs(Select,{value:detailFormData.preferredLanguage,onValueChange:value=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{preferredLanguage:value})),disabled:saving,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"English\",children:\"English\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Chinese\",children:\"Chinese\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Cantonese\",children:\"Cantonese\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Mandarin\",children:\"Mandarin\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Japanese\",children:\"Japanese\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Korean\",children:\"Korean\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-2\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"notes\",children:\"Notes\"}),/*#__PURE__*/_jsx(Textarea,{id:\"notes\",value:detailFormData.notes,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{notes:e.target.value})),placeholder:\"Additional notes about the customer...\",disabled:saving,rows:3})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-span-2\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"specialRequirements\",children:\"Special Requirements\"}),/*#__PURE__*/_jsx(Textarea,{id:\"specialRequirements\",value:detailFormData.specialRequirements,onChange:e=>setDetailFormData(_objectSpread(_objectSpread({},detailFormData),{},{specialRequirements:e.target.value})),placeholder:\"Any special requirements or accommodations...\",disabled:saving,rows:3})]})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>setIsDetailDialogOpen(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:saving,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2 animate-spin\"}),\"Saving Details...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2\"}),\"Save Details\"]})})]})]})]})}),/*#__PURE__*/_jsx(Dialog,{open:imagePreview.isOpen,onOpenChange:closeImagePreview,children:/*#__PURE__*/_jsxs(DialogContent,{className:\"max-w-4xl max-h-[90vh] p-0\",children:[/*#__PURE__*/_jsx(DialogHeader,{className:\"p-6 pb-2\",children:/*#__PURE__*/_jsxs(DialogTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(IdCard,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:imagePreview.title})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 pb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"img\",{src:imagePreview.src,alt:imagePreview.title,className:\"w-full h-auto max-h-[70vh] object-contain rounded-lg\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 flex justify-end\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:closeImagePreview,children:\"Close\"})})]})]})})]});}// Export with error handler wrapper\nexport const CustomerManagement=withErrorHandler(CustomerManagementComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}