{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useRef,useEffect,useCallback}from'react';import{Button}from'./ui/button';import{Input}from'./ui/input';import{Label}from'./ui/label';import{Textarea}from'./ui/textarea';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Dialog,DialogContent,DialogDescription,DialogHeader,DialogTitle,DialogTrigger}from'./ui/dialog';import{Select,SelectContent,SelectItem,SelectTrigger,SelectValue}from'./ui/select';import{Badge}from'./ui/badge';import{Alert,AlertDescription}from'./ui/alert';import{Save,CheckCircle,RefreshCw,DollarSign,Clock,UserIcon,Camera,Upload,Eye,EyeOff,Calendar,Activity,Receipt,Building2,Database,ShieldCheck,AlertCircle,Loader2,Lock,ArrowDownCircle,ArrowUpCircle,MapPin,Hash}from'lucide-react';import{withErrorHandler}from'./withErrorHandler';import{db}from'../utils/supabase/supabaseClients';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";// Real-time refresh interval (10 seconds for customer data)\nconst CUSTOMER_REFRESH_INTERVAL=10000;// Casino venue options with Okada Manila Casino as default\nconst CASINO_VENUES=['Okada Manila Casino','City of Dreams Manila','Resorts World Manila','Solaire Resort & Casino','Newport World Resorts','Pagcor Casino Filipino','Winford Hotel & Casino','Other Casino'];function StaffRollingRecorderComponent(_ref){let{user,currentStaff,customers:initialCustomers=[],gameTypes:initialGameTypes=[],onRecordSaved,showError,clearError}=_ref;const[isDialogOpen,setIsDialogOpen]=useState(false);const[isProcessingOCR,setIsProcessingOCR]=useState(false);const[isSaving,setIsSaving]=useState(false);const[isLoadingCustomers,setIsLoadingCustomers]=useState(false);const[ocrResults,setOcrResults]=useState(null);const[showManualEntry,setShowManualEntry]=useState(true);const[uploadedImage,setUploadedImage]=useState(null);const fileInputRef=useRef(null);const cameraInputRef=useRef(null);// Real-time customer data\nconst[customers,setCustomers]=useState(initialCustomers);const[gameTypes,setGameTypes]=useState(initialGameTypes);const[lastCustomerUpdate,setLastCustomerUpdate]=useState(null);const[formData,setFormData]=useState({customerId:'',rollingAmount:'',winLoss:'',buyInAmount:'',buyOutAmount:'',gameType:'',venue:'Okada Manila Casino',// Default to Okada Manila Casino\ntableNumber:'',sessionStartTime:'',sessionEndTime:'',notes:''});// Load real-time customer data from Supabase\nconst loadRealTimeCustomerData=useCallback(async()=>{try{setIsLoadingCustomers(true);clearError();const[customersData,gameTypesData]=await Promise.all([db.get('customers',[]),db.get('game_types',[])]);setCustomers(customersData);setGameTypes(gameTypesData);setLastCustomerUpdate(new Date());console.log(\"\\u2705 Loaded \".concat(customersData.length,\" customers for real-time rolling recording\"));}catch(error){console.error('âŒ Error loading real-time customer data:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to load customer data: \".concat(errorMessage));}finally{setIsLoadingCustomers(false);}},[clearError,showError]);// Real-time customer data sync\nuseEffect(()=>{if(isDialogOpen){// Load data when dialog opens\nloadRealTimeCustomerData();// Set up real-time refresh interval\nconst refreshInterval=setInterval(()=>{console.log('ðŸ”„ Refreshing customer data for rolling recorder');loadRealTimeCustomerData();},CUSTOMER_REFRESH_INTERVAL);return()=>{clearInterval(refreshInterval);};}},[isDialogOpen,loadRealTimeCustomerData]);// Enhanced OCR processing with buy-in/buy-out extraction and venue detection\nconst processImageWithOCR=async imageData=>{setIsProcessingOCR(true);// Simulate OCR processing delay\nawait new Promise(resolve=>setTimeout(resolve,2000));// Mock OCR results - in a real implementation, this would call an actual OCR service\nconst mockOCRResult={id:\"ocr_\".concat(Date.now()),originalImageId:(uploadedImage===null||uploadedImage===void 0?void 0:uploadedImage.id)||'',extractedText:\"GAMING RECEIPT\\\\nOKADA MANILA CASINO\\\\nDate: 2024-01-15\\\\nTime: 14:30\\\\nCustomer: John Doe\\\\nTable: B-5\\\\nGame: Baccarat\\\\nRolling: $50,000\\\\nResult: -$1,500\\\\nBuy-in: $25,000\\\\nBuy-out: $22,000\\\\nVenue: Okada Manila Casino\\\\nStaff: Casino Floor\",confidence:0.94,extractedFields:{amount:\"50000\",winLoss:\"-1500\",buyIn:\"25000\",buyOut:\"22000\",date:\"2024-01-15\",time:\"14:30\",venue:\"Okada Manila Casino\",gameType:\"Baccarat\",tableNumber:\"B-5\",customerName:\"John Doe\"},processedAt:new Date().toISOString(),ocrEngine:'enhanced-staff-ocr-engine'};setIsProcessingOCR(false);return mockOCRResult;};const handleImageUpload=async event=>{var _event$target$files;const file=(_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files[0];if(!file)return;// Convert file to base64\nconst reader=new FileReader();reader.onload=async e=>{var _e$target;const base64Data=(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.result;const attachment={id:\"img_\".concat(Date.now()),name:file.name,size:file.size,type:file.type,data:base64Data,uploadedAt:new Date().toISOString(),uploadedBy:user.id};setUploadedImage(attachment);// Process with enhanced OCR\ntry{const ocrResult=await processImageWithOCR(base64Data);setOcrResults(ocrResult);// Auto-fill form with OCR results including buy-in/buy-out and venue\nif(ocrResult.extractedFields){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{rollingAmount:ocrResult.extractedFields.amount||prev.rollingAmount,winLoss:ocrResult.extractedFields.winLoss||prev.winLoss,buyInAmount:ocrResult.extractedFields.buyIn||prev.buyInAmount,buyOutAmount:ocrResult.extractedFields.buyOut||prev.buyOutAmount,gameType:ocrResult.extractedFields.gameType||prev.gameType,// Match OCR venue to available options, default to Okada Manila Casino\nvenue:CASINO_VENUES.find(v=>{var _ocrResult$extractedF;return(_ocrResult$extractedF=ocrResult.extractedFields.venue)===null||_ocrResult$extractedF===void 0?void 0:_ocrResult$extractedF.toLowerCase().includes(v.toLowerCase());})||prev.venue,tableNumber:ocrResult.extractedFields.tableNumber||prev.tableNumber,sessionStartTime:ocrResult.extractedFields.date&&ocrResult.extractedFields.time?\"\".concat(ocrResult.extractedFields.date,\"T\").concat(ocrResult.extractedFields.time):prev.sessionStartTime}));// Try to match customer name if provided\nif(ocrResult.extractedFields.customerName){const matchedCustomer=customers.find(c=>c.name.toLowerCase().includes(ocrResult.extractedFields.customerName.toLowerCase())||ocrResult.extractedFields.customerName.toLowerCase().includes(c.name.toLowerCase()));if(matchedCustomer){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{customerId:matchedCustomer.id}));}}}setShowManualEntry(false);}catch(error){console.error('OCR processing failed:',error);showError('OCR processing failed. Please enter the data manually.');}};reader.readAsDataURL(file);};const handleSaveRecord=async()=>{const selectedCustomer=customers.find(c=>c.id===formData.customerId);if(!selectedCustomer){showError('Please select a customer');return;}// Validate required buy-in/buy-out for admin authority\nif(user.role==='admin'||user.role==='staff'){if(!formData.buyInAmount&&!formData.buyOutAmount){showError('Buy-in or buy-out amount is required for admin oversight');return;}}try{var _currentStaff$current;setIsSaving(true);clearError();const now=new Date().toISOString();const rollingAmount=parseFloat(formData.rollingAmount)||0;const winLoss=parseFloat(formData.winLoss)||0;const buyInAmount=parseFloat(formData.buyInAmount)||0;const buyOutAmount=parseFloat(formData.buyOutAmount)||0;// Create rolling record\nconst newRecord={id:\"rolling_\".concat(Date.now()),customerId:selectedCustomer.id,customerName:selectedCustomer.name,agentId:selectedCustomer.agentId,agentName:selectedCustomer.agentName,staffId:currentStaff.id,staffName:currentStaff.name,rollingAmount,winLoss,buyInAmount,buyOutAmount,gameType:formData.gameType,venue:formData.venue,// Now from dropdown selection\ntableNumber:formData.tableNumber,sessionStartTime:formData.sessionStartTime,sessionEndTime:formData.sessionEndTime,recordedAt:now,notes:formData.notes,attachments:uploadedImage?[uploadedImage]:[],ocrData:ocrResults||undefined,verified:false,shiftId:(_currentStaff$current=currentStaff.currentShift)===null||_currentStaff$current===void 0?void 0:_currentStaff$current.id};// Create buy-in/buy-out records if amounts are provided\nconst buyInOutRecords=[];if(buyInAmount>0){var _currentStaff$current2;buyInOutRecords.push({id:\"buyin_\".concat(Date.now()),customerId:selectedCustomer.id,customerName:selectedCustomer.name,staffId:currentStaff.id,staffName:currentStaff.name,transactionType:'buy-in',amount:buyInAmount,timestamp:now,venue:formData.venue,tableNumber:formData.tableNumber,notes:formData.notes,proofPhoto:uploadedImage||undefined,shiftId:(_currentStaff$current2=currentStaff.currentShift)===null||_currentStaff$current2===void 0?void 0:_currentStaff$current2.id,tripId:undefined// Could be linked to a trip later\n});}if(buyOutAmount>0){var _currentStaff$current3;buyInOutRecords.push({id:\"buyout_\".concat(Date.now(),\"_1\"),customerId:selectedCustomer.id,customerName:selectedCustomer.name,staffId:currentStaff.id,staffName:currentStaff.name,transactionType:'buy-out',amount:buyOutAmount,timestamp:now,venue:formData.venue,tableNumber:formData.tableNumber,notes:formData.notes,proofPhoto:uploadedImage||undefined,shiftId:(_currentStaff$current3=currentStaff.currentShift)===null||_currentStaff$current3===void 0?void 0:_currentStaff$current3.id,tripId:undefined// Could be linked to a trip later\n});}console.log('ðŸ’¾ Saving rolling record and buy-in/buy-out data to Supabase...');// Get existing data from Supabase\nconst[existingRecords,existingCustomers,existingBuyInOutRecords]=await Promise.all([db.get('rolling_records',[]),db.get('customers',[]),db.get('buy_in_out_records',[])]);// Update rolling records\nconst updatedRecords=[...existingRecords,newRecord];// Update buy-in/buy-out records\nconst updatedBuyInOutRecords=[...existingBuyInOutRecords,...buyInOutRecords];// Update customer totals with new data\nconst updatedCustomers=existingCustomers.map(c=>c.id===selectedCustomer.id?_objectSpread(_objectSpread({},c),{},{totalRolling:(c.totalRolling||0)+rollingAmount,totalWinLoss:(c.totalWinLoss||0)+winLoss,totalBuyIn:(c.totalBuyIn||0)+buyInAmount,totalBuyOut:(c.totalBuyOut||0)+buyOutAmount}):c);// Save all updates to Supabase simultaneously\nawait Promise.all([db.save('rollingRecords',updatedRecords),db.save('customers',updatedCustomers),buyInOutRecords.length>0?db.save('buyInOutRecords',updatedBuyInOutRecords):Promise.resolve()]);console.log('âœ… Successfully saved rolling record and buy-in/buy-out data to Supabase');// Refresh customer data immediately after saving\nawait loadRealTimeCustomerData();// Call the callback if provided\nonRecordSaved===null||onRecordSaved===void 0?void 0:onRecordSaved(newRecord);// Reset form\nsetFormData({customerId:'',rollingAmount:'',winLoss:'',buyInAmount:'',buyOutAmount:'',gameType:'',venue:'Okada Manila Casino',// Reset to default\ntableNumber:'',sessionStartTime:'',sessionEndTime:'',notes:''});setUploadedImage(null);setOcrResults(null);setShowManualEntry(true);setIsDialogOpen(false);}catch(error){console.error('âŒ Failed to save rolling record:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to save rolling record: \".concat(errorMessage));}finally{setIsSaving(false);}};const isFormValid=()=>{const basicValid=formData.customerId&&formData.rollingAmount&&formData.gameType&&formData.sessionStartTime;// For admin users, require buy-in or buy-out\nif(user.role==='admin'||user.role==='staff'){return basicValid&&(formData.buyInAmount||formData.buyOutAmount);}return basicValid;};// Filter active customers\nconst activeCustomers=customers.filter(c=>c.isActive);return/*#__PURE__*/_jsxs(Dialog,{open:isDialogOpen,onOpenChange:setIsDialogOpen,children:[/*#__PURE__*/_jsx(DialogTrigger,{asChild:true,children:/*#__PURE__*/_jsxs(Button,{className:\"flex items-center space-x-2\",disabled:isSaving,children:[/*#__PURE__*/_jsx(Receipt,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Record Rolling\"})]})}),/*#__PURE__*/_jsxs(DialogContent,{className:\"max-w-5xl max-h-[95vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsxs(DialogTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Receipt,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Record Customer Rolling Amount\"}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-blue-50 text-blue-700 border-blue-200\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-3 h-3 mr-1\"}),\"Casino Selection Available\"]})]}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Record rolling amounts with mandatory buy-in/buy-out tracking for admin oversight. Select from available casino venues with real-time customer data and OCR receipt processing.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-green-50 border border-green-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Database,{className:\"w-4 h-4 text-green-600 mr-2\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-green-800\",children:\"\\u2705 Real-time Data Connected to Supabase\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-green-600\",children:[\"Rolling records and buy-in/buy-out data immediately saved to cloud database\",lastCustomerUpdate&&\" \\u2022 Last customer sync: \".concat(lastCustomerUpdate.toLocaleTimeString())]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[isSaving&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-blue-600\",children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-1 animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Saving...\"})]}),isLoadingCustomers&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-orange-600\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-4 h-4 mr-1 animate-spin\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Syncing...\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:loadRealTimeCustomerData,disabled:isSaving||isLoadingCustomers,className:\"text-xs\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Refresh\"]})]})]})}),/*#__PURE__*/_jsxs(Alert,{children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(AlertDescription,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Recording as: \",/*#__PURE__*/_jsx(\"strong\",{children:currentStaff.name}),\" (\",currentStaff.position,\")\"]}),currentStaff.currentShift&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Shift: \",currentStaff.currentShift.shiftDate,\" | Started: \",new Date(currentStaff.currentShift.checkInTime).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[(user.role==='admin'||user.role==='staff')&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-red-50 text-red-700 border-red-200\",children:[/*#__PURE__*/_jsx(ShieldCheck,{className:\"w-3 h-3 mr-1\"}),\"Admin Authority Required\"]}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-3 h-3 mr-1\"}),\"Multiple Venues\"]})]})]})})]}),(user.role==='admin'||user.role==='staff')&&/*#__PURE__*/_jsxs(Alert,{className:\"border-red-200 bg-red-50\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsxs(AlertDescription,{className:\"text-red-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Admin Oversight Required:\"}),\" Buy-in or buy-out amount is mandatory for all rolling records. This ensures complete financial tracking and regulatory compliance.\"]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Camera,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Receipt/Photo Upload\"}),/*#__PURE__*/_jsx(Badge,{variant:\"secondary\",className:\"text-xs\",children:\"Enhanced OCR\"})]}),/*#__PURE__*/_jsx(CardDescription,{children:\"Upload receipts for automatic extraction of rolling amounts, buy-in/buy-out, venue, and transaction details\"})]}),/*#__PURE__*/_jsxs(CardContent,{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row gap-3\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:()=>{var _cameraInputRef$curre;return(_cameraInputRef$curre=cameraInputRef.current)===null||_cameraInputRef$curre===void 0?void 0:_cameraInputRef$curre.click();},className:\"flex items-center space-x-2\",disabled:isSaving,children:[/*#__PURE__*/_jsx(Camera,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Take Photo\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},className:\"flex items-center space-x-2\",disabled:isSaving,children:[/*#__PURE__*/_jsx(Upload,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Upload Image\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:()=>setShowManualEntry(!showManualEntry),className:\"flex items-center space-x-2\",disabled:isSaving,children:[showManualEntry?/*#__PURE__*/_jsx(EyeOff,{className:\"w-4 h-4\"}):/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[showManualEntry?'Hide':'Show',\" Manual Entry\"]})]})]}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\"image/*\",onChange:handleImageUpload,className:\"hidden\",disabled:isSaving}),/*#__PURE__*/_jsx(\"input\",{ref:cameraInputRef,type:\"file\",accept:\"image/*\",capture:\"environment\",onChange:handleImageUpload,className:\"hidden\",disabled:isSaving}),isProcessingOCR&&/*#__PURE__*/_jsxs(Alert,{children:[/*#__PURE__*/_jsx(Loader2,{className:\"w-4 h-4 animate-spin\"}),/*#__PURE__*/_jsx(AlertDescription,{children:\"Processing receipt with enhanced OCR (including buy-in/buy-out and venue detection)... Please wait.\"})]}),ocrResults&&/*#__PURE__*/_jsxs(Alert,{children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(AlertDescription,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Enhanced text extraction completed with \",Math.round(ocrResults.confidence*100),\"% confidence\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2 text-xs\",children:[ocrResults.extractedFields.amount&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",children:[\"Rolling: $\",ocrResults.extractedFields.amount]}),ocrResults.extractedFields.buyIn&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-blue-50 text-blue-700\",children:[\"Buy-in: $\",ocrResults.extractedFields.buyIn]}),ocrResults.extractedFields.buyOut&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-purple-50 text-purple-700\",children:[\"Buy-out: $\",ocrResults.extractedFields.buyOut]}),ocrResults.extractedFields.venue&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-green-50 text-green-700\",children:[\"Venue: \",ocrResults.extractedFields.venue]})]})]})})]}),uploadedImage&&/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"Uploaded Receipt\"}),/*#__PURE__*/_jsx(Badge,{variant:\"secondary\",children:uploadedImage.name})]}),/*#__PURE__*/_jsx(\"img\",{src:uploadedImage.data,alt:\"Uploaded receipt\",className:\"max-h-48 w-auto rounded border\"})]})]})]}),showManualEntry&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Rolling & Cash Flow Details\"}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-red-50 text-red-700 border-red-200\",children:[/*#__PURE__*/_jsx(Lock,{className:\"w-3 h-3 mr-1\"}),\"Buy-in/Buy-out Required\"]})]}),/*#__PURE__*/_jsx(CardDescription,{children:ocrResults?'Review and edit the extracted information':'Enter complete transaction details including venue selection and buy-in/buy-out amounts'})]}),/*#__PURE__*/_jsxs(CardContent,{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"customer\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Customer *\"}),isLoadingCustomers&&/*#__PURE__*/_jsx(Activity,{className:\"w-3 h-3 animate-pulse text-blue-500\"})]}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs\",children:[activeCustomers.length,\" active customers\"]})]}),/*#__PURE__*/_jsxs(Select,{value:formData.customerId,onValueChange:value=>setFormData(_objectSpread(_objectSpread({},formData),{},{customerId:value})),disabled:isSaving||isLoadingCustomers,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select customer (real-time data)\"})}),/*#__PURE__*/_jsx(SelectContent,{children:activeCustomers.map(customer=>/*#__PURE__*/_jsx(SelectItem,{value:customer.id,children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between w-full\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[customer.name,\" (\",customer.agentName,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-xs text-gray-500 ml-4\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Rolling: $\",(customer.totalRolling||0).toLocaleString()]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Rate: \",customer.rollingPercentage,\"%\"]})]})]})},customer.id))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"rollingAmount\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(DollarSign,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Rolling Amount (HKD) *\"})]}),/*#__PURE__*/_jsx(Input,{id:\"rollingAmount\",type:\"number\",value:formData.rollingAmount,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{rollingAmount:e.target.value})),placeholder:\"50000\",required:true,disabled:isSaving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"winLoss\",children:\"Win/Loss Amount (HKD)\"}),/*#__PURE__*/_jsx(Input,{id:\"winLoss\",type:\"number\",value:formData.winLoss,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{winLoss:e.target.value})),placeholder:\"-1500 (negative for loss)\",disabled:isSaving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"gameType\",children:\"Game Type *\"}),/*#__PURE__*/_jsxs(Select,{value:formData.gameType,onValueChange:value=>setFormData(_objectSpread(_objectSpread({},formData),{},{gameType:value})),disabled:isSaving,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select game type\"})}),/*#__PURE__*/_jsx(SelectContent,{children:gameTypes.length>0?gameTypes.filter(g=>g.isActive).map(game=>/*#__PURE__*/_jsx(SelectItem,{value:game.name,children:game.name},game.id)):/*#__PURE__*/// Default game types for Philippine casinos\n_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"Baccarat\",children:\"Baccarat\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Blackjack\",children:\"Blackjack\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Roulette\",children:\"Roulette\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Poker\",children:\"Poker\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Dragon Tiger\",children:\"Dragon Tiger\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"Sic Bo\",children:\"Sic Bo\"})]})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-red-50 border border-red-200 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-3\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-red-800\",children:\"Cash Flow Tracking (Required)\"}),/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"bg-red-100 text-red-700\",children:\"Admin Oversight\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"buyInAmount\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(ArrowDownCircle,{className:\"w-4 h-4 text-blue-500\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Buy-in Amount (HKD) \",user.role==='admin'||user.role==='staff'?'*':'']})]}),/*#__PURE__*/_jsx(Input,{id:\"buyInAmount\",type:\"number\",value:formData.buyInAmount,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{buyInAmount:e.target.value})),placeholder:\"25000\",required:user.role==='admin'||user.role==='staff',disabled:isSaving}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-600 mt-1\",children:\"Customer deposit/chips purchased\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"buyOutAmount\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(ArrowUpCircle,{className:\"w-4 h-4 text-purple-500\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Buy-Out Amount (HKD) \",user.role==='admin'||user.role==='staff'?'*':'']})]}),/*#__PURE__*/_jsx(Input,{id:\"buyOutAmount\",type:\"number\",value:formData.buyOutAmount,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{buyOutAmount:e.target.value})),placeholder:\"22000\",required:user.role==='admin'||user.role==='staff',disabled:isSaving}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-purple-600 mt-1\",children:\"Customer withdrawal/chips cashed out\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 p-2 bg-red-100 rounded text-xs text-red-700\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" At least one cash flow amount (buy-in or buy-out) must be provided for complete financial tracking and admin oversight.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"venue\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Casino Venue *\"})]}),/*#__PURE__*/_jsxs(Select,{value:formData.venue,onValueChange:value=>setFormData(_objectSpread(_objectSpread({},formData),{},{venue:value})),disabled:isSaving,children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select casino venue\"})}),/*#__PURE__*/_jsx(SelectContent,{children:CASINO_VENUES.map(venue=>/*#__PURE__*/_jsx(SelectItem,{value:venue,children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:venue}),venue==='Okada Manila Casino'&&/*#__PURE__*/_jsx(Badge,{variant:\"secondary\",className:\"text-xs ml-2\",children:\"Default\"})]})},venue))})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Select from available casino venues\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"tableNumber\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Hash,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Table Number\"})]}),/*#__PURE__*/_jsx(Input,{id:\"tableNumber\",value:formData.tableNumber,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{tableNumber:e.target.value})),placeholder:\"B-5\",disabled:isSaving})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-end\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full\",children:[/*#__PURE__*/_jsx(Label,{className:\"text-xs text-gray-500\",children:\"Net Cash Flow\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 p-2 bg-gray-50 border rounded\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium \".concat((parseFloat(formData.buyOutAmount)||0)-(parseFloat(formData.buyInAmount)||0)>=0?'text-green-600':'text-red-600'),children:[\"$\",((parseFloat(formData.buyOutAmount)||0)-(parseFloat(formData.buyInAmount)||0)).toLocaleString()]})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Buy-out - Buy-in\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"sessionStartTime\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Calendar,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Session Start *\"})]}),/*#__PURE__*/_jsx(Input,{id:\"sessionStartTime\",type:\"datetime-local\",value:formData.sessionStartTime,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{sessionStartTime:e.target.value})),required:true,disabled:isSaving})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"sessionEndTime\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Session End\"})]}),/*#__PURE__*/_jsx(Input,{id:\"sessionEndTime\",type:\"datetime-local\",value:formData.sessionEndTime,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{sessionEndTime:e.target.value})),disabled:isSaving})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"notes\",children:\"Notes\"}),/*#__PURE__*/_jsx(Textarea,{id:\"notes\",value:formData.notes,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{notes:e.target.value})),placeholder:\"Additional notes about this gaming session, venue details, buy-in/buy-out information...\",rows:3,disabled:isSaving})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>setIsDialogOpen(false),disabled:isSaving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSaveRecord,disabled:!isFormValid()||isProcessingOCR||isSaving,className:\"flex items-center space-x-2\",children:isSaving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 animate-spin\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Saving to Supabase...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Save Complete Record\"})]})})]})]})]})]});}// Export with error handler wrapper\nexport const StaffRollingRecorder=withErrorHandler(StaffRollingRecorderComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}