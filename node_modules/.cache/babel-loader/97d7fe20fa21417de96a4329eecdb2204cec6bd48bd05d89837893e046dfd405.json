{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Button}from'./ui/button';import{Input}from'./ui/input';import{Label}from'./ui/label';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Dialog,DialogContent,DialogDescription,DialogHeader,DialogTitle,DialogTrigger}from'./ui/dialog';import{AlertDialog,AlertDialogAction,AlertDialogCancel,AlertDialogContent,AlertDialogDescription,AlertDialogFooter,AlertDialogHeader,AlertDialogTitle,AlertDialogTrigger}from'./ui/alert-dialog';import{Badge}from'./ui/badge';import{Tabs,TabsContent,TabsList,TabsTrigger}from'./ui/tabs';import{Collapsible,CollapsibleContent,CollapsibleTrigger}from'./ui/collapsible';import{Textarea}from'./ui/textarea';import{FileUpload}from'./FileUpload';import{withErrorHandler}from'./withErrorHandler';import{Plus,Edit,Mail,Phone,Paperclip,ChevronDown,ChevronUp,Save,Eye,UserPlus,Key,EyeOff,LogIn,LogOut,Clock,RefreshCw,CheckCircle,Shield}from'lucide-react';import{ImageWithFallback}from'./figma/ImageWithFallback';import{apiClient}from'../utils/api/apiClient';import{isReadOnlyRole,canViewFinancialData}from'../utils/permissions';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function StaffManagementComponent(_ref){let{user,showError,clearError}=_ref;const isReadOnly=isReadOnlyRole(user.role);const canSeeFinancials=canViewFinancialData(user.role);const[staff,setStaff]=useState([]);const[isDialogOpen,setIsDialogOpen]=useState(false);const[isLoginDialogOpen,setIsLoginDialogOpen]=useState(false);const[isCheckInDialogOpen,setIsCheckInDialogOpen]=useState(false);const[isCheckOutDialogOpen,setIsCheckOutDialogOpen]=useState(false);const[editingStaff,setEditingStaff]=useState(null);const[managingLoginStaff,setManagingLoginStaff]=useState(null);const[checkingInStaff,setCheckingInStaff]=useState(null);const[checkingOutStaff,setCheckingOutStaff]=useState(null);const[expandedStaff,setExpandedStaff]=useState(null);const[checkInPhoto,setCheckInPhoto]=useState(null);const[checkOutPhoto,setCheckOutPhoto]=useState(null);const[checkInNotes,setCheckInNotes]=useState('');const[checkOutNotes,setCheckOutNotes]=useState('');const[showPassword,setShowPassword]=useState(false);const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[staffShifts,setStaffShifts]=useState({});const[loadingShifts,setLoadingShifts]=useState({});const[formData,setFormData]=useState({name:'',email:'',phone:'',position:'',username:'',password:''});const[loginFormData,setLoginFormData]=useState({username:'',password:'',confirmPassword:''});const loadStaffShifts=useCallback(async staffId=>{if(loadingShifts[staffId]||staffShifts[staffId])return;try{setLoadingShifts(prev=>_objectSpread(_objectSpread({},prev),{},{[staffId]:true}));const shiftsResponse=await apiClient.get(\"/staffs/\".concat(staffId,\"/shifts\"));if(shiftsResponse.success){setStaffShifts(prev=>_objectSpread(_objectSpread({},prev),{},{[staffId]:shiftsResponse.data||[]}));}}catch(error){console.error('âŒ Error loading staff shifts:',error);}finally{setLoadingShifts(prev=>_objectSpread(_objectSpread({},prev),{},{[staffId]:false}));}},[loadingShifts,staffShifts]);const loadAllData=useCallback(async()=>{try{var _staffResponse$data;setLoading(true);clearError();console.log('ðŸ”„ Loading staff data from API...');// Load staff data from new API\nconst staffResponse=await apiClient.getStaffs();if(!staffResponse.success){throw new Error(staffResponse.error||'Failed to load staff data');}const processedStaff=((_staffResponse$data=staffResponse.data)===null||_staffResponse$data===void 0?void 0:_staffResponse$data.map(member=>({id:member.id,name:member.name,email:member.email,phone:member.phone,position:member.position,status:member.status,attachments:member.attachments||[],created_at:member.created_at,updated_at:member.updated_at,username:member.username,user_id:member.user_id,user_status:member.user_status,current_shift:member.current_shift||[]})))||[];setStaff(processedStaff);console.log(\"\\u2705 Loaded \".concat(processedStaff.length,\" staff members from API\"));}catch(error){console.error('âŒ Error loading staff data:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to load staff data: \".concat(errorMessage));}finally{setLoading(false);}},[clearError,showError]);useEffect(()=>{loadAllData();},[loadAllData]);// Remove syncStaffWithUsers as it's no longer needed with new API architecture\n// Remove saveStaffToSupabase as we now use individual API calls\n// Remove saveStaffAccountsToSupabase as accounts are now managed via API\n// Remove syncStaffAccountsWithUsers as it's handled by the backend API\n// Remove saveShiftsToSupabase as shifts are managed via API\nconst handleSubmit=async e=>{e.preventDefault();try{setSaving(true);clearError();// Validate required fields\nif(!formData.name||!formData.email||!formData.phone||!formData.position){throw new Error('Name, email, phone, position are required');}// For new staff, also validate username and password\nif(!editingStaff&&(!formData.username||!formData.password)){throw new Error('Username and password are required for new staff');}if(editingStaff){// Update existing staff\nconst updateData={name:formData.name,email:formData.email,phone:formData.phone,position:formData.position};console.log('Updating staff with data:',updateData);const response=await apiClient.updateStaff(editingStaff.id,updateData);if(!response.success){throw new Error(response.error||'Failed to update staff member');}}else{// Create new staff with login credentials\nconst staffData={name:formData.name,email:formData.email,phone:formData.phone,position:formData.position,username:formData.username,password:formData.password};console.log('Creating new staff with data:',_objectSpread(_objectSpread({},staffData),{},{password:'***'}));const response=await apiClient.createStaff(staffData);if(!response.success){throw new Error(response.error||'Failed to create staff member');}}// Reload data to get updated information\nawait loadAllData();resetForm();}catch(error){console.error('âŒ Error saving staff:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to save staff: \".concat(errorMessage));}finally{setSaving(false);}};const handleLoginSubmit=async e=>{e.preventDefault();if(!managingLoginStaff)return;if(loginFormData.password!==loginFormData.confirmPassword){showError('Passwords do not match!');return;}try{setSaving(true);clearError();// Update staff with new login credentials\nconst updateData={username:loginFormData.username,password:loginFormData.password};const response=await apiClient.updateStaff(managingLoginStaff.id,updateData);if(!response.success){throw new Error(response.error||'Failed to update login credentials');}// Reload data to get updated information\nawait loadAllData();resetLoginForm();}catch(error){console.error('âŒ Error updating login credentials:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to update login credentials: \".concat(errorMessage));}finally{setSaving(false);}};const resetForm=()=>{setFormData({name:'',email:'',phone:'',position:'',username:'',password:''});setEditingStaff(null);setIsDialogOpen(false);};const resetLoginForm=()=>{setLoginFormData({username:'',password:'',confirmPassword:''});setManagingLoginStaff(null);setIsLoginDialogOpen(false);setShowPassword(false);};const handleEdit=staffMember=>{setEditingStaff(staffMember);setFormData({name:staffMember.name,email:staffMember.email,phone:staffMember.phone,position:staffMember.position,username:staffMember.username||'',password:''});setIsDialogOpen(true);};const handleManageLogin=staffMember=>{setManagingLoginStaff(staffMember);setLoginFormData({username:staffMember.username||'',password:'',confirmPassword:''});setIsLoginDialogOpen(true);};const deleteStaff=async staffId=>{try{setSaving(true);clearError();const response=await apiClient.deleteStaff(staffId);if(!response.success){throw new Error(response.error||'Failed to delete staff member');}// Reload data to get updated information\nawait loadAllData();}catch(error){console.error('âŒ Error deleting staff:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to delete staff: \".concat(errorMessage));}finally{setSaving(false);}};const toggleStaffExpansion=staffId=>{setExpandedStaff(expandedStaff===staffId?null:staffId);};const toggleStaffStatus=async staffId=>{try{setSaving(true);clearError();const staffMember=staff.find(s=>s.id===staffId);if(!staffMember)return;const newStatus=staffMember.status==='active'?'inactive':'active';const response=await apiClient.updateStaff(staffId,{status:newStatus});if(!response.success){throw new Error(response.error||'Failed to update staff status');}// Reload data to get updated information\nawait loadAllData();}catch(error){console.error('âŒ Error updating staff status:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to update staff status: \".concat(errorMessage));}finally{setSaving(false);}};const openCheckInDialog=staffMember=>{setCheckingInStaff(staffMember);setCheckInPhoto(null);setCheckInNotes('');setIsCheckInDialogOpen(true);};const openCheckOutDialog=staffMember=>{setCheckingOutStaff(staffMember);setCheckOutPhoto(null);setCheckOutNotes('');setIsCheckOutDialogOpen(true);};const handleCheckIn=async()=>{if(!checkingInStaff||!checkInPhoto)return;try{setSaving(true);clearError();const reader=new FileReader();reader.onload=async e=>{try{var _e$target;const checkInData={check_in_photo:(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.result,notes:checkInNotes};const response=await apiClient.staffCheckIn(checkingInStaff.id,checkInData);if(!response.success){throw new Error(response.error||'Failed to check in staff member');}// Reload data to get updated information\nawait loadAllData();setIsCheckInDialogOpen(false);setCheckingInStaff(null);setCheckInPhoto(null);setCheckInNotes('');}catch(error){console.error('âŒ Error processing check-in:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to process check-in: \".concat(errorMessage));}finally{setSaving(false);}};reader.readAsDataURL(checkInPhoto);}catch(error){console.error('âŒ Error during check-in:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Check-in failed: \".concat(errorMessage));setSaving(false);}};const handleCheckOut=async()=>{if(!checkingOutStaff||!checkOutPhoto)return;try{setSaving(true);clearError();const reader=new FileReader();reader.onload=async e=>{try{var _e$target2;const checkOutData={check_out_photo:(_e$target2=e.target)===null||_e$target2===void 0?void 0:_e$target2.result,notes:checkOutNotes};const response=await apiClient.staffCheckOut(checkingOutStaff.id,checkOutData);if(!response.success){throw new Error(response.error||'Failed to check out staff member');}// Reload data to get updated information\nawait loadAllData();setIsCheckOutDialogOpen(false);setCheckingOutStaff(null);setCheckOutPhoto(null);setCheckOutNotes('');}catch(error){console.error('âŒ Error processing check-out:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to process check-out: \".concat(errorMessage));}finally{setSaving(false);}};reader.readAsDataURL(checkOutPhoto);}catch(error){console.error('âŒ Error during check-out:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Check-out failed: \".concat(errorMessage));setSaving(false);}};// const getStaffShifts = async (staffId: string) => {\n//   try {\n//     const response = await apiClient.getStaffShifts(staffId);\n//     if (response.success) {\n//       return response.data || [];\n//     }\n//     return [];\n//   } catch (error) {\n//     console.error('âŒ Error fetching staff shifts:', error);\n//     return [];\n//   }\n// };\nconst isStaffCheckedIn=staffMember=>{return staffMember.current_shift&&staffMember.current_shift.length>0&&staffMember.current_shift[0].status==='checked-in';};const updateStaffAttachments=async(staffId,attachments)=>{try{setSaving(true);clearError();const response=await apiClient.updateStaff(staffId,{attachments});if(!response.success){throw new Error(response.error||'Failed to update staff attachments');}// Reload data to get updated information\nawait loadAllData();}catch(error){console.error('âŒ Error updating staff attachments:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to update staff attachments: \".concat(errorMessage));}finally{setSaving(false);}};const getStaffAccount=staffId=>{const staffMember=staff.find(s=>s.id===staffId);return staffMember?{username:staffMember.username,user_id:staffMember.user_id,user_status:staffMember.user_status}:null;};const generatePassword=()=>{const chars='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';let password='';for(let i=0;i<8;i++){password+=chars.charAt(Math.floor(Math.random()*chars.length));}setLoginFormData(_objectSpread(_objectSpread({},loginFormData),{},{password:password,confirmPassword:password}));};// Show loading state\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Loading staff data from Supabase...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Staff Management\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Manage casino staff, their login credentials, and shift tracking with photo verification\"})]}),!isReadOnly&&/*#__PURE__*/_jsxs(Dialog,{open:isDialogOpen,onOpenChange:setIsDialogOpen,children:[/*#__PURE__*/_jsx(DialogTrigger,{asChild:true,children:/*#__PURE__*/_jsxs(Button,{onClick:()=>setIsDialogOpen(true),disabled:saving,children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add Staff\"]})}),/*#__PURE__*/_jsxs(DialogContent,{className:\"max-w-2xl\",children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:editingStaff?'Edit Staff Member':'Add New Staff Member'}),/*#__PURE__*/_jsx(DialogDescription,{children:editingStaff?'Update staff information':'Add a new staff member to the system'})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"name\",className:\"flex items-center\",children:[\"Name \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 ml-1\",children:\"*\"})]}),/*#__PURE__*/_jsx(Input,{id:\"name\",value:formData.name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{name:e.target.value})),placeholder:\"Staff member name\",required:true,disabled:saving,className:!formData.name?\"border-red-300\":\"\"}),!formData.name&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Name is required\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"position\",className:\"flex items-center\",children:[\"Position \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 ml-1\",children:\"*\"})]}),/*#__PURE__*/_jsx(Input,{id:\"position\",value:formData.position,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{position:e.target.value})),placeholder:\"Floor Manager, Cashier, etc.\",required:true,disabled:saving,className:!formData.position?\"border-red-300\":\"\"}),!formData.position&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Position is required\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"email\",className:\"flex items-center\",children:[\"Email \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 ml-1\",children:\"*\"})]}),/*#__PURE__*/_jsx(Input,{id:\"email\",type:\"email\",value:formData.email,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{email:e.target.value})),placeholder:\"staff@casino.com\",required:true,disabled:saving,className:!formData.email?\"border-red-300\":\"\"}),!formData.email&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Email is required\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"phone\",className:\"flex items-center\",children:[\"Phone \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 ml-1\",children:\"*\"})]}),/*#__PURE__*/_jsx(Input,{id:\"phone\",value:formData.phone,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{phone:e.target.value})),placeholder:\"+1234567890\",required:true,disabled:saving,className:!formData.phone?\"border-red-300\":\"\"}),!formData.phone&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Phone is required\"})]})]}),!editingStaff&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"username\",className:\"flex items-center\",children:[\"Username \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 ml-1\",children:\"*\"})]}),/*#__PURE__*/_jsx(Input,{id:\"username\",value:formData.username,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{username:e.target.value})),placeholder:\"Login username\",required:true,disabled:saving,className:!formData.username?\"border-red-300\":\"\"}),!formData.username&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Username is required\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"password\",className:\"flex items-center\",children:[\"Password \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500 ml-1\",children:\"*\"})]}),/*#__PURE__*/_jsx(Input,{id:\"password\",type:\"password\",value:formData.password,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{password:e.target.value})),placeholder:\"Login password\",required:true,disabled:saving,className:!formData.password?\"border-red-300\":\"\"}),!formData.password&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Password is required\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-blue-50 border border-blue-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-blue-700\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" \",editingStaff?\"You can update login credentials separately using the 'Manage Login' button.\":\"All fields marked with * are required. Username and password are needed for staff login.\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>setIsDialogOpen(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:saving,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2 animate-spin\"}),\"Saving to Supabase...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[editingStaff?'Update':'Add',\" Staff Member\"]})})]})]})]})]})]}),!isReadOnly&&/*#__PURE__*/_jsx(Dialog,{open:isLoginDialogOpen,onOpenChange:setIsLoginDialogOpen,children:/*#__PURE__*/_jsxs(DialogContent,{className:\"max-w-lg\",children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsxs(DialogTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Key,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Manage Login - \",managingLoginStaff===null||managingLoginStaff===void 0?void 0:managingLoginStaff.name]})]}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Create or update login credentials for this staff member\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLoginSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"username\",children:\"Username\"}),/*#__PURE__*/_jsx(Input,{id:\"username\",value:loginFormData.username,onChange:e=>setLoginFormData(_objectSpread(_objectSpread({},loginFormData),{},{username:e.target.value})),placeholder:\"Enter username\",required:true,disabled:saving}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"This will be used to login to the staff portal\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"password\",children:\"Password\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(Input,{id:\"password\",type:showPassword?\"text\":\"password\",value:loginFormData.password,onChange:e=>setLoginFormData(_objectSpread(_objectSpread({},loginFormData),{},{password:e.target.value})),placeholder:\"Enter password\",required:true,disabled:saving}),/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"ghost\",size:\"sm\",className:\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\",onClick:()=>setShowPassword(!showPassword),disabled:saving,children:showPassword?/*#__PURE__*/_jsx(EyeOff,{className:\"w-4 h-4\"}):/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mt-1\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",size:\"sm\",onClick:generatePassword,className:\"text-xs\",disabled:saving,children:\"Generate Password\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Minimum 6 characters\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"confirmPassword\",children:\"Confirm Password\"}),/*#__PURE__*/_jsx(Input,{id:\"confirmPassword\",type:showPassword?\"text\":\"password\",value:loginFormData.confirmPassword,onChange:e=>setLoginFormData(_objectSpread(_objectSpread({},loginFormData),{},{confirmPassword:e.target.value})),placeholder:\"Confirm password\",required:true,disabled:saving})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-green-50 border border-green-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-green-700\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Security Note:\"}),\" Staff members can only login with the exact credentials you provide here. Make sure to securely communicate these credentials to the staff member.\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:resetLoginForm,disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:saving,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2 animate-spin\"}),\"Saving...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Key,{className:\"w-4 h-4 mr-2\"}),getStaffAccount((managingLoginStaff===null||managingLoginStaff===void 0?void 0:managingLoginStaff.id)||'')?'Update':'Create',\" Login\"]})})]})]})]})}),!isReadOnly&&/*#__PURE__*/_jsx(Dialog,{open:isCheckInDialogOpen,onOpenChange:setIsCheckInDialogOpen,children:/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsxs(DialogTitle,{children:[\"Check In: \",checkingInStaff===null||checkingInStaff===void 0?void 0:checkingInStaff.name]}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Upload a photo as proof of check-in and add any notes for the shift.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"checkInPhoto\",children:\"Check-in Photo (Required)\"}),/*#__PURE__*/_jsx(Input,{id:\"checkInPhoto\",type:\"file\",accept:\"image/*\",onChange:e=>{var _e$target$files;return setCheckInPhoto(((_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0])||null);},className:\"mt-1\",required:true,disabled:saving}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Take a photo as proof of check-in\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"checkInNotes\",children:\"Notes (Optional)\"}),/*#__PURE__*/_jsx(Textarea,{id:\"checkInNotes\",value:checkInNotes,onChange:e=>setCheckInNotes(e.target.value),placeholder:\"Any notes for this shift...\",rows:3,disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>setIsCheckInDialogOpen(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCheckIn,disabled:!checkInPhoto||saving,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2 animate-spin\"}),\"Checking In...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(LogIn,{className:\"w-4 h-4 mr-2\"}),\"Check In\"]})})]})]})]})}),!isReadOnly&&/*#__PURE__*/_jsx(Dialog,{open:isCheckOutDialogOpen,onOpenChange:setIsCheckOutDialogOpen,children:/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsxs(DialogTitle,{children:[\"Check Out: \",checkingOutStaff===null||checkingOutStaff===void 0?void 0:checkingOutStaff.name]}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Upload a photo as proof of check-out and add any end-of-shift notes.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"checkOutPhoto\",children:\"Check-out Photo (Required)\"}),/*#__PURE__*/_jsx(Input,{id:\"checkOutPhoto\",type:\"file\",accept:\"image/*\",onChange:e=>{var _e$target$files2;return setCheckOutPhoto(((_e$target$files2=e.target.files)===null||_e$target$files2===void 0?void 0:_e$target$files2[0])||null);},className:\"mt-1\",required:true,disabled:saving}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Take a photo as proof of check-out\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"checkOutNotes\",children:\"Notes (Optional)\"}),/*#__PURE__*/_jsx(Textarea,{id:\"checkOutNotes\",value:checkOutNotes,onChange:e=>setCheckOutNotes(e.target.value),placeholder:\"Any end-of-shift notes...\",rows:3,disabled:saving})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>setIsCheckOutDialogOpen(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCheckOut,disabled:!checkOutPhoto||saving,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Save,{className:\"w-4 h-4 mr-2 animate-spin\"}),\"Checking Out...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(LogOut,{className:\"w-4 h-4 mr-2\"}),\"Check Out\"]})})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-6\",children:staff.length===0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"text-center py-12\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No staff members found. Add your first staff member to get started.\"})})}):staff.map(staffMember=>{var _staffMember$current_,_staffMember$attachme;const isExpanded=expandedStaff===staffMember.id;const account=getStaffAccount(staffMember.id);const isCheckedIn=isStaffCheckedIn(staffMember);return/*#__PURE__*/_jsx(Collapsible,{open:isExpanded,onOpenChange:()=>toggleStaffExpansion(staffMember.id),children:/*#__PURE__*/_jsxs(Card,{className:\"overflow-hidden\",children:[/*#__PURE__*/_jsx(CollapsibleTrigger,{asChild:true,children:/*#__PURE__*/_jsx(CardHeader,{className:\"cursor-pointer hover:bg-gray-50 transition-colors\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:staffMember.name}),/*#__PURE__*/_jsx(Badge,{variant:staffMember.status==='active'?\"default\":\"secondary\",children:staffMember.status==='active'?'Active':'Inactive'}),isCheckedIn&&/*#__PURE__*/_jsxs(Badge,{variant:\"default\",className:\"bg-green-600\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-3 h-3 mr-1\"}),\"Checked In\"]}),account&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-blue-50 text-blue-700 border-blue-200\",children:[/*#__PURE__*/_jsx(Key,{className:\"w-3 h-3 mr-1\"}),\"Login Setup\"]}),staffMember.attachments&&staffMember.attachments.length>0&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-3 h-3\"}),/*#__PURE__*/_jsx(\"span\",{children:staffMember.attachments.length})]})]}),/*#__PURE__*/_jsxs(CardDescription,{children:[staffMember.position,\" \\u2022 Member since \",staffMember.created_at]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2\",children:isExpanded?/*#__PURE__*/_jsx(ChevronUp,{className:\"w-5 h-5 text-gray-400\"}):/*#__PURE__*/_jsx(ChevronDown,{className:\"w-5 h-5 text-gray-400\"})})]})})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Mail,{className:\"w-4 h-4 text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:staffMember.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Phone,{className:\"w-4 h-4 text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:staffMember.phone})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2 mb-4\",children:[!isReadOnly&&/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>handleEdit(staffMember),disabled:saving,children:[/*#__PURE__*/_jsx(Edit,{className:\"w-4 h-4 mr-2\"}),\"Edit\"]}),!isReadOnly&&/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>handleManageLogin(staffMember),disabled:saving,children:[/*#__PURE__*/_jsx(Key,{className:\"w-4 h-4 mr-2\"}),account?'Update Login':'Create Login']}),!isReadOnly&&(isCheckedIn?/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>openCheckOutDialog(staffMember),disabled:saving,children:[/*#__PURE__*/_jsx(LogOut,{className:\"w-4 h-4 mr-2\"}),\"Check Out\"]}):/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>openCheckInDialog(staffMember),disabled:saving,children:[/*#__PURE__*/_jsx(LogIn,{className:\"w-4 h-4 mr-2\"}),\"Check In\"]})),!isReadOnly&&/*#__PURE__*/_jsxs(AlertDialog,{children:[/*#__PURE__*/_jsx(AlertDialogTrigger,{asChild:true,children:/*#__PURE__*/_jsx(Button,{variant:\"destructive\",size:\"sm\",disabled:saving,className:\"bg-red-600 text-white hover:bg-red-700\",children:\"Delete\"})}),/*#__PURE__*/_jsxs(AlertDialogContent,{children:[/*#__PURE__*/_jsxs(AlertDialogHeader,{children:[/*#__PURE__*/_jsx(AlertDialogTitle,{children:\"Delete Staff Member\"}),/*#__PURE__*/_jsxs(AlertDialogDescription,{children:[\"Are you sure you want to permanently delete \\\"\",staffMember.name,\"\\\"? This action cannot be undone and will remove all their data, shift history, and login credentials from the system.\"]})]}),/*#__PURE__*/_jsxs(AlertDialogFooter,{children:[/*#__PURE__*/_jsx(AlertDialogCancel,{children:\"Cancel\"}),/*#__PURE__*/_jsx(AlertDialogAction,{onClick:()=>deleteStaff(staffMember.id),className:\"bg-destructive text-destructive-foreground hover:bg-destructive/90\",disabled:saving,children:saving?'Deleting...':'Delete Permanently'})]})]})]})]}),/*#__PURE__*/_jsx(CollapsibleContent,{className:\"mt-6\",children:/*#__PURE__*/_jsxs(Tabs,{defaultValue:\"info\",className:\"w-full\",children:[/*#__PURE__*/_jsxs(TabsList,{className:\"grid w-full grid-cols-4\",children:[/*#__PURE__*/_jsxs(TabsTrigger,{value:\"info\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Shield,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Info\"})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"shifts\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Shifts (\",((_staffMember$current_=staffMember.current_shift)===null||_staffMember$current_===void 0?void 0:_staffMember$current_.length)||0,\")\"]})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"login\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Key,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Login\"})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"files\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Files (\",((_staffMember$attachme=staffMember.attachments)===null||_staffMember$attachme===void 0?void 0:_staffMember$attachme.length)||0,\")\"]})]})]}),/*#__PURE__*/_jsx(TabsContent,{value:\"info\",className:\"space-y-4 mt-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Name\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg\",children:staffMember.name})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Email\"}),/*#__PURE__*/_jsx(\"p\",{children:staffMember.email})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Phone\"}),/*#__PURE__*/_jsx(\"p\",{children:staffMember.phone})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Position\"}),/*#__PURE__*/_jsx(\"p\",{children:staffMember.position})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Status\"}),/*#__PURE__*/_jsx(Badge,{variant:staffMember.status==='active'?\"default\":\"secondary\",children:staffMember.status==='active'?'Active':'Inactive'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Member Since\"}),/*#__PURE__*/_jsx(\"p\",{children:staffMember.created_at})]})]})]})}),/*#__PURE__*/_jsx(TabsContent,{value:\"shifts\",className:\"space-y-4 mt-6\",children:(()=>{// Load shifts when tab is accessed\nif(!staffShifts[staffMember.id]&&!loadingShifts[staffMember.id]){loadStaffShifts(staffMember.id);}const shifts=staffShifts[staffMember.id]||[];const isLoading=loadingShifts[staffMember.id];if(isLoading){return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-8 h-8 mx-auto text-gray-400 mb-4 animate-spin\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading shift history...\"})]})});}if(shifts.length===0){return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-12 h-12 mx-auto text-gray-400 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No shift history found.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400 mt-2\",children:\"Check-ins and check-outs will appear here.\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4 max-h-96 overflow-y-auto\",children:shifts.sort((a,b)=>new Date(b.check_in_time).getTime()-new Date(a.check_in_time).getTime()).map(shift=>/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-start mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Badge,{variant:shift.status==='checked-in'?'default':'secondary',children:shift.status==='checked-in'?'Active':'Completed'}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:new Date(shift.shift_date).toLocaleDateString()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(LogIn,{className:\"w-4 h-4 text-green-600\"}),/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium\",children:\"Check In\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:new Date(shift.check_in_time).toLocaleString()}),shift.check_in_photo&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(ImageWithFallback,{src:shift.check_in_photo,alt:\"Check-in photo\",className:\"w-20 h-20 object-cover rounded border cursor-pointer hover:opacity-80\",onClick:()=>window.open(shift.check_in_photo,'_blank')})})]}),shift.check_out_time&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(LogOut,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium\",children:\"Check Out\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:new Date(shift.check_out_time).toLocaleString()}),shift.check_out_photo&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(ImageWithFallback,{src:shift.check_out_photo,alt:\"Check-out photo\",className:\"w-20 h-20 object-cover rounded border cursor-pointer hover:opacity-80\",onClick:()=>window.open(shift.check_out_photo,'_blank')})})]})]}),shift.notes&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 p-2 bg-gray-50 rounded\",children:[/*#__PURE__*/_jsx(Label,{className:\"text-xs font-medium text-gray-500\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-700 mt-1\",children:shift.notes})]}),shift.check_out_time&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-xs text-gray-500\",children:[\"Duration: \",(()=>{const duration=new Date(shift.check_out_time).getTime()-new Date(shift.check_in_time).getTime();const hours=Math.floor(duration/(1000*60*60));const minutes=Math.floor(duration%(1000*60*60)/(1000*60));return\"\".concat(hours,\"h \").concat(minutes,\"m\");})()]})]})})})},shift.id))});})()}),/*#__PURE__*/_jsx(TabsContent,{value:\"login\",className:\"space-y-4 mt-6\",children:account?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Username\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:account.username})]}),/*#__PURE__*/_jsx(Badge,{variant:account.user_status==='active'?\"default\":\"secondary\",children:account.user_status==='active'?'Active':'Inactive'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Password\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-mono bg-gray-100 p-2 rounded\",children:\"\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Account Created\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:staffMember.created_at})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"User ID\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-mono\",children:account.user_id})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2 mt-4\",children:[!isReadOnly&&/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>handleManageLogin(staffMember),disabled:saving,children:[/*#__PURE__*/_jsx(Edit,{className:\"w-4 h-4 mr-2\"}),\"Update Credentials\"]}),!isReadOnly&&/*#__PURE__*/_jsxs(AlertDialog,{children:[/*#__PURE__*/_jsx(AlertDialogTrigger,{asChild:true,children:/*#__PURE__*/_jsx(Button,{variant:\"destructive\",size:\"sm\",disabled:saving,children:\"Delete Login\"})}),/*#__PURE__*/_jsxs(AlertDialogContent,{children:[/*#__PURE__*/_jsxs(AlertDialogHeader,{children:[/*#__PURE__*/_jsx(AlertDialogTitle,{children:\"Delete Login Account\"}),/*#__PURE__*/_jsxs(AlertDialogDescription,{children:[\"Are you sure you want to delete the login account for \\\"\",staffMember.name,\"\\\"? They will no longer be able to access the staff portal.\"]})]}),/*#__PURE__*/_jsxs(AlertDialogFooter,{children:[/*#__PURE__*/_jsx(AlertDialogCancel,{children:\"Cancel\"}),/*#__PURE__*/_jsx(AlertDialogAction,{onClick:()=>deleteStaff(staffMember.id),className:\"bg-destructive text-destructive-foreground hover:bg-destructive/90\",disabled:saving,children:saving?'Deleting...':'Delete Login'})]})]})]})]})]})}):/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(Key,{className:\"w-12 h-12 mx-auto text-gray-400 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-4\",children:\"No login credentials set up for this staff member.\"}),!isReadOnly&&/*#__PURE__*/_jsxs(Button,{onClick:()=>handleManageLogin(staffMember),disabled:saving,children:[/*#__PURE__*/_jsx(UserPlus,{className:\"w-4 h-4 mr-2\"}),\"Create Login Account\"]})]})})}),/*#__PURE__*/_jsxs(TabsContent,{value:\"files\",className:\"mt-6\",children:[!isReadOnly&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(FileUpload,{onUpload:newAttachments=>updateStaffAttachments(staffMember.id,[...(staffMember.attachments||[]),...newAttachments]),onAttachmentsChange:()=>{},disabled:saving})}),(()=>{// Load shifts when tab is accessed to get check-in/out photos\nif(!staffShifts[staffMember.id]&&!loadingShifts[staffMember.id]){loadStaffShifts(staffMember.id);}const shifts=staffShifts[staffMember.id]||[];const attachments=staffMember.attachments||[];// Collect all check-in/out photos from shifts\nconst shiftPhotos=[];shifts.forEach(shift=>{if(shift.check_in_photo){shiftPhotos.push({type:'Check-in Photo',photo:shift.check_in_photo,date:new Date(shift.check_in_time).toLocaleString(),shift_id:shift.id,timestamp:new Date(shift.check_in_time).getTime()});}if(shift.check_out_photo){shiftPhotos.push({type:'Check-out Photo',photo:shift.check_out_photo,date:new Date(shift.check_out_time).toLocaleString(),shift_id:shift.id,timestamp:new Date(shift.check_out_time).getTime()});}});// Sort photos by timestamp (newest first)\nshiftPhotos.sort((a,b)=>b.timestamp-a.timestamp);const hasFiles=attachments.length>0||shiftPhotos.length>0;if(!hasFiles){return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-12 h-12 mx-auto text-gray-400 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No files or photos found.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400 mt-2\",children:\"Upload documents or check-in/out photos will appear here.\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[shiftPhotos.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-4 h-4\"}),\"Check-in/out Photos (\",shiftPhotos.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:shiftPhotos.map((item,index)=>/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(Badge,{variant:item.type.includes('Check-in')?'default':'secondary',children:item.type}),/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4 text-gray-400\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"aspect-square relative\",children:/*#__PURE__*/_jsx(ImageWithFallback,{src:item.photo,alt:item.type,className:\"w-full h-full object-cover rounded border cursor-pointer hover:opacity-80\",onClick:()=>window.open(item.photo,'_blank')})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:item.date})})]})})},\"photo-\".concat(item.shift_id,\"-\").concat(index)))})]}),attachments.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-4 h-4\"}),\"Documents & Files (\",attachments.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:attachments.map((attachment,index)=>/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Paperclip,{className:\"w-4 h-4 text-gray-400\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium truncate\",children:attachment.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[attachment.size,\" bytes \\u2022 \",attachment.type]})]})]})})},\"attachment-\".concat(index)))})]})]});})()]})]})})]})]})},staffMember.id);})})]});}// Export with error handler wrapper\nexport const StaffManagement=withErrorHandler(StaffManagementComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}