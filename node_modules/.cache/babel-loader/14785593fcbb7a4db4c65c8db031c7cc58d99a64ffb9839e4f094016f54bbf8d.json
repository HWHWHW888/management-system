{"ast":null,"code":"import React,{useState}from'react';import{Button}from'./ui/button';import{Input}from'./ui/input';import{Label}from'./ui/label';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Alert,AlertDescription}from'./ui/alert';import{db}from'../utils/supabase/supabaseClients';import{db as databaseWrapper}from'../utils/api/databaseWrapper';import{AlertTriangle}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export function LoginForm(_ref){let{onLogin}=_ref;const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[isLoading,setIsLoading]=useState(false);const handleSubmit=async e=>{e.preventDefault();setError('');setIsLoading(true);try{console.log('ðŸ” Starting login process...');console.log('ðŸ‘¤ Username:',username);console.log('ðŸ”‘ Password length:',password.length);// First check if Supabase is healthy\nconsole.log('ðŸ” Checking database health...');const isHealthy=await db.isHealthy();if(!isHealthy){throw new Error('Database connection failed. Please check your internet connection and try again.');}console.log('âœ… Database health check passed, attempting login...');const user=await databaseWrapper.login(username,password);console.log('âœ… Login successful for user:',user);console.log('ðŸ” User object structure:',JSON.stringify(user,null,2));console.log('ðŸ” User role:',user===null||user===void 0?void 0:user.role);console.log('ðŸ” User token:',user!==null&&user!==void 0&&user.token?'Present':'Missing');onLogin(user);}catch(error){var _error$message;console.error('âŒ Login error:',error);// If login fails and it's admin credentials, try to initialize admin account\nif(username==='admin'&&password==='admin123'&&(_error$message=error.message)!==null&&_error$message!==void 0&&_error$message.includes('Invalid')){console.log('ðŸ”§ Login failed for admin, attempting to initialize admin account...');try{await db.initializeSampleDataIfNeeded();console.log('âœ… Admin account initialized, retrying login...');// Retry login after initialization\nconst retryUser=await databaseWrapper.login(username,password);console.log('âœ… Retry login successful for user:',retryUser);onLogin(retryUser);return;// Exit early if retry succeeds\n}catch(initError){console.error('âŒ Failed to initialize admin account:',initError);setError(\"Login failed. Admin initialization error: \".concat(initError.message));return;}}setError(error.message||'Login failed');}finally{setIsLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-12 px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md w-full\",children:/*#__PURE__*/_jsxs(Card,{className:\"bg-white/95 backdrop-blur-sm border-2 border-amber-300 shadow-2xl shadow-amber-500/20\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"text-center pb-8 pt-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 mx-auto bg-gradient-to-br from-amber-400 to-amber-600 rounded-full flex items-center justify-center shadow-lg\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-2xl font-bold text-white\",children:\"HW\"})})}),/*#__PURE__*/_jsx(CardTitle,{className:\"text-3xl font-bold bg-gradient-to-r from-amber-600 to-amber-800 bg-clip-text text-transparent\",children:\"Hoe Win Junket Management System\"}),/*#__PURE__*/_jsx(CardDescription,{className:\"text-slate-600 mt-3 font-medium\",children:\"Professional Gaming Management Platform\"})]}),/*#__PURE__*/_jsx(CardContent,{className:\"px-8 pb-8\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"username\",className:\"text-slate-700 font-semibold\",children:\"Username\"}),/*#__PURE__*/_jsx(Input,{id:\"username\",type:\"text\",value:username,onChange:e=>setUsername(e.target.value),placeholder:\"Enter username\",required:true,disabled:isLoading,className:\"h-12 border-2 border-slate-200 focus:border-amber-400 focus:ring-amber-400/20 bg-white/80 backdrop-blur-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"password\",className:\"text-slate-700 font-semibold\",children:\"Password\"}),/*#__PURE__*/_jsx(Input,{id:\"password\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Enter password\",required:true,disabled:isLoading,className:\"h-12 border-2 border-slate-200 focus:border-amber-400 focus:ring-amber-400/20 bg-white/80 backdrop-blur-sm\"})]}),error&&/*#__PURE__*/_jsxs(Alert,{className:\"border-2 border-red-300 bg-red-50/80 backdrop-blur-sm\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"w-5 h-5 text-red-600\"}),/*#__PURE__*/_jsxs(AlertDescription,{className:\"text-red-800 font-medium\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Authentication Failed:\"}),\" \",error,error.includes('Invalid credentials')&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 p-3 bg-red-100/50 rounded-md text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold mb-2\",children:\"Valid Credentials:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Admin: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-red-200 px-2 py-1 rounded font-mono\",children:\"admin / admin123\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Agent: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-red-200 px-2 py-1 rounded font-mono\",children:\"agent1 / agent123\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Staff: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-red-200 px-2 py-1 rounded font-mono\",children:\"staff1 / staff123\"})]})]})]})]})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",className:\"w-full h-12 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold shadow-lg shadow-amber-500/25 border-0 transition-all duration-200\",disabled:isLoading,children:isLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Authenticating...\"})]}):'Access Dashboard'})]})})]})})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}