{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Card,CardContent,CardHeader,CardTitle,CardDescription}from'./ui/card';import{Badge}from'./ui/badge';import{Users,UserCheck,TrendingDown,DollarSign,Receipt,Trophy,Target,MapPin,Activity,ArrowUpDown,ArrowUp,ArrowDown}from'lucide-react';import{db}from'../utils/supabase/supabaseClients';import{apiClient}from'../utils/api/apiClient';// Type definitions\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export function Dashboard(_ref){let{user}=_ref;// Data states with real-time updates\nconst[agents,setAgents]=useState([]);const[customers,setCustomers]=useState([]);const[trips,setTrips]=useState([]);const[rollingRecords,setRollingRecords]=useState([]);const[buyInOutRecords,setBuyInOutRecords]=useState([]);// Loading and sync states\nconst[loading,setLoading]=useState(true);// Sorting states for customer performance\nconst[sortBy,setSortBy]=useState('rolling');const[sortOrder,setSortOrder]=useState('desc');// Helper functions\nconst safeFormatNumber=value=>{if(value===undefined||value===null||isNaN(value)){return'0';}return value.toLocaleString();};const safeNumber=value=>{if(value===undefined||value===null||isNaN(value)){return 0;}return value;};// Data loading from API\nconst loadData=useCallback(async()=>{try{console.log('üîÑ Loading dashboard data from API...');// Load all required data from API in parallel\nconst[agentsData,customersData,transactionsData,tripsApiResponse]=await Promise.all([db.get('agents',[]),db.get('customers',[]),db.get('transactions',[]),apiClient.getTripsWithSharing()]);const tripsData=tripsApiResponse.data||[];console.log('üìä Dashboard data loaded:',{agents:Array.isArray(agentsData)?agentsData.length:0,customers:Array.isArray(customersData)?customersData.length:0,trips:Array.isArray(tripsData)?tripsData.length:0,transactions:Array.isArray(transactionsData)?transactionsData.length:0});// Process customers - use database totals directly\nconst processedCustomers=(Array.isArray(customersData)?customersData:[]).map(customer=>{return _objectSpread(_objectSpread({},customer),{},{id:customer.id,name:customer.name,agentName:customer.agent_name,isActive:customer.status==='active',totalRolling:parseFloat(customer.total_rolling)||0,totalWinLoss:parseFloat(customer.total_win_loss)||0,totalBuyIn:parseFloat(customer.total_buy_in)||0,totalBuyOut:parseFloat(customer.total_buy_out)||0,attachments:customer.attachments||[],isAgent:customer.is_agent||false,rollingPercentage:parseFloat(customer.rolling_percentage)||1.4,creditLimit:parseFloat(customer.credit_limit)||0,availableCredit:parseFloat(customer.available_credit)||0});});// Process trips - preserve sharing data from API directly\nconst processedTrips=(Array.isArray(tripsData)?tripsData:[]).map(trip=>{return _objectSpread(_objectSpread({},trip),{},{attachments:trip.attachments||[]});});// Set processed data\nsetAgents(agentsData);setCustomers(processedCustomers);setTrips(processedTrips);setRollingRecords([]);setBuyInOutRecords(transactionsData||[]);console.log(\"\\u2705 Dashboard data loaded: \".concat(processedCustomers.length,\" customers, \").concat(agentsData.length,\" agents, \").concat(processedTrips.length,\" trips\"));}catch(error){console.error('‚ùå Error loading dashboard data:',error);}finally{setLoading(false);}},[]);// Load data on component mount\nuseEffect(()=>{loadData();},[loadData]);// Filter data based on user role\nconst getFilteredData=()=>{let filteredCustomers=customers;let filteredTrips=trips;if(user.role==='agent'&&user.agentId){filteredCustomers=customers.filter(c=>c.agentId===user.agentId);filteredTrips=trips.filter(t=>t.agents&&t.agents.some(agent=>agent.agentId===user.agentId)||t.agentId===user.agentId);}return{filteredCustomers,filteredTrips};};const{filteredCustomers,filteredTrips}=getFilteredData();// Sorting function for customers\nconst getSortedCustomers=()=>{const sorted=[...filteredCustomers].sort((a,b)=>{let valueA,valueB;if(sortBy==='rolling'){valueA=safeNumber(a.totalRolling);valueB=safeNumber(b.totalRolling);}else{valueA=safeNumber(a.totalWinLoss);valueB=safeNumber(b.totalWinLoss);}return sortOrder==='desc'?valueB-valueA:valueA-valueB;});// Return all customers, not just top 5\nreturn sorted;};// Calculate comprehensive metrics from real-time data\nconst calculateMetrics=()=>{// Trip-based financial metrics\nconst tripTotalRolling=filteredTrips.reduce((sum,trip)=>sum+safeNumber(trip.totalRolling),0);const tripTotalWinLoss=filteredTrips.reduce((sum,trip)=>sum+safeNumber(trip.totalWinLoss),0);const totalRollingCommission=filteredTrips.reduce((sum,trip)=>sum+safeNumber(trip.calculatedTotalRolling),0);const totalExpenses=filteredTrips.reduce((sum,trip)=>sum+(trip.expenses||[]).reduce((expSum,exp)=>expSum+safeNumber(exp.amount),0),0);// Customer metrics\nconst totalCustomers=filteredCustomers.length;const activeCustomers=filteredCustomers.filter(c=>c.isActive).length;const customerTotalWinLoss=filteredCustomers.reduce((sum,c)=>sum+safeNumber(c.totalWinLoss),0);const customerTotalBuyIn=filteredCustomers.reduce((sum,c)=>sum+safeNumber(c.totalBuyIn),0);const customerTotalBuyOut=filteredCustomers.reduce((sum,c)=>sum+safeNumber(c.totalBuyOut),0);// Total Rolling from trip_sharing table (should be positive by nature)\nconst tripSharingTotalRolling=trips.reduce((sum,trip)=>{var _trip$sharing,_trip$sharing2,_trip$sharing3,_trip$sharing4;const value=safeNumber(((_trip$sharing=trip.sharing)===null||_trip$sharing===void 0?void 0:_trip$sharing.total_rolling)||((_trip$sharing2=trip.sharing)===null||_trip$sharing2===void 0?void 0:_trip$sharing2.totalRolling));console.log(\"\\uD83D\\uDD0D Trip \".concat(trip.trip_name||trip.name,\":\"),{hasSharing:!!trip.sharing,total_rolling:(_trip$sharing3=trip.sharing)===null||_trip$sharing3===void 0?void 0:_trip$sharing3.total_rolling,totalRolling:(_trip$sharing4=trip.sharing)===null||_trip$sharing4===void 0?void 0:_trip$sharing4.totalRolling,sharingObject:trip.sharing,contributingValue:value});return sum+value;},0);console.log('üìä Dashboard Total Rolling Summary:',{totalTrips:trips.length,tripsWithSharing:trips.filter(t=>t.sharing).length,finalTotalRolling:tripSharingTotalRolling});// Agent metrics\nconst totalAgents=agents.length;const activeAgents=agents.filter(a=>a.status==='active').length;// Trip metrics\nconst totalTrips=filteredTrips.length;const completedTrips=filteredTrips.filter(t=>t.status==='completed').length;const ongoingTrips=filteredTrips.filter(t=>t.status==='ongoing').length;const plannedTrips=filteredTrips.filter(t=>t.status==='planned').length;// Calculate metrics from trip_sharing table data (all trips, no filtering)\nconsole.log('üîç Debug trips data for calculations:',trips.length);trips.forEach((trip,index)=>{console.log(\"Trip \".concat(index+1,\" (\").concat(trip.trip_name,\"):\"),{hasSharing:!!trip.sharing,sharingKeys:trip.sharing?Object.keys(trip.sharing):'no sharing',sharingData:trip.sharing});});const tripSharingGrossProfit=trips.reduce((sum,trip)=>{var _trip$sharing5,_trip$sharing6,_trip$sharing7;const value=safeNumber(((_trip$sharing5=trip.sharing)===null||_trip$sharing5===void 0?void 0:_trip$sharing5.total_win_loss)||((_trip$sharing6=trip.sharing)===null||_trip$sharing6===void 0?void 0:_trip$sharing6.totalWinLoss));console.log(\"Trip \".concat(trip.trip_name,\": total_win_loss = \").concat((_trip$sharing7=trip.sharing)===null||_trip$sharing7===void 0?void 0:_trip$sharing7.total_win_loss,\", contributing \").concat(value,\" to gross profit\"));return sum+value;},0);const tripSharingExpenses=trips.reduce((sum,trip)=>{var _trip$sharing8,_trip$sharing9,_trip$sharing0;const value=safeNumber(((_trip$sharing8=trip.sharing)===null||_trip$sharing8===void 0?void 0:_trip$sharing8.total_expenses)||((_trip$sharing9=trip.sharing)===null||_trip$sharing9===void 0?void 0:_trip$sharing9.totalExpenses));console.log(\"Trip \".concat(trip.trip_name,\": total_expenses = \").concat((_trip$sharing0=trip.sharing)===null||_trip$sharing0===void 0?void 0:_trip$sharing0.total_expenses,\", contributing \").concat(value,\" to expenses\"));return sum+value;},0);const tripSharingNetProfit=trips.reduce((sum,trip)=>{var _trip$sharing1,_trip$sharing10,_trip$sharing11;const value=safeNumber(((_trip$sharing1=trip.sharing)===null||_trip$sharing1===void 0?void 0:_trip$sharing1.company_share)||((_trip$sharing10=trip.sharing)===null||_trip$sharing10===void 0?void 0:_trip$sharing10.companyShare));console.log(\"Trip \".concat(trip.trip_name,\": company_share = \").concat((_trip$sharing11=trip.sharing)===null||_trip$sharing11===void 0?void 0:_trip$sharing11.company_share,\", contributing \").concat(value,\" to net profit\"));return sum+value;},0);console.log('üìä Final calculations:',{tripSharingGrossProfit,tripSharingExpenses,tripSharingNetProfit});// House performance calculations (using trip_sharing data)\nconst houseGrossWin=tripSharingGrossProfit;const houseNetWin=houseGrossWin-totalRollingCommission;const houseFinalProfit=tripSharingNetProfit;// Performance ratios (using trip_sharing total_rolling)\nconst profitMargin=tripSharingTotalRolling>0?houseFinalProfit/tripSharingTotalRolling*100:0;const expenseRatio=tripSharingTotalRolling>0?totalExpenses/tripSharingTotalRolling*100:0;const commissionRatio=tripSharingTotalRolling>0?totalRollingCommission/tripSharingTotalRolling*100:0;// Recent activity metrics\nconst recentRollingRecords=rollingRecords.filter(record=>Date.now()-new Date(record.recordedAt).getTime()<24*60*60*1000).length;const recentBuyInOutRecords=buyInOutRecords.filter(record=>Date.now()-new Date(record.timestamp).getTime()<24*60*60*1000).length;return{// Trip metrics\ntripTotalRolling,tripTotalWinLoss,totalRollingCommission,totalExpenses:tripSharingExpenses,// Customer metrics\ntotalCustomers,activeCustomers,customerTotalRolling:tripSharingTotalRolling,// Use trip_sharing total_rolling\ncustomerTotalWinLoss,customerTotalBuyIn,customerTotalBuyOut,// Agent metrics\ntotalAgents,activeAgents,// Trip counts\ntotalTrips,completedTrips,ongoingTrips,plannedTrips,// House performance\nhouseGrossWin,houseNetWin,houseFinalProfit,// Ratios\nprofitMargin,expenseRatio,commissionRatio,// Activity\nrecentRollingRecords,recentBuyInOutRecords,totalRollingRecords:rollingRecords.length,totalBuyInOutRecords:buyInOutRecords.length};};const metrics=calculateMetrics();// Filter active trips and use trip_sharing data\nconst activeTrips=filteredTrips.filter(trip=>trip.status&&trip.status.toLowerCase()==='active').map(trip=>{// Use trip_sharing data directly instead of enriching with calculations\nconst tripCustomers=filteredCustomers.filter(c=>{var _trip$customers;return(_trip$customers=trip.customers)===null||_trip$customers===void 0?void 0:_trip$customers.some(tc=>tc.customerId===c.id||tc.customer_id===c.id);});return _objectSpread(_objectSpread({},trip),{},{customers:tripCustomers// Keep original sharing data from trip_sharing table\n});});const getWinLossStatus=winLoss=>{if(winLoss===0){return{text:'Break Even',icon:Target,color:'text-gray-600'};}else if(winLoss>0){return{text:'Junket Loss',icon:TrendingDown,color:'text-red-600'};}else{return{text:'Junket Profit',icon:Trophy,color:'text-green-600'};}};// Show loading state\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-gray-600\",children:\"Loading dashboard data...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium mb-4\",children:\"Real-time Financial Overview\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\",children:[/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-blue-800\",children:\"Total Rolling Amount\"}),/*#__PURE__*/_jsx(DollarSign,{className:\"h-4 w-4 text-blue-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-blue-700\",children:[\"HK$\",safeFormatNumber(Math.abs(metrics.customerTotalRolling))]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-blue-600\",children:[\"From \",metrics.totalRollingRecords,\" rolling records across \",metrics.totalCustomers,\" customers\"]})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r \".concat(metrics.houseGrossWin>=0?'from-green-50 to-green-100 border-green-200':'from-red-50 to-red-100 border-red-200'),children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium \".concat(metrics.houseGrossWin>=0?'text-green-800':'text-red-800'),children:\"Company Gross Profit\"}),metrics.houseGrossWin>=0?/*#__PURE__*/_jsx(Trophy,{className:\"h-4 w-4 text-green-600\"}):/*#__PURE__*/_jsx(TrendingDown,{className:\"h-4 w-4 text-red-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold \".concat(metrics.houseGrossWin>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(metrics.houseGrossWin))]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs \".concat(metrics.houseGrossWin>=0?'text-green-600':'text-red-600'),children:\"From trip sharing win/loss data\"})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-red-50 to-red-100 border-red-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-red-800\",children:\"Expenses\"}),/*#__PURE__*/_jsx(Receipt,{className:\"h-4 w-4 text-red-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-red-700\",children:[\"HK$\",safeFormatNumber(Math.abs(metrics.totalExpenses))]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-600\",children:\"Total operational expenses from trip sharing\"})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r \".concat(metrics.houseFinalProfit>=0?'from-green-50 to-green-100 border-green-200':'from-red-50 to-red-100 border-red-200'),children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium \".concat(metrics.houseFinalProfit>=0?'text-green-800':'text-red-800'),children:\"Company Net Profit\"}),metrics.houseFinalProfit>=0?/*#__PURE__*/_jsx(Trophy,{className:\"h-4 w-4 text-green-600\"}):/*#__PURE__*/_jsx(TrendingDown,{className:\"h-4 w-4 text-red-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold \".concat(metrics.houseFinalProfit>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(metrics.houseFinalProfit))]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs \".concat(metrics.houseFinalProfit>=0?'text-green-600':'text-red-600'),children:\"Company share from trip sharing\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium mb-4\",children:\"Operations Overview\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium\",children:\"Active Customers\"}),/*#__PURE__*/_jsx(Users,{className:\"h-4 w-4 text-muted-foreground\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:metrics.activeCustomers}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground\",children:[\"of \",metrics.totalCustomers,\" total customers\"]})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium\",children:\"Active Agents\"}),/*#__PURE__*/_jsx(UserCheck,{className:\"h-4 w-4 text-muted-foreground\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:metrics.activeAgents}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground\",children:[\"of \",metrics.totalAgents,\" total agents\"]})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium\",children:\"Trip Summary\"}),/*#__PURE__*/_jsx(MapPin,{className:\"h-4 w-4 text-muted-foreground\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:metrics.totalTrips}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground\",children:[metrics.completedTrips,\" completed, \",metrics.ongoingTrips,\" ongoing, \",metrics.plannedTrips,\" planned\"]})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium\",children:\"Recent Activity\"}),/*#__PURE__*/_jsx(Activity,{className:\"h-4 w-4 text-muted-foreground\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:metrics.recentRollingRecords+metrics.recentBuyInOutRecords}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-muted-foreground\",children:\"Transactions in last 24 hours\"})]})]})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"h-full\",children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Active Trips\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Current ongoing trips with real-time performance data\"})]}),/*#__PURE__*/_jsx(CardContent,{children:activeTrips.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"h-12 w-12 text-gray-300 mx-auto mb-3\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No active trips found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400 mt-1\",children:\"Active trips will appear here when trips are in progress\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:activeTrips.slice(0,5)// Show up to 5 trips to match customer performance section\n.map(trip=>{var _trip$sharing12,_trip$sharing13,_trip$sharing14,_trip$sharing15,_trip$customers2;// Use trip_sharing data directly\nconst totalRolling=((_trip$sharing12=trip.sharing)===null||_trip$sharing12===void 0?void 0:_trip$sharing12.total_rolling)||((_trip$sharing13=trip.sharing)===null||_trip$sharing13===void 0?void 0:_trip$sharing13.totalRolling)||0;const winLoss=((_trip$sharing14=trip.sharing)===null||_trip$sharing14===void 0?void 0:_trip$sharing14.total_win_loss)||((_trip$sharing15=trip.sharing)===null||_trip$sharing15===void 0?void 0:_trip$sharing15.totalWinLoss)||0;// Calculate progress based on dates\nconst startDate=trip.start_date?new Date(trip.start_date):null;const endDate=trip.end_date?new Date(trip.end_date):null;const now=new Date();let progress=0;if(startDate&&endDate){const totalDuration=endDate.getTime()-startDate.getTime();const elapsed=now.getTime()-startDate.getTime();progress=Math.max(0,Math.min(100,elapsed/totalDuration*100));}return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(Badge,{variant:\"secondary\",className:\"bg-green-100 text-green-700 border-green-200\",children:trip.status==='active'?'Active':'Ongoing'})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:trip.trip_name||trip.name||'Unnamed Trip'}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 flex items-center\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"h-3 w-3 mr-1\"}),trip.destination||'Unknown Destination',\" \\u2022 \",((_trip$customers2=trip.customers)===null||_trip$customers2===void 0?void 0:_trip$customers2.length)||0,\" customers\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-blue-600\",children:[\"Progress: \",Math.round(progress),\"% \\u2022 \",trip.start_date?new Date(trip.start_date).toLocaleDateString():'TBD',\" - \",trip.end_date?new Date(trip.end_date).toLocaleDateString():'TBD']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-6 text-right text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Rolling\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-600\",children:[\"HK$\",safeFormatNumber(Math.abs(totalRolling))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Win/Loss\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(winLoss<0?'text-red-600':winLoss>=0?'text-green-600':'text-gray-600'),children:[\"HK$\",safeFormatNumber(Math.abs(winLoss))]})]})]})]},trip.id);})})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Real-time Customer Performance\"}),/*#__PURE__*/_jsxs(CardDescription,{children:[\"All customers based on live rolling data \",user.role==='agent'?'you manage':'',\" (\",filteredCustomers.length,\" customers)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1 text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Sort by:\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setSortBy(sortBy==='rolling'?'winloss':'rolling'),className:\"flex items-center space-x-1 px-2 py-1 rounded hover:bg-gray-100 transition-colors\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:sortBy==='rolling'?'Rolling':'Win/Loss'}),/*#__PURE__*/_jsx(ArrowUpDown,{className:\"h-3 w-3\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSortOrder(sortOrder==='desc'?'asc':'desc'),className:\"flex items-center px-2 py-1 rounded hover:bg-gray-100 transition-colors\",title:\"Sort \".concat(sortOrder==='desc'?'ascending':'descending'),children:sortOrder==='desc'?/*#__PURE__*/_jsx(ArrowDown,{className:\"h-4 w-4 text-gray-600\"}):/*#__PURE__*/_jsx(ArrowUp,{className:\"h-4 w-4 text-gray-600\"})})]})]})}),/*#__PURE__*/_jsx(CardContent,{children:filteredCustomers.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(Users,{className:\"h-12 w-12 text-gray-300 mx-auto mb-3\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No customer data found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400 mt-1\",children:\"Customer performance will appear here once rolling records are created\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4 max-h-96 overflow-y-auto pr-2\",children:getSortedCustomers().map(customer=>{const indicator=getWinLossStatus(customer.totalWinLoss||0);const Icon=indicator.icon;const winLoss=customer.totalWinLoss||0;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(Icon,{className:\"h-5 w-5 \".concat(indicator.color)}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:customer.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"Agent: \",customer.agentName,\" \\u2022 \",customer.isActive?'Active':'Inactive']}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-purple-600\",children:[\"Commission Rate: \",customer.rollingPercentage,\"%\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-6 text-right text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Rolling\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-600\",children:[\"HK$\",safeFormatNumber(Math.abs(customer.totalRolling||0))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Win/Loss\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(winLoss<0?'text-red-600':winLoss>0?'text-green-600':'text-gray-600'),children:[\"HK$\",safeFormatNumber(Math.abs(winLoss))]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs \".concat(winLoss<0?'text-red-500':winLoss>0?'text-green-500':'text-gray-500'),children:winLoss<0?'ÂÖ¨Âè∏ËæìÈí±':winLoss>0?'ÂÖ¨Âè∏Ëµ¢Èí±':'ÊåÅÂπ≥'})]})]})]},customer.id);})})})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}