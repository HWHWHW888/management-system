{"ast":null,"code":"var _jsxFileName = \"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/src/contexts/CurrencyContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { convertAmount, getCurrencySymbol } from '../utils/currency';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CurrencyContext = /*#__PURE__*/createContext(undefined);\nexport const CurrencyProvider = ({\n  children\n}) => {\n  _s();\n  // ‰ªélocalStorageËé∑Âèñ‰øùÂ≠òÁöÑË¥ßÂ∏ÅËÆæÁΩÆÔºåÈªòËÆ§‰∏∫HKD\n  const [globalCurrency, setGlobalCurrencyState] = useState(() => {\n    const saved = localStorage.getItem('globalCurrency');\n    return saved || 'HKD';\n  });\n\n  // Ë¥ßÂ∏ÅËΩ¨Êç¢ÁºìÂ≠ò - ÈÅøÂÖçÈáçÂ§çËÆ°ÁÆó\n  const [conversionCache, setConversionCache] = useState(new Map());\n\n  // ‰øùÂ≠òË¥ßÂ∏ÅËÆæÁΩÆÂà∞localStorage\n  const setGlobalCurrency = currency => {\n    setGlobalCurrencyState(currency);\n    localStorage.setItem('globalCurrency', currency);\n    // Ê∏ÖÈô§ÁºìÂ≠òÔºåÂõ†‰∏∫ÁõÆÊ†áË¥ßÂ∏ÅÊîπÂèò‰∫Ü\n    setConversionCache(new Map());\n    console.log('üåç Global currency changed to:', currency);\n  };\n\n  // Ëé∑ÂèñÂΩìÂâçË¥ßÂ∏ÅÁ¨¶Âè∑\n  const currencySymbol = getCurrencySymbol(globalCurrency);\n\n  // ËΩ¨Êç¢ÈáëÈ¢ùÂà∞ÂÖ®Â±ÄË¥ßÂ∏Å\n  const convertToGlobalCurrency = (amount, fromCurrency = 'HKD', trip) => {\n    if (!amount || amount === 0) return 0;\n    if (fromCurrency === globalCurrency) return amount;\n\n    // ÁîüÊàêÁºìÂ≠òÈîÆ\n    const cacheKey = `${amount}_${fromCurrency}_${globalCurrency}_${(trip === null || trip === void 0 ? void 0 : trip.id) || 'no-trip'}`;\n\n    // Ê£ÄÊü•ÁºìÂ≠ò\n    if (conversionCache.has(cacheKey)) {\n      return conversionCache.get(cacheKey);\n    }\n\n    // ÊâßË°åËΩ¨Êç¢\n    let convertedAmount = amount;\n    if (trip) {\n      // ‰ΩøÁî®tripÁöÑÊ±áÁéáËøõË°åËΩ¨Êç¢\n      convertedAmount = convertAmount(amount, fromCurrency, globalCurrency, trip);\n    } else {\n      // Â¶ÇÊûúÊ≤°Êúâtrip‰ø°ÊÅØÔºå‰ΩøÁî®ÈªòËÆ§Ê±áÁéáËøõË°åËΩ¨Êç¢\n      // ÂàõÂª∫‰∏Ä‰∏™ÈªòËÆ§ÁöÑtripÂØπË±°Áî®‰∫éËΩ¨Êç¢\n      const defaultTrip = {\n        currency: fromCurrency,\n        exchange_rate_peso: 1.0,\n        exchange_rate_hkd: 1.0,\n        exchange_rate_myr: 0.6 // ÂÅáËÆæMYRÁõ∏ÂØπ‰∫éHKDÁöÑÊ±áÁéáÊòØ0.6\n      };\n      convertedAmount = convertAmount(amount, fromCurrency, globalCurrency, defaultTrip);\n      console.log(`üí± Using default rates for conversion: ${fromCurrency} -> ${globalCurrency}`, {\n        amount,\n        convertedAmount,\n        defaultRates: defaultTrip\n      });\n    }\n\n    // ÁºìÂ≠òÁªìÊûú\n    const newCache = new Map(conversionCache);\n    newCache.set(cacheKey, convertedAmount);\n    setConversionCache(newCache);\n    console.log('üí± Currency conversion:', {\n      amount,\n      fromCurrency,\n      toCurrency: globalCurrency,\n      convertedAmount,\n      tripId: trip === null || trip === void 0 ? void 0 : trip.id,\n      cached: false\n    });\n    return convertedAmount;\n  };\n\n  // Ê†ºÂºèÂåñ‰∏∫ÂÖ®Â±ÄË¥ßÂ∏ÅÊòæÁ§∫\n  const formatGlobalCurrency = (amount, fromCurrency = 'HKD', trip) => {\n    const convertedAmount = convertToGlobalCurrency(amount, fromCurrency, trip);\n    return `${currencySymbol}${Math.abs(convertedAmount).toLocaleString('en-US', {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2\n    })}`;\n  };\n\n  // Ê∏ÖÈô§ÁºìÂ≠ò\n  const clearCache = () => {\n    setConversionCache(new Map());\n    console.log('üóëÔ∏è Currency conversion cache cleared');\n  };\n\n  // ÁõëÂê¨ÂÖ®Â±ÄË¥ßÂ∏ÅÂèòÂåñÔºåËÆ∞ÂΩïÊó•Âøó\n  useEffect(() => {\n    console.log('üåç Global currency context initialized:', {\n      globalCurrency,\n      currencySymbol,\n      cacheSize: conversionCache.size\n    });\n  }, [globalCurrency, currencySymbol, conversionCache.size]);\n  const value = {\n    globalCurrency,\n    setGlobalCurrency,\n    convertToGlobalCurrency,\n    formatGlobalCurrency,\n    currencySymbol,\n    conversionCache,\n    clearCache\n  };\n  return /*#__PURE__*/_jsxDEV(CurrencyContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 5\n  }, this);\n};\n_s(CurrencyProvider, \"kY++ecaDMKa8zOjGV7/yHMnjBvk=\");\n_c = CurrencyProvider;\nexport const useCurrency = () => {\n  _s2();\n  const context = useContext(CurrencyContext);\n  if (context === undefined) {\n    throw new Error('useCurrency must be used within a CurrencyProvider');\n  }\n  return context;\n};\n_s2(useCurrency, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport default CurrencyContext;\nvar _c;\n$RefreshReg$(_c, \"CurrencyProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","convertAmount","getCurrencySymbol","jsxDEV","_jsxDEV","CurrencyContext","undefined","CurrencyProvider","children","_s","globalCurrency","setGlobalCurrencyState","saved","localStorage","getItem","conversionCache","setConversionCache","Map","setGlobalCurrency","currency","setItem","console","log","currencySymbol","convertToGlobalCurrency","amount","fromCurrency","trip","cacheKey","id","has","get","convertedAmount","defaultTrip","exchange_rate_peso","exchange_rate_hkd","exchange_rate_myr","defaultRates","newCache","set","toCurrency","tripId","cached","formatGlobalCurrency","Math","abs","toLocaleString","minimumFractionDigits","maximumFractionDigits","clearCache","cacheSize","size","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useCurrency","_s2","context","Error","$RefreshReg$"],"sources":["/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/src/contexts/CurrencyContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { SUPPORTED_CURRENCIES, convertAmount, getCurrencySymbol } from '../utils/currency';\n\nexport interface CurrencyContextType {\n  globalCurrency: string;\n  setGlobalCurrency: (currency: string) => void;\n  convertToGlobalCurrency: (amount: number, fromCurrency: string, trip?: any) => number;\n  formatGlobalCurrency: (amount: number, fromCurrency?: string, trip?: any) => string;\n  currencySymbol: string;\n  conversionCache: Map<string, number>;\n  clearCache: () => void;\n}\n\nconst CurrencyContext = createContext<CurrencyContextType | undefined>(undefined);\n\ninterface CurrencyProviderProps {\n  children: ReactNode;\n}\n\nexport const CurrencyProvider: React.FC<CurrencyProviderProps> = ({ children }) => {\n  // ‰ªélocalStorageËé∑Âèñ‰øùÂ≠òÁöÑË¥ßÂ∏ÅËÆæÁΩÆÔºåÈªòËÆ§‰∏∫HKD\n  const [globalCurrency, setGlobalCurrencyState] = useState<string>(() => {\n    const saved = localStorage.getItem('globalCurrency');\n    return saved || 'HKD';\n  });\n\n  // Ë¥ßÂ∏ÅËΩ¨Êç¢ÁºìÂ≠ò - ÈÅøÂÖçÈáçÂ§çËÆ°ÁÆó\n  const [conversionCache, setConversionCache] = useState<Map<string, number>>(new Map());\n\n  // ‰øùÂ≠òË¥ßÂ∏ÅËÆæÁΩÆÂà∞localStorage\n  const setGlobalCurrency = (currency: string) => {\n    setGlobalCurrencyState(currency);\n    localStorage.setItem('globalCurrency', currency);\n    // Ê∏ÖÈô§ÁºìÂ≠òÔºåÂõ†‰∏∫ÁõÆÊ†áË¥ßÂ∏ÅÊîπÂèò‰∫Ü\n    setConversionCache(new Map());\n    console.log('üåç Global currency changed to:', currency);\n  };\n\n  // Ëé∑ÂèñÂΩìÂâçË¥ßÂ∏ÅÁ¨¶Âè∑\n  const currencySymbol = getCurrencySymbol(globalCurrency);\n\n  // ËΩ¨Êç¢ÈáëÈ¢ùÂà∞ÂÖ®Â±ÄË¥ßÂ∏Å\n  const convertToGlobalCurrency = (amount: number, fromCurrency: string = 'HKD', trip?: any): number => {\n    if (!amount || amount === 0) return 0;\n    if (fromCurrency === globalCurrency) return amount;\n\n    // ÁîüÊàêÁºìÂ≠òÈîÆ\n    const cacheKey = `${amount}_${fromCurrency}_${globalCurrency}_${trip?.id || 'no-trip'}`;\n    \n    // Ê£ÄÊü•ÁºìÂ≠ò\n    if (conversionCache.has(cacheKey)) {\n      return conversionCache.get(cacheKey)!;\n    }\n\n    // ÊâßË°åËΩ¨Êç¢\n    let convertedAmount = amount;\n    \n    if (trip) {\n      // ‰ΩøÁî®tripÁöÑÊ±áÁéáËøõË°åËΩ¨Êç¢\n      convertedAmount = convertAmount(amount, fromCurrency, globalCurrency, trip);\n    } else {\n      // Â¶ÇÊûúÊ≤°Êúâtrip‰ø°ÊÅØÔºå‰ΩøÁî®ÈªòËÆ§Ê±áÁéáËøõË°åËΩ¨Êç¢\n      // ÂàõÂª∫‰∏Ä‰∏™ÈªòËÆ§ÁöÑtripÂØπË±°Áî®‰∫éËΩ¨Êç¢\n      const defaultTrip = {\n        currency: fromCurrency,\n        exchange_rate_peso: 1.0,\n        exchange_rate_hkd: 1.0,\n        exchange_rate_myr: 0.6 // ÂÅáËÆæMYRÁõ∏ÂØπ‰∫éHKDÁöÑÊ±áÁéáÊòØ0.6\n      };\n      convertedAmount = convertAmount(amount, fromCurrency, globalCurrency, defaultTrip);\n      console.log(`üí± Using default rates for conversion: ${fromCurrency} -> ${globalCurrency}`, {\n        amount,\n        convertedAmount,\n        defaultRates: defaultTrip\n      });\n    }\n\n    // ÁºìÂ≠òÁªìÊûú\n    const newCache = new Map(conversionCache);\n    newCache.set(cacheKey, convertedAmount);\n    setConversionCache(newCache);\n\n    console.log('üí± Currency conversion:', {\n      amount,\n      fromCurrency,\n      toCurrency: globalCurrency,\n      convertedAmount,\n      tripId: trip?.id,\n      cached: false\n    });\n\n    return convertedAmount;\n  };\n\n  // Ê†ºÂºèÂåñ‰∏∫ÂÖ®Â±ÄË¥ßÂ∏ÅÊòæÁ§∫\n  const formatGlobalCurrency = (amount: number, fromCurrency: string = 'HKD', trip?: any): string => {\n    const convertedAmount = convertToGlobalCurrency(amount, fromCurrency, trip);\n    return `${currencySymbol}${Math.abs(convertedAmount).toLocaleString('en-US', {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2\n    })}`;\n  };\n\n  // Ê∏ÖÈô§ÁºìÂ≠ò\n  const clearCache = () => {\n    setConversionCache(new Map());\n    console.log('üóëÔ∏è Currency conversion cache cleared');\n  };\n\n  // ÁõëÂê¨ÂÖ®Â±ÄË¥ßÂ∏ÅÂèòÂåñÔºåËÆ∞ÂΩïÊó•Âøó\n  useEffect(() => {\n    console.log('üåç Global currency context initialized:', {\n      globalCurrency,\n      currencySymbol,\n      cacheSize: conversionCache.size\n    });\n  }, [globalCurrency, currencySymbol, conversionCache.size]);\n\n  const value: CurrencyContextType = {\n    globalCurrency,\n    setGlobalCurrency,\n    convertToGlobalCurrency,\n    formatGlobalCurrency,\n    currencySymbol,\n    conversionCache,\n    clearCache\n  };\n\n  return (\n    <CurrencyContext.Provider value={value}>\n      {children}\n    </CurrencyContext.Provider>\n  );\n};\n\nexport const useCurrency = (): CurrencyContextType => {\n  const context = useContext(CurrencyContext);\n  if (context === undefined) {\n    throw new Error('useCurrency must be used within a CurrencyProvider');\n  }\n  return context;\n};\n\nexport default CurrencyContext;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}