{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Select,SelectContent,SelectItem,SelectTrigger,SelectValue}from'./ui/select';import{Button}from'./ui/button';import{Alert,AlertDescription}from'./ui/alert';import{Badge}from'./ui/badge';import{BarChart,Bar,XAxis,YAxis,CartesianGrid,Tooltip,ResponsiveContainer,Line,ComposedChart,AreaChart,Area}from'recharts';import{Download,DollarSign,TrendingDown,Users,RefreshCw,Activity,AlertTriangle,BarChart3,Zap,ArrowUpDown,ArrowUpCircle,Percent,Trophy}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Real-time refresh interval (30 seconds)\nconst REAL_TIME_REFRESH_INTERVAL=30000;export function Reports(_ref){let{user}=_ref;// Data states with real-time updates\nconst[agents,setAgents]=useState([]);const[customers,setCustomers]=useState([]);const[trips,setTrips]=useState([]);const[rollingRecords,setRollingRecords]=useState([]);const[buyInOutRecords,setBuyInOutRecords]=useState([]);// Filter states\nconst[dateRange,setDateRange]=useState('30');// days\nconst[selectedAgent,setSelectedAgent]=useState('all');const[reportType,setReportType]=useState('overview');// overview, financial, customer, agent, operational\n// Loading and sync states\nconst[loading,setLoading]=useState(true);const[refreshing,setRefreshing]=useState(false);const[lastSyncTime,setLastSyncTime]=useState(null);const[connectionStatus,setConnectionStatus]=useState('connected');const[errorMessage,setErrorMessage]=useState('');const[isRealTimeEnabled,setIsRealTimeEnabled]=useState(true);// Helper functions\nconst safeFormatNumber=value=>{if(value===undefined||value===null||isNaN(value)){return'0';}return value.toLocaleString();};const safeNumber=value=>{if(value===undefined||value===null||isNaN(value)){return 0;}return value;};// Real-time data loading from backend API with trip_sharing data\nconst loadRealTimeReportsData=useCallback(async()=>{try{setRefreshing(true);setErrorMessage('');console.log('ðŸ“Š Loading real-time reports data from backend API...');const API_URL=process.env.REACT_APP_API_URL||'http://localhost:3001';const token=localStorage.getItem('token');if(!token){throw new Error('No authentication token found');}// Load all required data from backend API in parallel\nconst[agentsResponse,customersResponse,tripsResponse]=await Promise.all([fetch(\"\".concat(API_URL,\"/api/agents\"),{headers:{'Authorization':\"Bearer \".concat(token)}}),fetch(\"\".concat(API_URL,\"/api/customers\"),{headers:{'Authorization':\"Bearer \".concat(token)}}),fetch(\"\".concat(API_URL,\"/api/trips\"),{headers:{'Authorization':\"Bearer \".concat(token)}})]);if(!agentsResponse.ok||!customersResponse.ok||!tripsResponse.ok){throw new Error('Failed to fetch data from backend API');}const[agentsResult,customersResult,tripsResult]=await Promise.all([agentsResponse.json(),customersResponse.json(),tripsResponse.json()]);const agentsData=agentsResult.data||[];const customersData=customersResult.data||[];const tripsData=tripsResult.data||[];// This includes trip_sharing data\n// Process customers with data from backend (already includes totals)\nconst processedCustomers=customersData.map(customer=>{return _objectSpread(_objectSpread({},customer),{},{totalRolling:customer.totalRolling||0,totalWinLoss:customer.totalWinLoss||0,totalBuyIn:customer.totalBuyIn||0,totalBuyOut:customer.totalBuyOut||0,attachments:customer.attachments||[],isAgent:customer.isAgent||false,rollingPercentage:customer.rollingPercentage||1.4,creditLimit:customer.creditLimit||0,availableCredit:customer.availableCredit||0});});// Process trips with trip_sharing data from backend API\nconst processedTrips=tripsData.map(trip=>{// Use trip_sharing data from backend API\nconst sharing=trip.sharing||{total_win_loss:0,total_expenses:0,total_rolling:0,total_buy_in:0,total_buy_out:0,net_cash_flow:0,net_result:0,total_agent_share:0,company_share:0,agent_share_percentage:0,company_share_percentage:100,agent_breakdown:[]};const totalRolling=(sharing===null||sharing===void 0?void 0:sharing.total_rolling)||0;return _objectSpread(_objectSpread({},trip),{},{totalRolling:totalRolling,totalWinLoss:(sharing===null||sharing===void 0?void 0:sharing.total_win_loss)||0,totalBuyIn:(sharing===null||sharing===void 0?void 0:sharing.total_buy_in)||0,totalBuyOut:(sharing===null||sharing===void 0?void 0:sharing.total_buy_out)||0,calculatedTotalRolling:totalRolling*0.014,attachments:trip.attachments||[],sharing:{totalWinLoss:(sharing===null||sharing===void 0?void 0:sharing.total_win_loss)||0,totalExpenses:(sharing===null||sharing===void 0?void 0:sharing.total_expenses)||0,totalRollingCommission:totalRolling*0.014,totalBuyIn:(sharing===null||sharing===void 0?void 0:sharing.total_buy_in)||0,totalBuyOut:(sharing===null||sharing===void 0?void 0:sharing.total_buy_out)||0,netCashFlow:(sharing===null||sharing===void 0?void 0:sharing.net_cash_flow)||0,netResult:(sharing===null||sharing===void 0?void 0:sharing.net_result)||0,totalAgentShare:(sharing===null||sharing===void 0?void 0:sharing.total_agent_share)||0,companyShare:(sharing===null||sharing===void 0?void 0:sharing.company_share)||0,agentSharePercentage:(sharing===null||sharing===void 0?void 0:sharing.agent_share_percentage)||0,companySharePercentage:(sharing===null||sharing===void 0?void 0:sharing.company_share_percentage)||100,agentBreakdown:(sharing===null||sharing===void 0?void 0:sharing.agent_breakdown)||[]}});});// Set processed data\nsetAgents(agentsData);setCustomers(processedCustomers);setTrips(processedTrips);setRollingRecords([]);// Not used anymore\nsetBuyInOutRecords([]);// Not used anymore\nsetLastSyncTime(new Date());setConnectionStatus('connected');console.log(\"\\u2705 Real-time reports data loaded from backend API: \".concat(processedCustomers.length,\" customers, \").concat(agentsData.length,\" agents, \").concat(processedTrips.length,\" trips with trip_sharing data\"));}catch(error){console.error('âŒ Error loading real-time reports data:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';setErrorMessage(\"Failed to load reports data: \".concat(errorMessage));setConnectionStatus('error');}finally{setLoading(false);setRefreshing(false);}},[]);// Real-time data sync with automatic refresh\nuseEffect(()=>{loadRealTimeReportsData();// Set up real-time refresh interval\nlet refreshInterval;if(isRealTimeEnabled){refreshInterval=setInterval(()=>{console.log('ðŸ“Š Real-time reports refresh triggered');loadRealTimeReportsData();},REAL_TIME_REFRESH_INTERVAL);}return()=>{if(refreshInterval){clearInterval(refreshInterval);}};},[loadRealTimeReportsData,isRealTimeEnabled]);// Toggle real-time updates\nconst toggleRealTime=()=>{setIsRealTimeEnabled(!isRealTimeEnabled);if(!isRealTimeEnabled){loadRealTimeReportsData();// Refresh immediately when re-enabling\n}};// Filter data based on user role and filters\nconst getFilteredData=()=>{let filteredCustomers=customers;let filteredTrips=trips;let filteredRollingRecords=[];// Not used anymore\nlet filteredBuyInOutRecords=[];// Not used anymore\n// Apply user role filter\nif(user.role==='agent'&&user.agentId){filteredCustomers=customers.filter(c=>c.agentId===user.agentId);filteredTrips=trips.filter(t=>t.agents&&t.agents.some(agent=>agent.agentId===user.agentId)||t.agentId===user.agentId);}else if(user.role==='staff'&&user.staffId){// Staff can only see trips they are assigned to\nfilteredTrips=trips.filter(t=>t.staffId===user.staffId);// Filter customers based on trips\nconst tripCustomerIds=Array.from(new Set(filteredTrips.flatMap(t=>{var _t$customers;return((_t$customers=t.customers)===null||_t$customers===void 0?void 0:_t$customers.map(tc=>tc.customerId))||[];})));filteredCustomers=customers.filter(c=>tripCustomerIds.includes(c.id));}// Apply agent filter (admin only)\nif(user.role==='admin'&&selectedAgent!=='all'){filteredCustomers=filteredCustomers.filter(c=>c.agentId===selectedAgent);filteredTrips=filteredTrips.filter(t=>t.agents&&t.agents.some(agent=>agent.agentId===selectedAgent)||t.agentId===selectedAgent);}// Apply date range filter\nconst cutoffDate=new Date();cutoffDate.setDate(cutoffDate.getDate()-parseInt(dateRange));filteredTrips=filteredTrips.filter(t=>new Date(t.date)>=cutoffDate);return{filteredCustomers,filteredTrips,filteredRollingRecords,filteredBuyInOutRecords};};const{filteredCustomers,filteredTrips,filteredRollingRecords,filteredBuyInOutRecords}=getFilteredData();// Calculate comprehensive metrics from trip_sharing data\nconst calculateMetrics=()=>{// Company totals from trip_sharing data\nconst companyTotalRolling=filteredTrips.reduce((sum,t)=>{var _t$sharing;return sum+safeNumber((_t$sharing=t.sharing)===null||_t$sharing===void 0?void 0:_t$sharing.totalRollingCommission);},0);const companyTotalWinLoss=filteredTrips.reduce((sum,t)=>{var _t$sharing2;return sum+safeNumber((_t$sharing2=t.sharing)===null||_t$sharing2===void 0?void 0:_t$sharing2.totalWinLoss);},0);const companyTotalBuyIn=filteredTrips.reduce((sum,t)=>{var _t$sharing3;return sum+safeNumber((_t$sharing3=t.sharing)===null||_t$sharing3===void 0?void 0:_t$sharing3.totalBuyIn);},0);const companyTotalBuyOut=filteredTrips.reduce((sum,t)=>{var _t$sharing4;return sum+safeNumber((_t$sharing4=t.sharing)===null||_t$sharing4===void 0?void 0:_t$sharing4.totalBuyOut);},0);const companyTotalExpenses=filteredTrips.reduce((sum,t)=>{var _t$sharing5;return sum+safeNumber((_t$sharing5=t.sharing)===null||_t$sharing5===void 0?void 0:_t$sharing5.totalExpenses);},0);const companyNetResult=filteredTrips.reduce((sum,t)=>{var _t$sharing6;return sum+safeNumber((_t$sharing6=t.sharing)===null||_t$sharing6===void 0?void 0:_t$sharing6.netResult);},0);const companyShare=filteredTrips.reduce((sum,t)=>{var _t$sharing7;return sum+safeNumber((_t$sharing7=t.sharing)===null||_t$sharing7===void 0?void 0:_t$sharing7.companyShare);},0);// Trip totals for display\nconst tripTotalRolling=filteredTrips.reduce((sum,t)=>sum+safeNumber(t.totalRolling),0);const tripTotalWinLoss=filteredTrips.reduce((sum,t)=>sum+safeNumber(t.totalWinLoss),0);const totalRollingCommission=companyTotalRolling;const totalExpenses=companyTotalExpenses;// House performance from company perspective (trip_sharing data)\nconst houseGrossWin=Math.abs(companyTotalWinLoss);// Always show absolute value\nconst houseNetWin=Math.abs(companyNetResult-totalExpenses);// Company net after expenses\nconst houseFinalProfit=Math.abs(companyShare);// Final company share\n// Customer metrics\nconst totalCustomers=filteredCustomers.length;const activeCustomers=filteredCustomers.filter(c=>c.isActive).length;// Agent metrics\nconst totalAgents=agents.length;const activeAgents=agents.filter(a=>a.status==='active').length;// Trip metrics\nconst totalTrips=filteredTrips.length;const completedTrips=filteredTrips.filter(t=>t.status==='completed').length;const ongoingTrips=filteredTrips.filter(t=>t.status==='in-progress').length;// Performance ratios\nconst profitMargin=companyTotalRolling>0?houseFinalProfit/companyTotalRolling*100:0;const averageRollingPercentage=filteredCustomers.length>0?filteredCustomers.reduce((sum,c)=>sum+c.rollingPercentage,0)/filteredCustomers.length:1.4;return{customerTotalRolling:companyTotalRolling,customerTotalWinLoss:companyTotalWinLoss,customerTotalBuyIn:companyTotalBuyIn,customerTotalBuyOut:companyTotalBuyOut,tripTotalRolling,tripTotalWinLoss,totalRollingCommission,totalExpenses,houseGrossWin,houseNetWin,houseFinalProfit,totalCustomers,activeCustomers,totalAgents,activeAgents,totalTrips,completedTrips,ongoingTrips,profitMargin,averageRollingPercentage,totalRollingRecords:filteredTrips.length,// Number of trips with sharing data\ntotalBuyInOutRecords:filteredTrips.filter(t=>{var _t$sharing8,_t$sharing9;return(((_t$sharing8=t.sharing)===null||_t$sharing8===void 0?void 0:_t$sharing8.totalBuyIn)||0)>0||(((_t$sharing9=t.sharing)===null||_t$sharing9===void 0?void 0:_t$sharing9.totalBuyOut)||0)>0;}).length,// Company performance indicators\ncompanyNetResult,companyShare,isCompanyProfitable:companyShare>0};};const metrics=calculateMetrics();// Prepare chart data from trip_sharing data\nconst getDailyChartData=()=>{const dailyData={};// Process trips by date using trip_sharing data\nfilteredTrips.forEach(trip=>{const date=trip.date.split('T')[0];// Get date part only\nif(!dailyData[date]){dailyData[date]={date,rolling:0,winLoss:0,commission:0,buyIn:0,buyOut:0,netCashFlow:0,expenses:0,companyShare:0,recordCount:0,transactions:0};}// Use trip_sharing data\nconst sharing=trip.sharing||{};dailyData[date].rolling+=safeNumber(sharing.totalRollingCommission);dailyData[date].winLoss+=safeNumber(sharing.totalWinLoss);dailyData[date].commission+=safeNumber(sharing.totalRollingCommission);dailyData[date].buyIn+=safeNumber(sharing.totalBuyIn);dailyData[date].buyOut+=safeNumber(sharing.totalBuyOut);dailyData[date].expenses+=safeNumber(sharing.totalExpenses);dailyData[date].companyShare+=safeNumber(sharing.companyShare);dailyData[date].netCashFlow+=safeNumber(sharing.netCashFlow);dailyData[date].recordCount+=1;dailyData[date].transactions+=(sharing.totalBuyIn||0)>0||(sharing.totalBuyOut||0)>0?1:0;});return Object.values(dailyData).sort((a,b)=>new Date(a.date).getTime()-new Date(b.date).getTime());};const chartData=getDailyChartData();// Agent performance data (admin only)\nconst getAgentPerformanceData=()=>{if(user.role!=='admin')return[];return agents.map(agent=>{const agentCustomers=filteredCustomers.filter(c=>c.agentId===agent.id);const agentRollingRecords=filteredRollingRecords.filter(r=>r.agentId===agent.id);const agentBuyInOutRecords=filteredBuyInOutRecords.filter(b=>{const customer=customers.find(c=>c.id===b.customerId);return(customer===null||customer===void 0?void 0:customer.agentId)===agent.id;});const agentTrips=filteredTrips.filter(t=>t.agents&&t.agents.some(a=>a.agentId===agent.id)||t.agentId===agent.id);const rolling=agentRollingRecords.reduce((sum,r)=>sum+safeNumber(r.rollingAmount),0);const winLoss=agentRollingRecords.reduce((sum,r)=>sum+safeNumber(r.winLoss),0);const buyIn=agentBuyInOutRecords.filter(r=>r.transactionType==='buy-in').reduce((sum,r)=>sum+r.amount,0);const buyOut=agentBuyInOutRecords.filter(r=>r.transactionType==='buy-out').reduce((sum,r)=>sum+r.amount,0);return{name:agent.name,customers:agentCustomers.length,activeCustomers:agentCustomers.filter(c=>c.isActive).length,rolling,winLoss,buyIn,buyOut,netCashFlow:buyOut-buyIn,commission:rolling*0.014,trips:agentTrips.length,rollingRecords:agentRollingRecords.length,buyInOutRecords:agentTrips.filter(t=>{var _t$sharing0,_t$sharing1;return(((_t$sharing0=t.sharing)===null||_t$sharing0===void 0?void 0:_t$sharing0.totalBuyIn)||0)>0||(((_t$sharing1=t.sharing)===null||_t$sharing1===void 0?void 0:_t$sharing1.totalBuyOut)||0)>0;}).length,averageRollingPercentage:agentCustomers.length>0?agentCustomers.reduce((sum,c)=>sum+c.rollingPercentage,0)/agentCustomers.length:0};}).filter(agent=>agent.rolling>0||agent.customers>0);};const agentPerformanceData=getAgentPerformanceData();// Top customers data\nconst getTopCustomersData=()=>{return filteredCustomers.map(customer=>{const customerRollingRecords=filteredRollingRecords.filter(r=>r.customerId===customer.id);const customerBuyInOutRecords=filteredBuyInOutRecords.filter(b=>b.customerId===customer.id);const rolling=customerRollingRecords.reduce((sum,r)=>sum+safeNumber(r.rollingAmount),0);const winLoss=customerRollingRecords.reduce((sum,r)=>sum+safeNumber(r.winLoss),0);const buyIn=customerBuyInOutRecords.filter(r=>r.transactionType==='buy-in').reduce((sum,r)=>sum+r.amount,0);const buyOut=customerBuyInOutRecords.filter(r=>r.transactionType==='buy-out').reduce((sum,r)=>sum+r.amount,0);return _objectSpread(_objectSpread({},customer),{},{periodRolling:rolling,periodWinLoss:winLoss,periodBuyIn:buyIn,periodBuyOut:buyOut,periodNetCashFlow:buyOut-buyIn,periodCommission:rolling*(customer.rollingPercentage/100),recordCount:customerRollingRecords.length,transactionCount:customerBuyInOutRecords.length});}).filter(customer=>customer.periodRolling>0).sort((a,b)=>b.periodRolling-a.periodRolling).slice(0,10);};const topCustomersData=getTopCustomersData();// Export functionality\nconst handleExport=()=>{const reportData={generatedAt:new Date().toISOString(),dateRange:dateRange,selectedAgent:selectedAgent,userRole:user.role,summary:metrics,dailyData:chartData,topCustomers:topCustomersData,agentPerformance:agentPerformanceData,rawData:{customers:filteredCustomers.length,trips:filteredTrips.length,rollingRecords:filteredRollingRecords.length,buyInOutRecords:filteredBuyInOutRecords.length}};const blob=new Blob([JSON.stringify(reportData,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"casino-reports-\".concat(new Date().toISOString().split('T')[0],\".json\");document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);};// Show loading state\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-gray-600\",children:\"Loading real-time reports data from Supabase...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-purple-50 border border-purple-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 text-purple-600 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-purple-800\",children:\"\\uD83D\\uDCCA Real-time Reports & Analytics - Live Data from Supabase\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-purple-600\",children:[\"All reports are generated from live data including rolling records, buy-in/out transactions, and trip information.\",lastSyncTime&&\" \\u2022 Last sync: \".concat(lastSyncTime.toLocaleTimeString())]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[refreshing&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-blue-600\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4 mr-1 animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Syncing...\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:loadRealTimeReportsData,disabled:refreshing,className:\"text-xs\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Refresh\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:toggleRealTime,className:\"text-xs\",children:[/*#__PURE__*/_jsx(Zap,{className:\"w-3 h-3 mr-1 \".concat(isRealTimeEnabled?'text-green-500':'text-gray-500')}),isRealTimeEnabled?'Live':'Manual']}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs \".concat(connectionStatus==='connected'?'bg-green-50 text-green-700':'bg-red-50 text-red-700'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full mr-1 \".concat(connectionStatus==='connected'?'bg-green-500 animate-pulse':'bg-red-500')}),connectionStatus==='connected'?'Live Data':'Error']})]})]})}),errorMessage&&/*#__PURE__*/_jsxs(Alert,{className:\"border-red-200 bg-red-50\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsxs(AlertDescription,{className:\"text-red-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Reports Error:\"}),\" \",errorMessage,/*#__PURE__*/_jsxs(Button,{onClick:loadRealTimeReportsData,size:\"sm\",variant:\"outline\",className:\"ml-3 text-red-800 border-red-300 hover:bg-red-100\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Retry\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Real-time Reports & Analytics\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[user.role==='agent'?'Performance overview for your customers':user.role==='staff'?'Reports for your recorded transactions':'Comprehensive business analytics',\" \\u2022 Live data from Supabase\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Showing data for last \",dateRange,\" days \\u2022 \",metrics.totalRollingRecords,\" rolling records \\u2022 \",metrics.totalBuyInOutRecords,\" buy-in/out transactions\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsxs(Select,{value:dateRange,onValueChange:setDateRange,children:[/*#__PURE__*/_jsx(SelectTrigger,{className:\"w-32\",children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Date range\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"7\",children:\"Last 7 days\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"30\",children:\"Last 30 days\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"90\",children:\"Last 90 days\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"365\",children:\"Last year\"})]})]}),user.role==='admin'&&/*#__PURE__*/_jsxs(Select,{value:selectedAgent,onValueChange:setSelectedAgent,children:[/*#__PURE__*/_jsx(SelectTrigger,{className:\"w-40\",children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"All agents\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"all\",children:\"All Agents\"}),agents.map(agent=>/*#__PURE__*/_jsx(SelectItem,{value:agent.id,children:agent.name},agent.id))]})]}),/*#__PURE__*/_jsxs(Select,{value:reportType,onValueChange:setReportType,children:[/*#__PURE__*/_jsx(SelectTrigger,{className:\"w-36\",children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Report type\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"overview\",children:\"Overview\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"financial\",children:\"Financial\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"customer\",children:\"Customer\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"operational\",children:\"Operational\"})]})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:handleExport,children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 mr-2\"}),\"Export\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium mb-4\",children:\"Key Performance Metrics\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6\",children:[/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-blue-800\",children:\"Total Rolling\"}),/*#__PURE__*/_jsx(DollarSign,{className:\"h-4 w-4 text-blue-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-blue-700\",children:[\"HK$\",safeFormatNumber(metrics.customerTotalRolling)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-blue-600\",children:[metrics.totalRollingRecords,\" rolling records \\u2022 Last \",dateRange,\" days\"]})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-purple-50 to-purple-100 border-purple-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-purple-800\",children:\"Commission\"}),/*#__PURE__*/_jsx(Percent,{className:\"h-4 w-4 text-purple-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-purple-700\",children:[\"HK$\",safeFormatNumber(metrics.customerTotalRolling*0.014)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-purple-600\",children:[metrics.averageRollingPercentage.toFixed(1),\"% avg rolling rate\"]})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-green-50 to-green-100 border-green-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-green-800\",children:\"House P&L\"}),metrics.houseGrossWin>=0?/*#__PURE__*/_jsx(Trophy,{className:\"h-4 w-4 text-green-600\"}):/*#__PURE__*/_jsx(TrendingDown,{className:\"h-4 w-4 text-red-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold \".concat(metrics.houseGrossWin>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(metrics.houseGrossWin))]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-600\",children:metrics.houseGrossWin>=0?'House Win':'Customer Win'})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-orange-50 to-orange-100 border-orange-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-orange-800\",children:\"Cash Flow\"}),/*#__PURE__*/_jsx(ArrowUpCircle,{className:\"h-4 w-4 text-orange-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-orange-700\",children:[\"HK$\",safeFormatNumber(metrics.customerTotalBuyOut-metrics.customerTotalBuyIn)]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-orange-600\",children:\"Net: Buy-out - Buy-in\"})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium\",children:\"Active Customers\"}),/*#__PURE__*/_jsx(Users,{className:\"h-4 w-4 text-muted-foreground\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:metrics.activeCustomers}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground\",children:[\"of \",metrics.totalCustomers,\" total customers\"]})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Daily Rolling Volume & Commission\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Real-time rolling amounts and calculated commission over time\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:300,children:/*#__PURE__*/_jsxs(ComposedChart,{data:chartData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{formatter:(value,name)=>[\"HK$\".concat(Number(value).toLocaleString()),name==='rolling'?'Rolling':name==='commission'?'Commission':'Win/Loss']}),/*#__PURE__*/_jsx(Bar,{dataKey:\"rolling\",fill:\"#8884d8\",name:\"rolling\"}),/*#__PURE__*/_jsx(Bar,{dataKey:\"commission\",fill:\"#82ca9d\",name:\"commission\"}),/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"winLoss\",stroke:\"#ff7c7c\",strokeWidth:2,name:\"winLoss\"})]})})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Daily Cash Flow Analysis\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Buy-in vs Buy-out amounts and net cash flow\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:300,children:/*#__PURE__*/_jsxs(AreaChart,{data:chartData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{formatter:(value,name)=>[\"HK$\".concat(Number(value).toLocaleString()),name==='buyIn'?'Buy-in':name==='buyOut'?'Buy-out':'Net Flow']}),/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:\"buyIn\",stackId:\"1\",stroke:\"#8884d8\",fill:\"#8884d8\",name:\"buyIn\"}),/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:\"buyOut\",stackId:\"1\",stroke:\"#82ca9d\",fill:\"#82ca9d\",name:\"buyOut\"}),/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"netCashFlow\",stroke:\"#ff7c7c\",strokeWidth:2,name:\"netCashFlow\"})]})})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Transaction Volume\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Daily activity levels\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:200,children:/*#__PURE__*/_jsxs(BarChart,{data:chartData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"recordCount\",fill:\"#8884d8\",name:\"Rolling Records\"}),/*#__PURE__*/_jsx(Bar,{dataKey:\"transactions\",fill:\"#82ca9d\",name:\"Buy-in/out\"})]})})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Performance Summary\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Key operational metrics\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-blue-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-blue-800\",children:\"Total Trips\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-blue-700\",children:metrics.totalTrips})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-green-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-green-800\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-green-700\",children:metrics.completedTrips})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-orange-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-orange-800\",children:\"Ongoing\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-orange-700\",children:metrics.ongoingTrips})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-purple-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-purple-800\",children:\"Profit Margin\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold text-purple-700\",children:[metrics.profitMargin.toFixed(1),\"%\"]})]})]})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Activity Overview\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Recent period summary\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-5 h-5 text-blue-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium\",children:\"Rolling Records\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl font-bold text-blue-600\",children:metrics.totalRollingRecords})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(ArrowUpDown,{className:\"w-5 h-5 text-green-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium\",children:\"Buy-in/out Records\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl font-bold text-green-600\",children:metrics.totalBuyInOutRecords})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-5 h-5 text-purple-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium\",children:\"Active Users\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl font-bold text-purple-600\",children:metrics.activeCustomers})]})]})]})})]})]}),topCustomersData.length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Top Performing Customers\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Highest rolling volume customers for the selected period \\u2022 Sorted by rolling amount\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:topCustomersData.map((customer,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-gradient-to-r from-blue-100 to-purple-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-medium\",children:index+1}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:customer.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"Agent: \",customer.agentName,\" \\u2022 \",customer.rollingPercentage,\"% rolling rate\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-400\",children:[customer.recordCount,\" records \\u2022 \",customer.transactionCount,\" transactions\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-4 gap-4 text-right text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Rolling\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-600\",children:[\"HK$\",safeFormatNumber(customer.periodRolling)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Win/Loss\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(customer.periodWinLoss>=0?'text-red-600':'text-green-600'),children:[customer.periodWinLoss>=0?'+':'',\"HK$\",safeFormatNumber(customer.periodWinLoss)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Commission\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-purple-600\",children:[\"HK$\",safeFormatNumber(customer.periodCommission)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Cash Flow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(customer.periodNetCashFlow>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(customer.periodNetCashFlow)]})]})]})]},customer.id))})})]}),user.role==='admin'&&agentPerformanceData.length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Agent Performance Analysis\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Comprehensive performance metrics by agent for the selected period\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Agent\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Customers\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Rolling Volume\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Commission\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Win/Loss\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Cash Flow\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Activity\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:agentPerformanceData.map(agent=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:agent.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[agent.averageRollingPercentage.toFixed(1),\"% avg rate\"]})]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[agent.activeCustomers,\"/\",agent.customers]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-400\",children:\"active/total\"})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium\",children:[\"HK$\",safeFormatNumber(agent.rolling)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-blue-600\",children:[agent.trips,\" trips\"]})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-purple-600 font-medium\",children:[\"HK$\",safeFormatNumber(agent.commission)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:/*#__PURE__*/_jsxs(\"span\",{className:agent.winLoss>=0?'text-red-600':'text-green-600',children:[agent.winLoss>=0?'+':'',\"HK$\",safeFormatNumber(agent.winLoss)]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(agent.netCashFlow>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(agent.netCashFlow)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[\"In: HK$\",safeFormatNumber(agent.buyIn),\" \\u2022 Out: HK$\",safeFormatNumber(agent.buyOut)]})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[agent.rollingRecords,\" rolling\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[agent.buyInOutRecords,\" buy-in/out\"]})]})]},agent.name))})]})})})]})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}