{"ast":null,"code":"import React from'react';import{Badge}from'../ui/badge';import{ImageWithFallback}from'../figma/ImageWithFallback';import{X,Download}from'lucide-react';// CSS 样式用于自定义滚动条\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const scrollbarStyles=\"\\n  .photo-scroll-container::-webkit-scrollbar {\\n    width: 6px;\\n  }\\n  .photo-scroll-container::-webkit-scrollbar-track {\\n    background: #f7fafc;\\n    border-radius: 3px;\\n  }\\n  .photo-scroll-container::-webkit-scrollbar-thumb {\\n    background: #cbd5e0;\\n    border-radius: 3px;\\n  }\\n  .photo-scroll-container::-webkit-scrollbar-thumb:hover {\\n    background: #a0aec0;\\n  }\\n\";// 将样式注入到页面中\nif(typeof document!=='undefined'&&!document.getElementById('photo-scroll-styles')){const style=document.createElement('style');style.id='photo-scroll-styles';style.textContent=scrollbarStyles;document.head.appendChild(style);}export const PhotoDisplay=_ref=>{let{photos,type='transaction',size='medium',maxPhotos=4,onPhotoClick,onPhotoDelete,showDelete=true,showDownload=false,userRole='',customerName=''}=_ref;// 统一的照片数据验证\nconst isValidPhotoData=photoData=>{if(!photoData)return false;return photoData.startsWith('data:image/')&&!photoData.includes('base64,test')&&photoData.length>100;};// 过滤有效照片\nconst validPhotos=photos.filter(photo=>{var _photo$photo;return((_photo$photo=photo.photo)===null||_photo$photo===void 0?void 0:_photo$photo.data)&&isValidPhotoData(photo.photo.data);});// 显示的照片（限制数量）\nconst displayPhotos=validPhotos.slice(0,maxPhotos);// 统一的尺寸样式 - 响应式高度\nconst getSizeClasses=()=>{switch(size){case'small':return'h-24 sm:h-20 w-full';// 小尺寸：移动端24，桌面端20\ncase'medium':return'h-32 sm:h-24 w-full';// 中尺寸：移动端32，桌面端24\ncase'large':return'h-40 sm:h-32 w-full';// 大尺寸：移动端40，桌面端32\ndefault:return'h-32 sm:h-24 w-full';}};// 网格布局类 - 移动优先设计\nconst getGridClasses=()=>{if(size==='large'){// 大尺寸照片 (ProjectManagement)\nif(validPhotos.length===1)return'grid-cols-1';return'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3';}else{// 中小尺寸照片 (StaffSelfService)\nif(validPhotos.length===1)return'grid-cols-1';return'grid-cols-1 sm:grid-cols-2';}};// 状态颜色\nconst getStatusBadgeClass=status=>{switch(status){case'approved':return'bg-green-100 text-green-800';case'rejected':return'bg-red-100 text-red-800';case'pending':default:return'bg-yellow-100 text-yellow-800';}};// 下载照片功能\nconst handlePhotoDownload=photo=>{if(userRole!=='admin'){alert('只有管理员可以下载照片');return;}try{// 创建下载链接\nconst link=document.createElement('a');link.href=photo.photo.data;// 生成文件名：CustomerName.Type.Date\nconst timestamp=photo.transaction_date?new Date(photo.transaction_date).toISOString().split('T')[0]:new Date().toISOString().split('T')[0];// 清理客户名称，移除特殊字符\nconst cleanCustomerName=customerName?customerName.replace(/[^a-zA-Z0-9\\u4e00-\\u9fff]/g,'_'):'Customer';// 首字母大写的类型\nconst typeCapitalized=type.charAt(0).toUpperCase()+type.slice(1);const filename=\"\".concat(cleanCustomerName,\".\").concat(typeCapitalized,\".\").concat(timestamp,\".jpg\");link.download=filename;link.style.display='none';// 添加到页面，点击下载，然后移除\ndocument.body.appendChild(link);link.click();document.body.removeChild(link);console.log('✅ Photo downloaded:',filename);}catch(error){console.error('Download failed:',error);alert('下载失败，请重试');}};// 默认点击处理（打开模态框）\nconst handlePhotoClick=photo=>{if(onPhotoClick){onPhotoClick(photo);return;}// 默认模态框实现\nconst modal=document.createElement('div');modal.className='fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';modal.innerHTML=\"\\n      <div class=\\\"relative max-w-4xl max-h-4xl p-4\\\">\\n        <img src=\\\"\".concat(photo.photo.data,\"\\\" class=\\\"max-w-full max-h-full object-contain rounded\\\" />\\n        <button class=\\\"absolute top-2 right-2 text-white bg-black bg-opacity-50 rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-75\\\">\\xD7</button>\\n        <div class=\\\"absolute bottom-2 left-2 text-white bg-black bg-opacity-50 px-2 py-1 rounded text-sm\\\">\\n          \").concat(photo.upload_date?new Date(photo.upload_date).toLocaleDateString():'',\" \\n          \").concat(photo.status?\"- \".concat(photo.status):'',\"\\n          \").concat(photo.photo.filename?\"- \".concat(photo.photo.filename):'',\"\\n        </div>\\n      </div>\\n    \");document.body.appendChild(modal);modal.addEventListener('click',e=>{const target=e.target;if(target===modal||(target===null||target===void 0?void 0:target.textContent)==='×'){document.body.removeChild(modal);}});};if(displayPhotos.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(getSizeClasses(),\" bg-gray-100 rounded border flex items-center justify-center\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-6 h-6 mx-auto mb-1 opacity-30\",children:/*#__PURE__*/_jsx(\"svg\",{fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\",clipRule:\"evenodd\"})})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400\",children:\"No photo\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"max-h-80 sm:max-h-64 overflow-y-auto photo-scroll-container\",style:{scrollbarWidth:'thin',scrollbarColor:'#CBD5E0 #F7FAFC'},children:/*#__PURE__*/_jsx(\"div\",{className:\"grid \".concat(getGridClasses(),\" gap-3 sm:gap-4 p-2 sm:p-1\"),children:validPhotos.map((photo,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"relative group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(ImageWithFallback,{src:photo.photo.data,alt:\"\".concat(type,\" \").concat(index+1),className:\"\".concat(getSizeClasses(),\" object-cover cursor-pointer w-full\"),onClick:()=>handlePhotoClick(photo)}),photo.status&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-2 left-2\",children:/*#__PURE__*/_jsx(Badge,{className:\"text-xs \".concat(getStatusBadgeClass(photo.status),\" shadow-sm\"),children:photo.status.charAt(0).toUpperCase()+photo.status.slice(1)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute top-2 right-2 flex space-x-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200\",children:[showDownload&&userRole==='admin'&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();handlePhotoDownload(photo);},className:\"bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white rounded-full p-2.5 sm:p-2 shadow-lg backdrop-blur-sm z-10 transition-colors touch-manipulation\",title:\"\\u4E0B\\u8F7D\\u7167\\u7247\",children:/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 sm:w-3 sm:h-3\"})}),showDelete&&onPhotoDelete&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();if(window.confirm('确定要删除这张照片吗？')){onPhotoDelete(photo.id);}},className:\"bg-red-500 hover:bg-red-600 active:bg-red-700 text-white rounded-full p-2.5 sm:p-2 shadow-lg backdrop-blur-sm z-10 transition-colors touch-manipulation\",title:\"\\u5220\\u9664\\u7167\\u7247\",children:/*#__PURE__*/_jsx(X,{className:\"w-4 h-4 sm:w-3 sm:h-3\"})})]})]}),photo.transaction_date&&/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2.5 sm:py-2 bg-gray-50 border-t\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm sm:text-xs text-gray-600 text-center font-medium\",children:new Date(photo.transaction_date).toLocaleDateString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit'})})})]})},photo.id))})}),validPhotos.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2 text-sm sm:text-xs text-gray-500 bg-gray-50 rounded-md py-2.5 sm:py-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:validPhotos.length}),/*#__PURE__*/_jsx(\"span\",{children:validPhotos.length===1?'photo':'photos'})]})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}