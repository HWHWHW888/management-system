{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Button}from'./ui/button';import{Alert,AlertDescription}from'./ui/alert';import{Badge}from'./ui/badge';import{Tabs,TabsContent,TabsList,TabsTrigger}from'./ui/tabs';import{tokenManager}from'../utils/auth/tokenManager';import{Textarea}from'./ui/textarea';import{Input}from'./ui/input';import{Label}from'./ui/label';import{Select,SelectContent,SelectItem,SelectTrigger,SelectValue}from'./ui/select';import{Dialog,DialogContent,DialogDescription,DialogHeader,DialogTitle,DialogTrigger}from'./ui/dialog';import{AlertDialog,AlertDialogAction,AlertDialogCancel,AlertDialogContent,AlertDialogDescription,AlertDialogFooter,AlertDialogHeader,AlertDialogTitle}from'./ui/alert-dialog';import{Table,TableBody,TableCell,TableHead,TableHeader,TableRow}from'./ui/table';import{db}from'../utils/supabase/supabaseClients';import{apiClient}from'../utils/api/apiClient';import{useLanguage}from'../contexts/LanguageContext';import{isReadOnlyRole}from'../utils/permissions';import{SUPPORTED_CURRENCIES,formatCurrency,formatCurrencyWithSign,getCurrencySymbol}from'../utils/currency';import{MapPin,RefreshCw,Activity,AlertTriangle,Zap,Users,DollarSign,Settings,Plus,Trash2,Eye,BarChart,UserCheck,X,CheckCircle,Share2}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const REAL_TIME_REFRESH_INTERVAL=30000;function ProjectManagementComponent(_ref){var _selectedTrip$custome2,_selectedTrip$custome3,_selectedTrip$custome4,_selectedTrip$agents,_staff,_selectedCustomerForT,_selectedCustomerForR,_staff2;let{user}=_ref;// Default user if not provided\nconst currentUser=user||{role:'admin',agentId:null,username:'admin'};const clearError=useCallback(()=>{},[]);const showError=useCallback(message=>console.error(message),[]);const{t}=useLanguage();const isReadOnly=isReadOnlyRole(currentUser.role);// Utility function for safe number conversion\nconst safeNumber=value=>{const num=parseFloat(value);return isNaN(num)?0:num;};// Data states\nconst[trips,setTrips]=useState([]);const[customers,setCustomers]=useState([]);const[agents,setAgents]=useState([]);const[staff,setStaff]=useState([]);const[selectedTrip,setSelectedTrip]=useState(null);const[activeTab,setActiveTab]=useState('trips');const[selectedTripTab,setSelectedTripTab]=useState('overview');const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[lastSyncTime,setLastSyncTime]=useState(null);const[isRealTimeEnabled,setIsRealTimeEnabled]=useState(true);const[errorMessage,setErrorMessage]=useState('');const[dataLoaded,setDataLoaded]=useState(false);// Trip expenses and sharing states\nconst[tripExpenses,setTripExpenses]=useState([]);const[tripSharing,setTripSharing]=useState(null);const[agentProfits,setAgentProfits]=useState([]);// Form states\nconst[showCreateTrip,setShowCreateTrip]=useState(false);const[showAddCustomer,setShowAddCustomer]=useState(false);const[showEditAgent,setShowEditAgent]=useState(false);const[showDeleteAgent,setShowDeleteAgent]=useState(false);const[showAddStaff,setShowAddStaff]=useState(false);const[showAddTransaction,setShowAddTransaction]=useState(false);const[showAddRolling,setShowAddRolling]=useState(false);const[selectedCustomerForTransaction,setSelectedCustomerForTransaction]=useState(null);const[selectedCustomerForRolling,setSelectedCustomerForRolling]=useState(null);const[showAddExpense,setShowAddExpense]=useState(false);const[expensesLoading,setExpensesLoading]=useState(false);const[sharingLoading,setSharingLoading]=useState(false);// Transaction and Rolling form states\nconst[transactionForm,setTransactionForm]=useState({type:'buy-in',// buy-in, cash-out (database format)\namount:'',description:''});const[rollingForm,setRollingForm]=useState({amount:'',staff_id:'',game_type:'baccarat',description:''});// Form data states\nconst[newTrip,setNewTrip]=useState({name:'',description:'',date:'',endDate:'',venue:'',budget:'',status:'active',currency:'HKD',exchange_rate_peso:1.0000,exchange_rate_hkd:1.0000,exchange_rate_myr:1.0000});// Dynamic currency viewing state - initialize with trip's default currency\nconst[viewingCurrency,setViewingCurrency]=useState('HKD');// Update viewing currency when selected trip changes\nuseEffect(()=>{if(selectedTrip!==null&&selectedTrip!==void 0&&selectedTrip.currency){setViewingCurrency(selectedTrip.currency);console.log('ðŸ”„ Trip changed, updating viewing currency:',{tripId:selectedTrip.id,tripCurrency:selectedTrip.currency,exchangeRates:{peso:selectedTrip.exchange_rate_peso,hkd:selectedTrip.exchange_rate_hkd,myr:selectedTrip.exchange_rate_myr}});}},[selectedTrip]);const[newExpense,setNewExpense]=useState({description:'',amount:0,category:'flight'});const[editAgentShare,setEditAgentShare]=useState(25);const[editingAgent,setEditingAgent]=useState(null);const[deletingAgent,setDeletingAgent]=useState(null);// Helper functions\nconst safeFormatNumber=value=>{if(value===undefined||value===null||isNaN(value))return'0';return value.toLocaleString();};// Permissions\nconst isAdmin=currentUser.role==='admin';const isAgent=currentUser.role==='agent'&&currentUser.agentId;const loadTripExpenses=async tripId=>{try{setExpensesLoading(true);const response=await apiClient.get(\"/trips/\".concat(tripId,\"/expenses\"));if(response.success){setTripExpenses(response.data.expenses||[]);}}catch(error){console.error('Error loading trip expenses:',error);showError('Failed to load trip expenses');}finally{setExpensesLoading(false);}};const loadTripSharing=async tripId=>{try{setSharingLoading(true);const response=await apiClient.get(\"/trips/\".concat(tripId,\"/sharing\"));if(response.success){setTripSharing(response.data);}}catch(error){console.error('Error loading trip sharing:',error);showError('Failed to load trip sharing');}finally{setSharingLoading(false);}};const loadAgentProfits=useCallback(async tripId=>{try{console.log('ðŸ” Loading agent profits for trip:',tripId);const response=await apiClient.get(\"/trips/\".concat(tripId,\"/agents/profits\"));console.log('ðŸ“Š Agent profits API response:',response);if(response.success){console.log('âœ… Agent profits data:',response.data);console.log('âœ… Setting agentProfits state to:',response.data);setAgentProfits(response.data||[]);console.log('âœ… AgentProfits state updated');}else{console.log('âŒ Agent profits API failed:',response);setAgentProfits([]);}}catch(error){console.error('Error loading agent profits:',error);showError('Failed to load agent profits');setAgentProfits([]);}},[showError]);const updateCommissionRate=async(agentId,customerId,commissionRate)=>{try{if(!selectedTrip)return;setSaving(true);const response=await apiClient.put(\"/trips/\".concat(selectedTrip.id,\"/agents/\").concat(agentId,\"/commission\"),{customer_id:customerId,commission_rate:commissionRate});if(response.success){// Reload agent profits to reflect the change\nawait loadAgentProfits(selectedTrip.id);console.log('Commission rate updated successfully');}else{showError('Failed to update commission rate');}}catch(error){console.error('Error updating commission rate:',error);showError('Failed to update commission rate');}finally{setSaving(false);}};const addTripExpense=async(tripId,expenseData)=>{try{setSaving(true);const response=await apiClient.post(\"/trips/\".concat(tripId,\"/expenses\"),expenseData);if(response.success){await loadTripExpenses(tripId);await loadTripSharing(tripId);return true;}return false;}catch(error){console.error('Error adding trip expense:',error);showError('Failed to add trip expense');return false;}finally{setSaving(false);}};// Enhanced data loading with better error handling and caching\nconst loadAllRealTimeData=useCallback(async function(){let forceRefresh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{if(!forceRefresh&&dataLoaded&&trips.length>0){console.log('ðŸ“‹ Using cached data, skipping reload');return;}setLoading(true);setErrorMessage('');clearError();// First ensure we have authentication\nconst token=await tokenManager.getToken();if(!token){console.log('âŒ No authentication token available, attempting auto-login...');// Try to auto-login with admin credentials\ntry{var _loginData$data;const apiUrl=process.env.REACT_APP_API_URL||'http://localhost:3001';const loginResponse=await fetch(\"\".concat(apiUrl,\"/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:'admin',password:'admin123'})});const loginData=await loginResponse.json();if(loginData.success&&(_loginData$data=loginData.data)!==null&&_loginData$data!==void 0&&_loginData$data.token){console.log('âœ… Auto-login successful');tokenManager.setToken(loginData.data.token);// Store user data in localStorage for consistency\nconst userData=_objectSpread(_objectSpread({},loginData.data.user),{},{token:loginData.data.token});localStorage.setItem('casinoUser',JSON.stringify(userData));}else{console.log('âŒ Auto-login failed:',loginData);setErrorMessage('Authentication required. Please login first.');setLoading(false);return;}}catch(error){console.error('âŒ Auto-login error:',error);setErrorMessage('Authentication failed. Please check your connection.');setLoading(false);return;}}// Load basic data first (fast) - no role filtering at database level\nconsole.log('ðŸ” Loading data for user role:',currentUser.role);const[tripsData,customersData,agentsData,staffResponse]=await Promise.all([db.get('trips',[]),db.get('customers',[]),db.get('agents',[]),apiClient.get('/staffs')]);console.log('ðŸ“Š Raw data loaded:',{trips:(tripsData===null||tripsData===void 0?void 0:tripsData.length)||0,customers:(customersData===null||customersData===void 0?void 0:customersData.length)||0,agents:(agentsData===null||agentsData===void 0?void 0:agentsData.length)||0,userRole:currentUser.role});// Extract staff data from API response\nconst staffData=staffResponse.success?staffResponse.data:[];// Transform trips with basic data only (no heavy API calls)\nconst transformedTrips=(tripsData||[]).map(trip=>{var _trip$name,_trip$trip_name;return{id:trip.id,name:trip.trip_name||trip.name||'Unnamed Trip',description:trip.description||'',date:trip.start_date||trip.date,startDate:trip.start_date||trip.date,endDate:trip.end_date||trip.endDate,status:trip.status||'active',budget:trip.total_budget||0,createdAt:trip.created_at||new Date().toISOString(),currency:trip.currency||'HKD',exchange_rate_peso:trip.exchange_rate_peso||1.0,exchange_rate_hkd:trip.exchange_rate_hkd||1.0,exchange_rate_myr:trip.exchange_rate_myr||((_trip$name=trip.name)!==null&&_trip$name!==void 0&&_trip$name.toLowerCase().includes('manila')||(_trip$trip_name=trip.trip_name)!==null&&_trip$trip_name!==void 0&&_trip$trip_name.toLowerCase().includes('manila')?0.6:1.0),customers:[],agents:[],expenses:[],totalRolling:0,totalWinLoss:0,totalBuyIn:0,totalBuyOut:0,calculatedTotalRolling:0,sharing:{totalWinLoss:0,totalExpenses:0,totalRollingCommission:0,totalBuyIn:0,totalBuyOut:0,netResult:0,netCashFlow:0,totalAgentShare:0,companyShare:0,agentSharePercentage:0,companySharePercentage:100,agentShares:[],agentBreakdown:[]},attachments:[],lastDataUpdate:new Date().toISOString(),activeCustomersCount:0,recentActivityCount:0,totalExpenses:0,_dataLoaded:false};});// Set state with basic data immediately for fast UI response\nsetTrips(transformedTrips);setCustomers(customersData||[]);setAgents(agentsData||[]);setStaff(staffData||[]);setLastSyncTime(new Date());setDataLoaded(true);console.log(\"\\u2705 Basic project data loaded quickly: \".concat(transformedTrips.length,\" trips\"));// Load detailed trip data in background (lazy loading)\nif(transformedTrips.length>0){setTimeout(async()=>{try{const enrichedTrips=await Promise.all(transformedTrips.map(async trip=>{try{const[statsResponse,sharingResponse,customersResponse]=await Promise.all([apiClient.get(\"/trips/\".concat(trip.id,\"/statistics\")),apiClient.get(\"/trips/\".concat(trip.id,\"/sharing\")),apiClient.get(\"/trips/\".concat(trip.id,\"/customer-stats\"))]);const tripStats=statsResponse.success?statsResponse.data:null;const tripSharing=sharingResponse.success?sharingResponse.data:null;const tripCustomers=customersResponse.success?customersResponse.data:[];const statsRoot=(tripStats===null||tripStats===void 0?void 0:tripStats.statistics)||tripStats;return _objectSpread(_objectSpread({},trip),{},{customers:tripCustomers,totalRolling:(statsRoot===null||statsRoot===void 0?void 0:statsRoot.total_rolling)||(tripStats===null||tripStats===void 0?void 0:tripStats.total_rolling)||0,totalWinLoss:(statsRoot===null||statsRoot===void 0?void 0:statsRoot.net_profit)||(tripStats===null||tripStats===void 0?void 0:tripStats.net_profit)||0,totalBuyIn:(statsRoot===null||statsRoot===void 0?void 0:statsRoot.total_buy_in)||(tripStats===null||tripStats===void 0?void 0:tripStats.total_buy_in)||0,totalBuyOut:(statsRoot===null||statsRoot===void 0?void 0:statsRoot.total_cash_out)||(tripStats===null||tripStats===void 0?void 0:tripStats.total_cash_out)||0,calculatedTotalRolling:(statsRoot===null||statsRoot===void 0?void 0:statsRoot.total_rolling)||(tripStats===null||tripStats===void 0?void 0:tripStats.total_rolling)||0,sharing:{total_rolling:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_rolling)||0,total_expenses:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_expenses)||0,net_result:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.net_result)||0,totalWinLoss:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_win_loss)||0,totalRollingCommission:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_rolling_commission)||0,totalBuyIn:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_buy_in)||0,totalBuyOut:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_buy_out)||0,netCashFlow:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.net_cash_flow)||0,totalAgentShare:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_agent_share)||0,companyShare:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.company_share)||0,agentSharePercentage:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.agent_share_percentage)||0,companySharePercentage:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.company_share_percentage)||100,agentShares:[],agentBreakdown:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.agent_breakdown)||[]},totalExpenses:(tripSharing===null||tripSharing===void 0?void 0:tripSharing.total_expenses)||0,_dataLoaded:true});}catch(error){console.warn(\"Failed to load detailed data for trip \".concat(trip.id,\":\"),error);return _objectSpread(_objectSpread({},trip),{},{_dataLoaded:false});}}));// Update trips with detailed data\nsetTrips(enrichedTrips);console.log('âœ… Detailed trip data loaded in background');}catch(error){console.warn('Background data loading failed:',error);}},100);// Load detailed data after 100ms\n}}catch(error){console.error('âŒ Error loading data:',error);setErrorMessage(\"Failed to load project data: \".concat(error));showError('Failed to load project data');}finally{setLoading(false);}},[selectedTrip,dataLoaded,trips.length,showError,clearError,currentUser.role]);// Initial data load only\nuseEffect(()=>{loadAllRealTimeData(true);},[loadAllRealTimeData]);// Separate effect for real-time updates (less frequent)\nuseEffect(()=>{let refreshInterval;if(isRealTimeEnabled&&dataLoaded){refreshInterval=setInterval(()=>{console.log('ðŸ”„ Real-time refresh triggered');loadAllRealTimeData(true);},REAL_TIME_REFRESH_INTERVAL*2);// Double the interval to reduce load\n}return()=>{if(refreshInterval){clearInterval(refreshInterval);}};},[isRealTimeEnabled,dataLoaded,loadAllRealTimeData]);// Load detailed data when trip is selected\nuseEffect(()=>{if(selectedTrip){console.log('ðŸŽ¯ Loading detailed data for selected trip:',{tripId:selectedTrip.id,tripName:selectedTrip.name,customers:selectedTrip.customers,agents:selectedTrip.agents});loadAgentProfits(selectedTrip.id);}},[selectedTrip,selectedTripTab,loadAgentProfits]);// Get filtered trips based on user role\nconst getFilteredTrips=()=>{if(currentUser.role==='agent'&&currentUser.agentId){return trips.filter(trip=>{var _trip$agents;return((_trip$agents=trip.agents)===null||_trip$agents===void 0?void 0:_trip$agents.some(agent=>agent.agentId===currentUser.agentId))||trip.agentId===currentUser.agentId;});}// Boss and admin roles can see all trips\nreturn trips;};// Save trips to database\nconst saveTrips=async updatedTrips=>{try{setSaving(true);await db.save('trips',updatedTrips);setTrips(updatedTrips);setLastSyncTime(new Date());console.log('âœ… Trips saved to Supabase');}catch(error){console.error('âŒ Error saving trips:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to save trips: \".concat(errorMessage));throw error;}finally{setSaving(false);}};// Create new trip\nconst handleCreateTrip=async()=>{if(!newTrip.name.trim()||!newTrip.date||!newTrip.venue){showError('Please fill in all required fields (Name, Date, Venue)');return;}try{setSaving(true);// Prepare data for backend API\nconst tripData={trip_name:newTrip.name,destination:newTrip.venue,start_date:newTrip.date,end_date:newTrip.endDate||newTrip.date,total_budget:parseFloat(newTrip.budget)||0,description:newTrip.description||'',status:newTrip.status,currency:newTrip.currency,exchange_rate_peso:newTrip.exchange_rate_peso,exchange_rate_hkd:newTrip.exchange_rate_hkd,exchange_rate_myr:newTrip.exchange_rate_myr};console.log('Creating trip with data:',tripData);// Call backend API to create trip\nconst response=await apiClient.post('/trips',tripData);if(response.success){console.log('âœ… Trip created successfully:',response.data);// Refresh trips list\nawait loadAllRealTimeData();setShowCreateTrip(false);setNewTrip({name:'',description:'',date:'',endDate:'',venue:'',budget:'',status:'active',currency:'HKD',exchange_rate_peso:1.0000,exchange_rate_hkd:1.0000,exchange_rate_myr:1.0000});console.log('âœ… Trip created successfully:',response.data.trip_name);}else{throw new Error(response.error||'Failed to create trip');}}catch(error){console.error('âŒ Error creating trip:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to create trip: \".concat(errorMessage));}finally{setSaving(false);}};// Select trip for detailed view with comprehensive backend data\nconst selectTrip=async trip=>{console.log('ðŸŽ¯ Selecting trip for details:',trip.name);try{var _expensesResponse$dat,_customersResponse$da,_statisticsResponse$d,_statisticsResponse$d2,_statisticsResponse$d3,_statisticsResponse$d4,_statisticsResponse$d5,_statisticsResponse$d6,_statisticsResponse$d7,_statisticsResponse$d8,_statisticsResponse$d9,_statisticsResponse$d0;setLoading(true);// Load comprehensive trip data from backend API\nconst[customersResponse,expensesResponse,sharingResponse,statisticsResponse,transactionsResponse,agentsResponse,staffResponse]=await Promise.all([apiClient.get(\"/trips/\".concat(trip.id,\"/customer-stats\")),apiClient.get(\"/trips/\".concat(trip.id,\"/expenses\")),apiClient.get(\"/trips/\".concat(trip.id,\"/sharing\")),apiClient.get(\"/trips/\".concat(trip.id,\"/statistics\")),apiClient.get(\"/trips/\".concat(trip.id,\"/transactions\")),apiClient.get(\"/trips/\".concat(trip.id,\"/agents\")),apiClient.get(\"/trips/\".concat(trip.id,\"/staff\"))]);console.log('ðŸ“Š Backend API responses:',{customers:customersResponse,expenses:expensesResponse,sharing:sharingResponse,statistics:statisticsResponse,transactions:transactionsResponse,agents:agentsResponse,staff:staffResponse});// Create enriched trip object with actual backend data\nconst enrichedTrip=_objectSpread(_objectSpread({},trip),{},{customers:customersResponse.success?customersResponse.data:[],expenses:expensesResponse.success?((_expensesResponse$dat=expensesResponse.data)===null||_expensesResponse$dat===void 0?void 0:_expensesResponse$dat.expenses)||[]:[],agents:agentsResponse.success?agentsResponse.data:[],staff:staffResponse.success?staffResponse.data:[],sharing:sharingResponse.success?sharingResponse.data:trip.sharing,statistics:statisticsResponse.success?statisticsResponse.data:null,transactions:transactionsResponse.success?transactionsResponse.data:[],activeCustomersCount:customersResponse.success?((_customersResponse$da=customersResponse.data)===null||_customersResponse$da===void 0?void 0:_customersResponse$da.length)||0:trip.activeCustomersCount||0,backendData:{totalBuyIn:statisticsResponse.success?((_statisticsResponse$d=statisticsResponse.data)===null||_statisticsResponse$d===void 0?void 0:(_statisticsResponse$d2=_statisticsResponse$d.statistics)===null||_statisticsResponse$d2===void 0?void 0:_statisticsResponse$d2.total_buy_in)||0:0,totalCashOut:statisticsResponse.success?((_statisticsResponse$d3=statisticsResponse.data)===null||_statisticsResponse$d3===void 0?void 0:(_statisticsResponse$d4=_statisticsResponse$d3.statistics)===null||_statisticsResponse$d4===void 0?void 0:_statisticsResponse$d4.total_cash_out)||0:0,totalWin:statisticsResponse.success?((_statisticsResponse$d5=statisticsResponse.data)===null||_statisticsResponse$d5===void 0?void 0:(_statisticsResponse$d6=_statisticsResponse$d5.statistics)===null||_statisticsResponse$d6===void 0?void 0:_statisticsResponse$d6.total_win)||0:0,totalLoss:statisticsResponse.success?((_statisticsResponse$d7=statisticsResponse.data)===null||_statisticsResponse$d7===void 0?void 0:(_statisticsResponse$d8=_statisticsResponse$d7.statistics)===null||_statisticsResponse$d8===void 0?void 0:_statisticsResponse$d8.total_loss)||0:0,profitMargin:statisticsResponse.success?((_statisticsResponse$d9=statisticsResponse.data)===null||_statisticsResponse$d9===void 0?void 0:(_statisticsResponse$d0=_statisticsResponse$d9.statistics)===null||_statisticsResponse$d0===void 0?void 0:_statisticsResponse$d0.profit_margin)||0:0,customerStatsLoaded:customersResponse.success,expensesLoaded:expensesResponse.success,agentsLoaded:agentsResponse.success,sharingLoaded:sharingResponse.success,statisticsLoaded:statisticsResponse.success,transactionsLoaded:transactionsResponse.success}});// Calculate financial totals from actual backend data\nif(enrichedTrip.customers&&enrichedTrip.customers.length>0){enrichedTrip.totalBuyIn=enrichedTrip.customers.reduce((sum,c)=>sum+safeNumber(c.total_buy_in),0);enrichedTrip.totalBuyOut=enrichedTrip.customers.reduce((sum,c)=>sum+safeNumber(c.total_cash_out),0);enrichedTrip.totalRolling=enrichedTrip.customers.reduce((sum,c)=>sum+safeNumber(c.rolling_amount),0);enrichedTrip.totalWinLoss=enrichedTrip.customers.reduce((sum,c)=>sum+safeNumber(c.net_result),0);}if(enrichedTrip.expenses&&enrichedTrip.expenses.length>0){enrichedTrip.totalExpenses=enrichedTrip.expenses.reduce((sum,e)=>sum+safeNumber(e.amount),0);}console.log('ðŸ“Š Enriched trip with backend data:',enrichedTrip);// Update state variables for tabs to display backend data\nsetTripExpenses(enrichedTrip.expenses||[]);setTripSharing(enrichedTrip.sharing||null);// Load agent profits for the selected trip\nawait loadAgentProfits(trip.id);// Backend data status is already included in the initial backendData object\nsetSelectedTrip(enrichedTrip);setActiveTab('trip-details');setSelectedTripTab('overview');}catch(error){console.error('âŒ Error loading trip details:',error);setSelectedTrip(trip);// Fallback to original trip data\nsetActiveTab('trip-details');setSelectedTripTab('overview');}finally{setLoading(false);}};// Add customer to trip\nconst handleAddCustomerToTrip=async customerId=>{if(!selectedTrip)return;const customer=customers.find(c=>c.id===customerId);if(!customer)return;if(selectedTrip.customers.some(tc=>tc.customerId===customerId||tc.customer_id===customerId)){showError('Customer is already added to this trip');return;}setSaving(true);try{// Make API call to add customer to trip\nconst response=await apiClient.post(\"/trips/\".concat(selectedTrip.id,\"/customers\"),{customer_id:customerId});if(!response.success){throw new Error(response.error||'Failed to add customer to trip');}console.log('âœ… Customer added to trip via API:',customer.name);// Refresh trip data to get updated customer list\nawait selectTrip(selectedTrip);setShowAddCustomer(false);}catch(error){console.error('âŒ Error adding customer to trip:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to add customer to trip: \".concat(errorMessage));}finally{setSaving(false);}};// Remove customer from trip\nconst handleRemoveCustomerFromTrip=async customerId=>{if(!selectedTrip)return;console.log('ðŸ”„ Starting delete customer process:',{customerId,tripId:selectedTrip.id});setSaving(true);try{// Make API call to remove customer from trip\nconsole.log('ðŸ“¡ Making API call to delete customer...');const response=await apiClient.delete(\"/trips/\".concat(selectedTrip.id,\"/customers/\").concat(customerId));console.log('ðŸ“¨ API Response:',response);if(!response.success){throw new Error(response.error||'Failed to remove customer from trip');}console.log('âœ… Customer removed from trip via API successfully');// Refresh trip data to get updated customer list\nconsole.log('ðŸ”„ Refreshing trip data...');await selectTrip(selectedTrip);console.log('âœ… Trip data refreshed after customer removal');}catch(error){console.error('âŒ Error removing customer from trip:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to remove customer from trip: \".concat(errorMessage));}finally{setSaving(false);}};// Add staff to trip\nconst handleAddStaffToTrip=async staffId=>{if(!selectedTrip){showError('No trip selected');return;}try{setSaving(true);const response=await apiClient.post(\"/trips/\".concat(selectedTrip.id,\"/staff\"),{staff_id:staffId});if(response.success){console.log(' Staff added to trip via API');// Refresh trip data to get updated staff list\nawait selectTrip(selectedTrip);setShowAddStaff(false);}else{showError(response.error||'Failed to add staff to trip');}}catch(error){console.error('Error adding staff to trip:',error);showError('Failed to add staff to trip');}finally{setSaving(false);}};// Remove staff from trip\nconst handleRemoveStaffFromTrip=async staffId=>{if(!selectedTrip){showError('No trip selected');return;}try{setSaving(true);const response=await apiClient.delete(\"/trips/\".concat(selectedTrip.id,\"/staff/\").concat(staffId));if(response.success){console.log(' Staff removed from trip via API');// Refresh trip data to get updated staff list\nawait selectTrip(selectedTrip);}else{showError(response.error||'Failed to remove staff from trip');}}catch(error){console.error('Error removing staff from trip:',error);showError('Failed to remove staff from trip');}finally{setSaving(false);}};// Handle transaction operations\nconst handleAddTransaction=async()=>{if(!selectedTrip||!selectedCustomerForTransaction)return;setSaving(true);try{// Check authentication first\nconst userData=localStorage.getItem('casinoUser');if(!userData){showError('Please login first to add transactions');return;}// Fix transaction type mapping: buy_in -> buy-in, cash_out -> cash-out\nconst transactionTypeMapping={'buy_in':'buy-in','cash_out':'cash-out','buy-in':'buy-in','cash-out':'cash-out'};const mappedTransactionType=transactionTypeMapping[transactionForm.type]||transactionForm.type;// Ensure we have proper customer_id\nconst customerId=selectedCustomerForTransaction.customerId||selectedCustomerForTransaction.customer_id||selectedCustomerForTransaction.id;if(!customerId){showError('Customer ID is required for transaction');return;}const transactionData={customer_id:customerId,transaction_type:mappedTransactionType,// Must be 'buy-in' or 'cash-out'\namount:parseFloat(transactionForm.amount),status:'completed',// Add required status field\nnotes:transactionForm.description||null};console.log('ðŸ”„ Adding transaction:',transactionData);const response=await apiClient.post(\"/trips/\".concat(selectedTrip.id,\"/transactions\"),transactionData);if(response.success){// Refresh the selected trip data\nawait selectTrip(selectedTrip);setShowAddTransaction(false);setTransactionForm({type:'buy-in',amount:'',description:''});setSelectedCustomerForTransaction(null);}else{showError('Failed to add transaction');}}catch(error){console.error('Error adding transaction:',error);showError('Failed to add transaction');}finally{setSaving(false);}};// Handle rolling operations\nconst handleAddRolling=async()=>{if(!selectedTrip||!selectedCustomerForRolling)return;setSaving(true);try{console.log('ðŸŽ¯ Rolling request data:',{customer_id:selectedCustomerForRolling.customerId||selectedCustomerForRolling.customer_id,staff_id:rollingForm.staff_id,game_type:rollingForm.game_type,rolling_amount:parseFloat(rollingForm.amount),notes:rollingForm.description});const response=await apiClient.post(\"/trips/\".concat(selectedTrip.id,\"/rolling-records\"),{customer_id:selectedCustomerForRolling.customerId||selectedCustomerForRolling.customer_id,staff_id:rollingForm.staff_id,game_type:rollingForm.game_type,rolling_amount:parseFloat(rollingForm.amount),notes:rollingForm.description});if(response.success){// Refresh the selected trip data\nawait selectTrip(selectedTrip);setShowAddRolling(false);setRollingForm({amount:'',staff_id:'',game_type:'baccarat',description:''});setSelectedCustomerForRolling(null);}else{showError('Failed to add rolling');}}catch(error){console.error('Error adding rolling:',error);showError('Failed to add rolling');}finally{setSaving(false);}};// Edit agent share\nconst handleEditAgentShare=async()=>{if(!selectedTrip||!editingAgent)return;if(editAgentShare<=0||editAgentShare>100){showError('Please enter a valid share percentage between 1 and 100');return;}try{const updatedTrip=_objectSpread(_objectSpread({},selectedTrip),{},{agents:(selectedTrip.agents||[]).map(agent=>agent.agentId===editingAgent.agentId?_objectSpread(_objectSpread({},agent),{},{sharePercentage:editAgentShare}):agent),lastDataUpdate:new Date().toISOString()});const updatedTrips=(trips||[]).map(t=>t.id===selectedTrip.id?updatedTrip:t);await saveTrips(updatedTrips);setSelectedTrip(updatedTrip);setShowEditAgent(false);setEditingAgent(null);setEditAgentShare(25);console.log('âœ… Agent share updated:',editingAgent.agentName);}catch(error){console.error('âŒ Error updating agent share:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to update agent share: \".concat(errorMessage));}};// Delete agent from trip\nconst handleDeleteAgentFromTrip=async()=>{if(!selectedTrip||!deletingAgent)return;setSaving(true);try{// Make API call to remove agent from trip\nconst agentIdToRemove=deletingAgent.agentId||deletingAgent.agent_id;console.log('ðŸ—‘ï¸ Attempting to delete agent:',{tripId:selectedTrip.id,agentIdToRemove,deletingAgent,url:\"/trips/\".concat(selectedTrip.id,\"/agents/\").concat(agentIdToRemove)});const response=await apiClient.delete(\"/trips/\".concat(selectedTrip.id,\"/agents/\").concat(agentIdToRemove));if(!response.success){throw new Error(response.error||'Failed to remove agent from trip');}console.log('âœ… Agent removed from trip via API:',deletingAgent.agentName);// Refresh trip data to get updated agent list\nawait selectTrip(selectedTrip);setShowDeleteAgent(false);setDeletingAgent(null);}catch(error){console.error('âŒ Error removing agent from trip:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to remove agent from trip: \".concat(errorMessage));}finally{setSaving(false);}};// Add expense to trip using API\nconst handleAddExpense=async()=>{if(!selectedTrip||!newExpense.description.trim()||newExpense.amount<=0){showError('Please fill in all expense fields');return;}const expenseData={expense_type:newExpense.category,amount:newExpense.amount,description:newExpense.description};const success=await addTripExpense(selectedTrip.id,expenseData);if(success){setShowAddExpense(false);setNewExpense({description:'',amount:0,category:'flight'});console.log('âœ… Expense added to trip via API');}};const filteredTrips=getFilteredTrips();// Debug logging\nuseEffect(()=>{const debugInfo=async()=>{const hasToken=await tokenManager.getToken();console.log('ðŸ“Š Debug info:',{trips:trips===null||trips===void 0?void 0:trips.length,filteredTrips:filteredTrips===null||filteredTrips===void 0?void 0:filteredTrips.length,dataLoaded,loading,userRole:currentUser.role,agentId:currentUser.agentId,hasToken:hasToken?'YES':'NO',tripsData:trips.map(t=>({id:t.id,name:t.name,status:t.status}))});// Special debug for boss role\nif(currentUser.role==='boss'){console.log('ðŸ” Boss role debug - should see all trips:',{totalTrips:trips.length,filteredTrips:filteredTrips.length,tripsVisible:filteredTrips.map(t=>t.name)});}};debugInfo();},[trips,filteredTrips,dataLoaded,loading,currentUser.role,currentUser.agentId]);// Loading state\nif(loading&&!dataLoaded){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-gray-600\",children:\"Loading Project Data\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Connecting to Supabase and loading trips, customers, and agents...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 w-48 bg-gray-200 rounded-full h-2 mx-auto\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-600 h-2 rounded-full animate-pulse\",style:{width:'60%'}})})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-blue-50 border border-blue-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-5 h-5 text-blue-600 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-blue-800\",children:\"\\uD83C\\uDFAF Project Management - Agent Share CRUD Added\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-blue-600\",children:[\"Full CRUD functionality for agent shares now available in trip details\",lastSyncTime&&\" \\u2022 Last sync: \".concat(lastSyncTime.toLocaleTimeString())]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[saving&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-blue-600\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4 mr-1 animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Saving...\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>loadAllRealTimeData(true),disabled:loading,className:\"text-xs\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Refresh\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>setIsRealTimeEnabled(!isRealTimeEnabled),className:\"text-xs\",children:[/*#__PURE__*/_jsx(Zap,{className:\"w-3 h-3 mr-1 \".concat(isRealTimeEnabled?'text-green-500':'text-gray-500')}),isRealTimeEnabled?'Live':'Manual']}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs bg-green-50 text-green-700\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-2 h-2 mr-1\"}),\"CRUD Ready\"]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"pt-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Trips Loaded\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-blue-600\",children:(trips===null||trips===void 0?void 0:trips.length)||0})]}),/*#__PURE__*/_jsx(MapPin,{className:\"w-8 h-8 text-blue-400\"})]})})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"pt-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Customers Available\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-green-600\",children:(customers===null||customers===void 0?void 0:customers.length)||0})]}),/*#__PURE__*/_jsx(Users,{className:\"w-8 h-8 text-green-400\"})]})})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"pt-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Agents Available\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-purple-600\",children:(agents===null||agents===void 0?void 0:agents.length)||0})]}),/*#__PURE__*/_jsx(UserCheck,{className:\"w-8 h-8 text-purple-400\"})]})})})]}),errorMessage&&/*#__PURE__*/_jsxs(Alert,{className:\"border-red-200 bg-red-50\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsxs(AlertDescription,{className:\"text-red-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Error:\"}),\" \",errorMessage,/*#__PURE__*/_jsxs(Button,{onClick:()=>loadAllRealTimeData(true),size:\"sm\",variant:\"outline\",className:\"ml-3 text-red-800 border-red-300 hover:bg-red-100\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Retry\"]})]})]}),/*#__PURE__*/_jsxs(Tabs,{value:activeTab,onValueChange:setActiveTab,className:\"w-full\",children:[/*#__PURE__*/_jsxs(TabsList,{className:\"grid w-full grid-cols-2\",children:[/*#__PURE__*/_jsx(TabsTrigger,{value:\"trips\",children:t('trips')}),/*#__PURE__*/_jsx(TabsTrigger,{value:\"trip-details\",disabled:!selectedTrip,children:t('trip_details')})]}),/*#__PURE__*/_jsxs(TabsContent,{value:\"trips\",className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Project Management\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"Manage trips and project data with full CRUD functionality\",currentUser.role==='agent'&&' (Your trips only)']})]}),!isReadOnly&&/*#__PURE__*/_jsxs(Dialog,{open:showCreateTrip,onOpenChange:setShowCreateTrip,children:[/*#__PURE__*/_jsx(DialogTrigger,{asChild:true,children:/*#__PURE__*/_jsxs(Button,{children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Create Trip\"]})}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Create New Trip\"}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Create a new trip that will be saved to Supabase database.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"tripName\",children:\"Trip Name *\"}),/*#__PURE__*/_jsx(Input,{id:\"tripName\",value:newTrip.name,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{name:e.target.value})),placeholder:\"Enter trip name\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"tripDescription\",children:\"Description\"}),/*#__PURE__*/_jsx(Textarea,{id:\"tripDescription\",value:newTrip.description,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{description:e.target.value})),placeholder:\"Trip description\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"startDate\",children:\"Start Date *\"}),/*#__PURE__*/_jsx(Input,{id:\"startDate\",type:\"date\",value:newTrip.date,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{date:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"endDate\",children:\"End Date\"}),/*#__PURE__*/_jsx(Input,{id:\"endDate\",type:\"date\",value:newTrip.endDate,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{endDate:e.target.value}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"venue\",children:\"Venue\"}),/*#__PURE__*/_jsx(Input,{id:\"venue\",value:newTrip.venue,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{venue:e.target.value})),placeholder:\"Casino venue\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"budget\",children:\"Budget (HK$)\"}),/*#__PURE__*/_jsx(Input,{id:\"budget\",type:\"number\",value:newTrip.budget,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{budget:e.target.value})),placeholder:\"Enter trip budget\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"status\",children:\"Status\"}),/*#__PURE__*/_jsxs(Select,{value:newTrip.status,onValueChange:value=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{status:value})),children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"active\",children:\"Active\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"in-progress\",children:\"In Progress\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"completed\",children:\"Completed\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"cancelled\",children:\"Cancelled\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"currency\",children:\"Currency\"}),/*#__PURE__*/_jsxs(Select,{value:newTrip.currency,onValueChange:value=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{currency:value})),children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select currency\"})}),/*#__PURE__*/_jsx(SelectContent,{children:SUPPORTED_CURRENCIES.map(currency=>/*#__PURE__*/_jsx(SelectItem,{value:currency.value,children:currency.label},currency.value))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsx(Label,{children:\"Exchange Rates (Manual Input)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"ratePeso\",className:\"text-sm\",children:\"Peso Rate\"}),/*#__PURE__*/_jsx(Input,{id:\"ratePeso\",type:\"number\",step:\"0.0001\",value:newTrip.exchange_rate_peso,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{exchange_rate_peso:parseFloat(e.target.value)||1.0000})),placeholder:\"1.0000\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"rateHKD\",className:\"text-sm\",children:\"HKD Rate\"}),/*#__PURE__*/_jsx(Input,{id:\"rateHKD\",type:\"number\",step:\"0.0001\",value:newTrip.exchange_rate_hkd,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{exchange_rate_hkd:parseFloat(e.target.value)||1.0000})),placeholder:\"1.0000\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"rateMYR\",className:\"text-sm\",children:\"MYR Rate\"}),/*#__PURE__*/_jsx(Input,{id:\"rateMYR\",type:\"number\",step:\"0.0001\",value:newTrip.exchange_rate_myr,onChange:e=>setNewTrip(_objectSpread(_objectSpread({},newTrip),{},{exchange_rate_myr:parseFloat(e.target.value)||1.0000})),placeholder:\"1.0000\"})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[\"Set exchange rates for currency conversion. Current selection: \",getCurrencySymbol(newTrip.currency)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>setShowCreateTrip(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCreateTrip,disabled:saving,children:saving?'Creating...':'Create Trip'})]})]})]})]})]}),loading?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading trips...\"})]})}):((filteredTrips===null||filteredTrips===void 0?void 0:filteredTrips.length)||0)===0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-16 h-16 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:!dataLoaded?'Loading trips...':'No trips found'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-4\",children:!dataLoaded?'Please wait while we load your trip data from Supabase.':'Create your first trip to start managing projects and customer rolling amounts.'}),dataLoaded&&(isAdmin||isAgent)&&/*#__PURE__*/_jsxs(Button,{onClick:()=>setShowCreateTrip(true),children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Create First Trip\"]}),!dataLoaded&&/*#__PURE__*/_jsxs(Button,{onClick:()=>loadAllRealTimeData(true),variant:\"outline\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-4 h-4 mr-2\"}),\"Retry Loading\"]})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[(()=>{console.log('ðŸ” Rendering trips:',filteredTrips===null||filteredTrips===void 0?void 0:filteredTrips.length,filteredTrips);return null;})(),(filteredTrips||[]).map(trip=>{var _trip$status,_trip$status2,_trip$customers,_trip$sharing,_trip$sharing2,_trip$sharing3,_trip$sharing4;// Use loaded statistics data\nreturn/*#__PURE__*/_jsx(Card,{className:\"overflow-hidden hover:shadow-md transition-shadow\",children:/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-xl\",children:trip.name}),/*#__PURE__*/_jsxs(CardDescription,{className:\"mt-1\",children:[trip.description,\" \\u2022 \",trip.date]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Badge,{variant:trip.status==='completed'?'default':trip.status==='in-progress'?'secondary':'outline',children:((_trip$status=trip.status)===null||_trip$status===void 0?void 0:_trip$status.charAt(0).toUpperCase())+((_trip$status2=trip.status)===null||_trip$status2===void 0?void 0:_trip$status2.slice(1))}),/*#__PURE__*/_jsxs(Button,{size:\"sm\",variant:\"outline\",onClick:()=>selectTrip(trip),children:[/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4 mr-1\"}),\"View Details\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500 text-xs\",children:\"Customers\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:((_trip$customers=trip.customers)===null||_trip$customers===void 0?void 0:_trip$customers.length)||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500 text-xs\",children:\"Total Rolling\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-600\",children:[\"HK$\",safeFormatNumber(((_trip$sharing=trip.sharing)===null||_trip$sharing===void 0?void 0:_trip$sharing.total_rolling)||0)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500 text-xs\",children:\"Expenses\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-red-600\",children:[\"HK$\",safeFormatNumber(Math.abs(((_trip$sharing2=trip.sharing)===null||_trip$sharing2===void 0?void 0:_trip$sharing2.total_expenses)||0))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500 text-xs\",children:\"Profit\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat((((_trip$sharing3=trip.sharing)===null||_trip$sharing3===void 0?void 0:_trip$sharing3.net_result)||0)>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(((_trip$sharing4=trip.sharing)===null||_trip$sharing4===void 0?void 0:_trip$sharing4.net_result)||0))]})]})]})]})},trip.id);})]})]}),/*#__PURE__*/_jsx(TabsContent,{value:\"trip-details\",className:\"space-y-4\",children:selectedTrip?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:selectedTrip.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:selectedTrip.description})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:t('view_in')}),/*#__PURE__*/_jsxs(Select,{value:viewingCurrency,onValueChange:newCurrency=>{console.log('ðŸ”„ Currency selector changed:',{from:viewingCurrency,to:newCurrency,tripData:selectedTrip?{id:selectedTrip.id,currency:selectedTrip.currency,rates:{peso:selectedTrip.exchange_rate_peso,hkd:selectedTrip.exchange_rate_hkd,myr:selectedTrip.exchange_rate_myr}}:null});setViewingCurrency(newCurrency);},children:[/*#__PURE__*/_jsx(SelectTrigger,{className:\"w-24\",children:/*#__PURE__*/_jsx(SelectValue,{})}),/*#__PURE__*/_jsx(SelectContent,{children:SUPPORTED_CURRENCIES.map(currency=>/*#__PURE__*/_jsx(SelectItem,{value:currency.value,children:currency.symbol},currency.value))})]})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:()=>setActiveTab('trips'),children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 mr-2\"}),t('back_to_trips')]})]})]}),/*#__PURE__*/_jsxs(Tabs,{value:selectedTripTab,onValueChange:setSelectedTripTab,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(TabsList,{className:\"grid w-full grid-cols-6\",children:[/*#__PURE__*/_jsxs(TabsTrigger,{value:\"overview\",className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(BarChart,{className:\"w-3 h-3\"}),\"Overview\"]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"customers\",className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-3 h-3\"}),\"Customers\"]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"agents\",className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(UserCheck,{className:\"w-3 h-3\"}),\"Agents\"]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"staff\",className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-3 h-3\"}),\"Staff\"]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"expenses\",className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(DollarSign,{className:\"w-3 h-3\"}),\"Expenses\"]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"sharing\",className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Settings,{className:\"w-3 h-3\"}),\"Financials\"]})]}),/*#__PURE__*/_jsx(TabsContent,{value:\"overview\",className:\"space-y-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-6\",children:((_backendData,_selectedTrip$custome,_backendData2,_sharing,_backendData3,_sharing2,_backendData4,_sharing3,_backendData5,_backendData6,_backendData7,_backendData8,_backendData9,_backendData0,_backendData1,_backendData10,_backendData11,_backendData12,_backendData13,_backendData14,_backendData15)=>{// Use backend data directly - no local calculation needed\nconst totalExpenses=((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.expenses)||[]).reduce((sum,e)=>sum+safeNumber(e.amount),0);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-2\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm text-gray-600\",children:\"Buy-in\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600\",children:formatCurrency((selectedTrip===null||selectedTrip===void 0?void 0:(_backendData=selectedTrip.backendData)===null||_backendData===void 0?void 0:_backendData.totalBuyIn)||0,viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[(selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.activeCustomersCount)||(selectedTrip===null||selectedTrip===void 0?void 0:(_selectedTrip$custome=selectedTrip.customers)===null||_selectedTrip$custome===void 0?void 0:_selectedTrip$custome.length)||0,\" customers\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-500\",children:\"From transactions\"})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-2\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm text-gray-600\",children:\"Buy-out\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-red-600\",children:formatCurrency(Math.abs((selectedTrip===null||selectedTrip===void 0?void 0:(_backendData2=selectedTrip.backendData)===null||_backendData2===void 0?void 0:_backendData2.totalCashOut)||0),viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Customer withdrawals\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500\",children:\"From transactions\"})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-2\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm text-gray-600\",children:\"Expenses\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-red-600\",children:formatCurrency(Math.abs(totalExpenses),viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"After all expenses\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500\",children:\"House perspective\"})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-2\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm text-gray-600\",children:\"Profit\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold \".concat(((selectedTrip===null||selectedTrip===void 0?void 0:(_sharing=selectedTrip.sharing)===null||_sharing===void 0?void 0:_sharing.net_result)||(selectedTrip===null||selectedTrip===void 0?void 0:(_backendData3=selectedTrip.backendData)===null||_backendData3===void 0?void 0:_backendData3.netProfit)||0)>=0?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs((selectedTrip===null||selectedTrip===void 0?void 0:(_sharing2=selectedTrip.sharing)===null||_sharing2===void 0?void 0:_sharing2.net_result)||(selectedTrip===null||selectedTrip===void 0?void 0:(_backendData4=selectedTrip.backendData)===null||_backendData4===void 0?void 0:_backendData4.netProfit)||0),viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"House perspective\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs \".concat(((selectedTrip===null||selectedTrip===void 0?void 0:(_sharing3=selectedTrip.sharing)===null||_sharing3===void 0?void 0:_sharing3.net_result)||(selectedTrip===null||selectedTrip===void 0?void 0:(_backendData5=selectedTrip.backendData)===null||_backendData5===void 0?void 0:_backendData5.netProfit)||0)>=0?'text-green-500':'text-red-500'),children:\"After all expenses\"})]})]})]}),!isReadOnly&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm\",children:\"Quick Actions\"})}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-3\",children:[/*#__PURE__*/_jsxs(Button,{size:\"sm\",variant:\"outline\",onClick:()=>setSelectedTripTab('expenses'),children:[/*#__PURE__*/_jsx(DollarSign,{className:\"w-4 h-4 mr-2\"}),\"Manage Expenses\"]}),/*#__PURE__*/_jsxs(Button,{size:\"sm\",variant:\"outline\",onClick:()=>setSelectedTripTab('sharing'),children:[/*#__PURE__*/_jsx(Share2,{className:\"w-4 h-4 mr-2\"}),\"Manage Sharing\"]})]})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm\",children:\"Backend Data Status\"})}),/*#__PURE__*/_jsx(CardContent,{className:\"space-y-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Customer Stats:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(selectedTrip!==null&&selectedTrip!==void 0&&(_backendData6=selectedTrip.backendData)!==null&&_backendData6!==void 0&&_backendData6.customerStatsLoaded?'text-green-600':'text-red-600'),children:selectedTrip!==null&&selectedTrip!==void 0&&(_backendData7=selectedTrip.backendData)!==null&&_backendData7!==void 0&&_backendData7.customerStatsLoaded?'âœ“ Loaded':'âœ— Missing'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Agents:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(selectedTrip!==null&&selectedTrip!==void 0&&(_backendData8=selectedTrip.backendData)!==null&&_backendData8!==void 0&&_backendData8.agentsLoaded?'text-green-600':'text-red-600'),children:selectedTrip!==null&&selectedTrip!==void 0&&(_backendData9=selectedTrip.backendData)!==null&&_backendData9!==void 0&&_backendData9.agentsLoaded?'âœ“ Loaded':'âœ— Missing'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Expenses:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(selectedTrip!==null&&selectedTrip!==void 0&&(_backendData0=selectedTrip.backendData)!==null&&_backendData0!==void 0&&_backendData0.expensesLoaded?'text-green-600':'text-red-600'),children:selectedTrip!==null&&selectedTrip!==void 0&&(_backendData1=selectedTrip.backendData)!==null&&_backendData1!==void 0&&_backendData1.expensesLoaded?'âœ“ Loaded':'âœ— Missing'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Sharing:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(selectedTrip!==null&&selectedTrip!==void 0&&(_backendData10=selectedTrip.backendData)!==null&&_backendData10!==void 0&&_backendData10.sharingLoaded?'text-green-600':'text-red-600'),children:selectedTrip!==null&&selectedTrip!==void 0&&(_backendData11=selectedTrip.backendData)!==null&&_backendData11!==void 0&&_backendData11.sharingLoaded?'âœ“ Loaded':'âœ— Missing'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Statistics:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(selectedTrip!==null&&selectedTrip!==void 0&&(_backendData12=selectedTrip.backendData)!==null&&_backendData12!==void 0&&_backendData12.statisticsLoaded?'text-green-600':'text-red-600'),children:selectedTrip!==null&&selectedTrip!==void 0&&(_backendData13=selectedTrip.backendData)!==null&&_backendData13!==void 0&&_backendData13.statisticsLoaded?'âœ“ Loaded':'âœ— Missing'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Transactions:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium \".concat(selectedTrip!==null&&selectedTrip!==void 0&&(_backendData14=selectedTrip.backendData)!==null&&_backendData14!==void 0&&_backendData14.transactionsLoaded?'text-green-600':'text-red-600'),children:selectedTrip!==null&&selectedTrip!==void 0&&(_backendData15=selectedTrip.backendData)!==null&&_backendData15!==void 0&&_backendData15.transactionsLoaded?'âœ“ Loaded':'âœ— Missing'})]})]})})]})]});})()})}),/*#__PURE__*/_jsxs(TabsContent,{value:\"customers\",className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-medium\",children:[\"Trip Customers (\",(selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.activeCustomersCount)||(selectedTrip===null||selectedTrip===void 0?void 0:(_selectedTrip$custome2=selectedTrip.customers)===null||_selectedTrip$custome2===void 0?void 0:_selectedTrip$custome2.length)||0,\")\"]}),!isReadOnly&&/*#__PURE__*/_jsxs(Dialog,{open:showAddCustomer,onOpenChange:setShowAddCustomer,children:[/*#__PURE__*/_jsx(DialogTrigger,{asChild:true,children:/*#__PURE__*/_jsxs(Button,{size:\"sm\",children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add Customer\"]})}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Add Customer to Trip\"}),/*#__PURE__*/_jsxs(DialogDescription,{children:[\"Select from available customers (\",(customers||[]).filter(c=>!((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.customers)||[]).some(tc=>tc.customerId===c.id)).length,\" total)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 max-h-96 overflow-y-auto\",children:[(customers||[]).filter(c=>!((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.customers)||[]).some(tc=>tc.customerId===c.id)).map(customer=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 border rounded\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:customer.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:customer.email}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[\"Agent: \",customer.agentName]})]}),!isReadOnly&&/*#__PURE__*/_jsx(Button,{size:\"sm\",onClick:()=>handleAddCustomerToTrip(customer.id),disabled:saving,children:saving?'Adding...':'Add'})]},customer.id)),(customers||[]).filter(c=>!((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.customers)||[]).some(tc=>tc.customerId===c.id)).length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 py-8\",children:\"All customers are already added to this trip\"})]})]})]})]}),((selectedTrip===null||selectedTrip===void 0?void 0:(_selectedTrip$custome3=selectedTrip.customers)===null||_selectedTrip$custome3===void 0?void 0:_selectedTrip$custome3.length)||0)===0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-12 h-12 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No customers added to this trip\"}),!isReadOnly&&/*#__PURE__*/_jsxs(Button,{className:\"mt-4\",onClick:()=>setShowAddCustomer(true),children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add First Customer\"]})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.customers)||[]).map(tripCustomer=>{var _tripCustomer$custome,_tripCustomer$custome2;return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"pt-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium\",children:tripCustomer.customerName||((_tripCustomer$custome=tripCustomer.customer)===null||_tripCustomer$custome===void 0?void 0:_tripCustomer$custome.name)}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs\",children:[\"VIP: \",((_tripCustomer$custome2=tripCustomer.customer)===null||_tripCustomer$custome2===void 0?void 0:_tripCustomer$custome2.vip_level)||'Standard']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-5 gap-4 mt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Buy-in:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-blue-600\",children:formatCurrency(tripCustomer.total_buy_in||tripCustomer.buyInAmount||0,viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Cash-out:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-purple-600\",children:formatCurrency(tripCustomer.total_cash_out||tripCustomer.buyOutAmount||0,viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Rolling:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-orange-600\",children:formatCurrency(tripCustomer.rolling_amount||tripCustomer.rollingAmount||0,viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Win/Loss:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-medium \".concat((tripCustomer.total_buy_in||0)>(tripCustomer.total_cash_out||0)?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs((tripCustomer.total_buy_in||0)-(tripCustomer.total_cash_out||0)),viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Net Result:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-medium \".concat((tripCustomer.total_buy_in||0)-(tripCustomer.total_cash_out||0)-(tripCustomer.rolling_amount||0)>=0?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs((tripCustomer.total_buy_in||0)-(tripCustomer.total_cash_out||0)-(tripCustomer.rolling_amount||0)),viewingCurrency,selectedTrip)})]})]}),tripCustomer.commission_earned&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 p-2 bg-yellow-50 rounded text-xs\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-yellow-700\",children:[\"Commission Earned: \",formatCurrency(tripCustomer.commission_earned,viewingCurrency,selectedTrip)]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>{setSelectedCustomerForTransaction(tripCustomer);setShowAddTransaction(true);},disabled:saving,children:[/*#__PURE__*/_jsx(Plus,{className:\"w-3 h-3 mr-1\"}),\"Transaction\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>{setSelectedCustomerForRolling(tripCustomer);setShowAddRolling(true);},disabled:saving,children:[/*#__PURE__*/_jsx(Plus,{className:\"w-3 h-3 mr-1\"}),\"Rolling\"]}),/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",onClick:()=>handleRemoveCustomerFromTrip(tripCustomer.customerId||tripCustomer.customer_id),disabled:saving,children:/*#__PURE__*/_jsx(X,{className:\"w-4 h-4\"})})]})]})})},tripCustomer.customerId||tripCustomer.customer_id);})})]}),/*#__PURE__*/_jsxs(TabsContent,{value:\"agents\",className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium\",children:\"Agent Individual Profits\"}),/*#__PURE__*/_jsxs(Button,{size:\"sm\",variant:\"outline\",onClick:()=>{if(selectedTrip){console.log('ðŸ”„ Manual refresh clicked for trip:',selectedTrip.id);loadAgentProfits(selectedTrip.id);}},disabled:loading,children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-4 h-4 mr-2\"}),\"Refresh\"]})]}),false?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading agent profits...\"})]})}):!agentProfits||agentProfits.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(UserCheck,{className:\"w-12 h-12 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No agents with customers in this trip\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400 mt-2\",children:\"Agents are automatically added when their customers join the trip\"})]})}),/*#__PURE__*/_jsx(Card,{className:\"border-yellow-200 bg-yellow-50\",children:/*#__PURE__*/_jsxs(CardContent,{className:\"pt-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-yellow-800 mb-2\",children:\"Debug Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-yellow-700 space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Trip ID: \",selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.id]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Customers in trip: \",(selectedTrip===null||selectedTrip===void 0?void 0:(_selectedTrip$custome4=selectedTrip.customers)===null||_selectedTrip$custome4===void 0?void 0:_selectedTrip$custome4.length)||0]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Agents in trip: \",(selectedTrip===null||selectedTrip===void 0?void 0:(_selectedTrip$agents=selectedTrip.agents)===null||_selectedTrip$agents===void 0?void 0:_selectedTrip$agents.length)||0]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Agent profits loaded: \",(agentProfits===null||agentProfits===void 0?void 0:agentProfits.length)||0]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Agent profits state: \",JSON.stringify(agentProfits)]})]}),(selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.customers)&&selectedTrip.customers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-yellow-800\",children:\"Customers:\"}),selectedTrip.customers.map((customer,index)=>{var _customer$customer;return/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-yellow-600\",children:[customer.customerName||((_customer$customer=customer.customer)===null||_customer$customer===void 0?void 0:_customer$customer.name)||'Unknown',\" (ID: \",customer.customerId||customer.customer_id,\")\"]},index);})]})]})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-6\",children:agentProfits.map(agentProfit=>/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-lg\",children:agentProfit.agent_name}),/*#__PURE__*/_jsx(CardDescription,{children:agentProfit.agent_email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:formatCurrency(agentProfit.total_agent_commission||agentProfit.total_commission||0,viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Total Commission\"})]})]})}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-blue-50 rounded\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Customer Net Result\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold \".concat(agentProfit.total_customer_net>=0?'text-green-600':'text-red-600'),children:formatCurrencyWithSign(agentProfit.total_customer_net,viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-green-50 rounded\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Total Customers\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-gray-800\",children:agentProfit.customers.length})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium mb-3\",children:\"Customer Breakdown\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:agentProfit.customers.map(customer=>/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded p-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:customer.customer_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"Buy-in: HK$\",safeFormatNumber(customer.buy_in),\" | Cash-out: HK$\",safeFormatNumber(customer.cash_out)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-bold \".concat(customer.net_result>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(customer.net_result)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"Net Result\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center pt-2 border-t\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Rolling:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium ml-1\",children:[\"HK$\",safeFormatNumber(customer.rolling_amount)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Commission Rate:\"}),/*#__PURE__*/_jsx(Input,{type:\"number\",value:customer.commission_rate,onChange:e=>{const newRate=parseFloat(e.target.value)||0;console.log('ðŸ”„ Commission rate changed:',{agentId:agentProfit.agent_id,customerId:customer.customer_id,newRate});updateCommissionRate(agentProfit.agent_id,customer.customer_id,newRate);},className:\"w-20 h-8 text-sm\",min:\"0\",max:\"100\",step:\"0.1\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"%\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-bold text-blue-600\",children:[\"HK$\",safeFormatNumber(customer.agent_commission||customer.commission_earned||0)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Commission\"})]})]})]},customer.customer_id))})]})]})})]},agentProfit.agent_id))}),/*#__PURE__*/_jsx(Dialog,{open:showEditAgent,onOpenChange:setShowEditAgent,children:/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Edit Agent Share\"}),/*#__PURE__*/_jsxs(DialogDescription,{children:[\"Update \",editingAgent===null||editingAgent===void 0?void 0:editingAgent.agentName,\"'s share percentage\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"editSharePercentage\",children:\"Share Percentage *\"}),/*#__PURE__*/_jsx(Input,{id:\"editSharePercentage\",type:\"number\",value:editAgentShare,onChange:e=>setEditAgentShare(parseFloat(e.target.value)||0),placeholder:\"Enter percentage (e.g., 25)\",min:\"0.1\",max:\"100\",step:\"0.1\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Enter a value between 0.1 and 100\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>setShowEditAgent(false),disabled:saving,children:\"Cancel\"}),!isReadOnly&&/*#__PURE__*/_jsx(Button,{onClick:handleEditAgentShare,disabled:saving,children:saving?'Updating...':'Update Share'})]})]})]})}),/*#__PURE__*/_jsx(AlertDialog,{open:showDeleteAgent,onOpenChange:setShowDeleteAgent,children:/*#__PURE__*/_jsxs(AlertDialogContent,{children:[/*#__PURE__*/_jsxs(AlertDialogHeader,{children:[/*#__PURE__*/_jsx(AlertDialogTitle,{children:\"Remove Agent from Trip\"}),/*#__PURE__*/_jsxs(AlertDialogDescription,{children:[\"Are you sure you want to remove \",/*#__PURE__*/_jsx(\"strong\",{children:deletingAgent===null||deletingAgent===void 0?void 0:deletingAgent.agentName}),\" from this trip? This will remove their \",deletingAgent===null||deletingAgent===void 0?void 0:deletingAgent.sharePercentage,\"% share allocation.\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),\"This action cannot be undone.\"]})]}),/*#__PURE__*/_jsxs(AlertDialogFooter,{children:[/*#__PURE__*/_jsx(AlertDialogCancel,{disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(AlertDialogAction,{onClick:handleDeleteAgentFromTrip,disabled:saving,className:\"bg-red-600 hover:bg-red-700\",children:saving?'Removing...':'Remove Agent'})]})]})})]}),/*#__PURE__*/_jsxs(TabsContent,{value:\"staff\",className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-medium\",children:[\"Trip Staff (\",(selectedTrip===null||selectedTrip===void 0?void 0:(_staff=selectedTrip.staff)===null||_staff===void 0?void 0:_staff.length)||0,\")\"]}),!isReadOnly&&/*#__PURE__*/_jsxs(Dialog,{open:showAddStaff,onOpenChange:setShowAddStaff,children:[/*#__PURE__*/_jsx(DialogTrigger,{asChild:true,children:/*#__PURE__*/_jsxs(Button,{size:\"sm\",children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add Staff\"]})}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Add Staff to Trip\"}),/*#__PURE__*/_jsxs(DialogDescription,{children:[\"Select from available staff members (\",(staff||[]).filter(s=>!((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.staff)||[]).some(ts=>ts.staffId===s.id||ts.staff_id===s.id)).length,\" available)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 max-h-96 overflow-y-auto\",children:[(()=>{console.log('ðŸ” Debug staff filtering:',{allStaff:staff,tripStaff:selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.staff,staffCount:(staff===null||staff===void 0?void 0:staff.length)||0,tripStaffCount:((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.staff)||[]).length});const availableStaff=(staff||[]).filter(s=>!((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.staff)||[]).some(ts=>{// Check multiple possible ID fields from the backend response\nconst tripStaffId=ts.staffId||ts.staff_id||ts.id;const match=tripStaffId===s.id;console.log('ðŸ” Checking staff match:',{staffId:s.id,staffName:s.name,tripStaffId,tripStaff:ts,match});return match;}));console.log('âœ… Available staff after filtering:',availableStaff);return availableStaff.map(staffMember=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 border rounded\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:staffMember.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:staffMember.email}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[\"Position: \",staffMember.position]})]}),/*#__PURE__*/_jsx(Button,{size:\"sm\",onClick:()=>handleAddStaffToTrip(staffMember.id),disabled:saving,children:saving?'Adding...':'Add'})]},staffMember.id));})(),(()=>{const availableStaff=(staff||[]).filter(s=>!((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.staff)||[]).some(ts=>{const tripStaffId=ts.staffId||ts.staff_id||ts.id;return tripStaffId===s.id;}));return availableStaff.length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 py-8\",children:\"All staff members are already assigned to this trip\"});})()]})]})]})]}),!selectedTrip||!selectedTrip.staff||!Array.isArray(selectedTrip.staff)||selectedTrip.staff.length===0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-12 h-12 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No staff assigned to this trip\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400 mt-2\",children:\"Add staff members to help manage this trip\"})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:(selectedTrip.staff||[]).map(staffMember=>/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Users,{className:\"w-5 h-5 text-blue-600\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:staffMember.name||staffMember.staffName}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:staffMember.email||staffMember.staffEmail}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[\"Position: \",staffMember.position||staffMember.staffPosition]}),staffMember.created_at&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[\"Added: \",new Date(staffMember.created_at).toLocaleDateString()]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2\",children:/*#__PURE__*/_jsx(Button,{size:\"sm\",variant:\"outline\",onClick:()=>handleRemoveStaffFromTrip(staffMember.staff_id||staffMember.id),disabled:saving,children:/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"})})})]})})},staffMember.id||staffMember.staff_id))})]}),/*#__PURE__*/_jsxs(TabsContent,{value:\"expenses\",className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-medium\",children:[\"Trip Expenses (\",(tripExpenses===null||tripExpenses===void 0?void 0:tripExpenses.length)||0,\")\"]}),!isReadOnly&&/*#__PURE__*/_jsxs(Dialog,{open:showAddExpense,onOpenChange:setShowAddExpense,children:[/*#__PURE__*/_jsx(DialogTrigger,{asChild:true,children:/*#__PURE__*/_jsxs(Button,{size:\"sm\",children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add Expense\"]})}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Add Expense\"}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Record a new expense for this trip\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"expenseDescription\",children:\"Description\"}),/*#__PURE__*/_jsx(Input,{id:\"expenseDescription\",value:newExpense.description,onChange:e=>setNewExpense(_objectSpread(_objectSpread({},newExpense),{},{description:e.target.value})),placeholder:\"Expense description\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"expenseAmount\",children:[\"Amount (\",getCurrencySymbol((selectedTrip===null||selectedTrip===void 0?void 0:selectedTrip.currency)||'HKD'),\")\"]}),/*#__PURE__*/_jsx(Input,{id:\"expenseAmount\",type:\"number\",value:newExpense.amount,onChange:e=>setNewExpense(_objectSpread(_objectSpread({},newExpense),{},{amount:parseFloat(e.target.value)||0})),placeholder:\"0.00\",min:\"0\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"expenseCategory\",children:\"Category\"}),/*#__PURE__*/_jsxs(Select,{value:newExpense.category,onValueChange:value=>setNewExpense(_objectSpread(_objectSpread({},newExpense),{},{category:value})),children:[/*#__PURE__*/_jsx(SelectTrigger,{children:/*#__PURE__*/_jsx(SelectValue,{})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"accommodation\",children:\"Accommodation\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"transportation\",children:\"Transportation\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"entertainment\",children:\"Entertainment\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"food_beverage\",children:\"Food & Beverage\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"other\",children:\"Other\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>setShowAddExpense(false),children:\"Cancel\"}),!isReadOnly&&/*#__PURE__*/_jsx(Button,{onClick:handleAddExpense,children:\"Add Expense\"})]})]})]})]})]}),expensesLoading?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading expenses...\"})]})}):((tripExpenses===null||tripExpenses===void 0?void 0:tripExpenses.length)||0)===0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(DollarSign,{className:\"w-12 h-12 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No expenses recorded for this trip\"}),!isReadOnly&&/*#__PURE__*/_jsxs(Button,{className:\"mt-4\",onClick:()=>setShowAddExpense(true),children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add First Expense\"]})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-lg\",children:\"Expenses Summary\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-red-600\",children:formatCurrency((tripExpenses||[]).reduce((sum,exp)=>sum+(exp.amount||0),0),viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[(tripExpenses===null||tripExpenses===void 0?void 0:tripExpenses.length)||0,\" expense items\"]})]})]}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-0\",children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHeader,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableHead,{children:\"Description\"}),/*#__PURE__*/_jsx(TableHead,{children:\"Type\"}),/*#__PURE__*/_jsx(TableHead,{children:\"Date\"}),/*#__PURE__*/_jsx(TableHead,{className:\"text-right\",children:\"Amount\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:(tripExpenses||[]).map(expense=>{var _expense$expense_type;return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{className:\"font-medium\",children:expense.description}),/*#__PURE__*/_jsx(TableCell,{className:\"capitalize\",children:(_expense$expense_type=expense.expense_type)===null||_expense$expense_type===void 0?void 0:_expense$expense_type.replace('_',' ')}),/*#__PURE__*/_jsx(TableCell,{children:expense.expense_date}),/*#__PURE__*/_jsx(TableCell,{className:\"text-right font-medium text-red-600\",children:formatCurrency(expense.amount,viewingCurrency,selectedTrip)})]},expense.id);})})]})})})]})]}),/*#__PURE__*/_jsxs(TabsContent,{value:\"sharing\",className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium\",children:\"Financial Overview & Profit Sharing\"}),tripSharing&&/*#__PURE__*/_jsxs(Button,{size:\"sm\",variant:\"outline\",onClick:()=>selectedTrip&&loadTripSharing(selectedTrip.id),disabled:sharingLoading,children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-4 h-4 mr-2\"}),\"Refresh\"]})]}),sharingLoading?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading sharing data...\"})]})}):!tripSharing?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(Settings,{className:\"w-12 h-12 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No sharing data available\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400 mt-2\",children:\"Sharing data will be calculated automatically when trip has transactions\"})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-2\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm text-gray-600\",children:\"Net Result\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold \".concat(tripSharing.net_result>=0?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs(tripSharing.net_result),viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"After all expenses and commissions\"})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-2\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm text-gray-600\",children:\"Agent Share\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold \".concat(tripSharing.total_agent_share>=0?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs(tripSharing.total_agent_share),viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[tripSharing.agent_share_percentage,\"% of net result\"]})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-2\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm text-gray-600\",children:\"Company Share\"})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold \".concat(tripSharing.company_share>=0?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs(tripSharing.company_share),viewingCurrency,selectedTrip)}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[tripSharing.company_share_percentage,\"% of net result\"]})]})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(CardTitle,{children:\"Financial Breakdown\"})}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-green-50 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Total Buy-in\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600 font-bold\",children:formatCurrency(tripSharing.total_buy_in,viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-red-50 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Total Cash-out\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-red-600 font-bold\",children:formatCurrency(Math.abs(tripSharing.total_buy_out),viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-gray-100 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Gross Profit\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold \".concat(tripSharing.total_win_loss>=0?'text-red-600':'text-green-600'),children:formatCurrency(Math.abs(tripSharing.total_win_loss),viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-purple-50 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Rolling Commission\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-purple-600 font-bold\",children:formatCurrency(Math.abs(tripSharing.total_rolling_commission),viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-red-50 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Total Expenses\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-red-600 font-bold\",children:formatCurrency(Math.abs(tripSharing.total_expenses),viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-blue-50 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Net Result\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold \".concat(tripSharing.net_result>=0?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs(tripSharing.net_result),viewingCurrency,selectedTrip)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 bg-gray-50 rounded\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Net Cash Flow\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold \".concat(tripSharing.net_cash_flow>=0?'text-green-600':'text-red-600'),children:formatCurrency(Math.abs(tripSharing.net_cash_flow),viewingCurrency,selectedTrip)})]})]})})]}),tripSharing.agent_breakdown&&Object.keys(tripSharing.agent_breakdown).length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(CardTitle,{children:\"Agent Share Breakdown\"})}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:Object.entries((tripSharing===null||tripSharing===void 0?void 0:tripSharing.agent_breakdown)||{}).map(_ref2=>{let[agentId,agentData]=_ref2;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 border rounded\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:agentData.agent_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"Commission Rate: \",agentData.commission_rate,\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-bold \".concat(agentData.share_amount>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(agentData.share_amount))]})]},agentId);})})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Sharing Configuration\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Adjust the profit sharing percentages between agents and company\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{children:\"Agent Share Percentage\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:[tripSharing.agent_share_percentage,\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{children:\"Company Share Percentage\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-purple-600\",children:[tripSharing.company_share_percentage,\"%\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-4 border-t\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 mb-4\",children:[\"Current sharing model: \",tripSharing.agent_share_percentage,\"% to agents, \",tripSharing.company_share_percentage,\"% to company\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>{// TODO: Add sharing configuration dialog\nshowError('Sharing configuration will be available in the next update');},children:[/*#__PURE__*/_jsx(Settings,{className:\"w-4 h-4 mr-2\"}),\"Configure Sharing\"]})]})]})})]})]})]})]})]}):/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(Eye,{className:\"w-16 h-16 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"No Trip Selected\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-4\",children:\"Please select a trip from the trips list to view detailed information.\"}),/*#__PURE__*/_jsxs(Button,{onClick:()=>setActiveTab('trips'),children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 mr-2\"}),\"Go to Trips List\"]})]})})})]}),/*#__PURE__*/_jsx(Dialog,{open:showAddTransaction,onOpenChange:setShowAddTransaction,children:/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Add Transaction\"}),/*#__PURE__*/_jsxs(DialogDescription,{children:[\"Add a new transaction for \",(selectedCustomerForTransaction===null||selectedCustomerForTransaction===void 0?void 0:selectedCustomerForTransaction.customerName)||(selectedCustomerForTransaction===null||selectedCustomerForTransaction===void 0?void 0:(_selectedCustomerForT=selectedCustomerForTransaction.customer)===null||_selectedCustomerForT===void 0?void 0:_selectedCustomerForT.name)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"transactionType\",children:\"Transaction Type\"}),/*#__PURE__*/_jsxs(Select,{value:transactionForm.type,onValueChange:value=>setTransactionForm(_objectSpread(_objectSpread({},transactionForm),{},{type:value})),children:[/*#__PURE__*/_jsx(SelectTrigger,{id:\"transactionType\",children:/*#__PURE__*/_jsx(SelectValue,{})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"buy-in\",children:\"Buy In\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"cash-out\",children:\"Cash Out\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"transactionAmount\",children:\"Amount (HK$)\"}),/*#__PURE__*/_jsx(Input,{id:\"transactionAmount\",type:\"number\",placeholder:\"Enter amount\",value:transactionForm.amount,onChange:e=>setTransactionForm(_objectSpread(_objectSpread({},transactionForm),{},{amount:e.target.value})),required:true}),!transactionForm.amount&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Amount is required\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"transactionDescription\",children:\"Description (Optional)\"}),/*#__PURE__*/_jsx(Input,{id:\"transactionDescription\",type:\"text\",placeholder:\"Enter description\",value:transactionForm.description,onChange:e=>setTransactionForm(_objectSpread(_objectSpread({},transactionForm),{},{description:e.target.value}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end gap-2 mt-6\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>setShowAddTransaction(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleAddTransaction,disabled:saving||!transactionForm.amount,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}),\"Adding...\"]}):'Add Transaction'})]})]})}),/*#__PURE__*/_jsx(Dialog,{open:showAddRolling,onOpenChange:setShowAddRolling,children:/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Add Rolling\"}),/*#__PURE__*/_jsxs(DialogDescription,{children:[\"Add rolling amount for \",(selectedCustomerForRolling===null||selectedCustomerForRolling===void 0?void 0:selectedCustomerForRolling.customerName)||(selectedCustomerForRolling===null||selectedCustomerForRolling===void 0?void 0:(_selectedCustomerForR=selectedCustomerForRolling.customer)===null||_selectedCustomerForR===void 0?void 0:_selectedCustomerForR.name)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"staffMember\",children:[\"Staff Member \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsxs(Select,{value:rollingForm.staff_id,onValueChange:value=>setRollingForm(_objectSpread(_objectSpread({},rollingForm),{},{staff_id:value})),children:[/*#__PURE__*/_jsx(SelectTrigger,{id:\"staffMember\",className:!rollingForm.staff_id?\"border-red-300\":\"\",children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Select staff member\"})}),/*#__PURE__*/_jsx(SelectContent,{children:selectedTrip===null||selectedTrip===void 0?void 0:(_staff2=selectedTrip.staff)===null||_staff2===void 0?void 0:_staff2.map(staffMember=>{var _staffMember$staff;return/*#__PURE__*/_jsx(SelectItem,{value:staffMember.staffId||staffMember.staff_id,children:staffMember.staffName||((_staffMember$staff=staffMember.staff)===null||_staffMember$staff===void 0?void 0:_staffMember$staff.name)},staffMember.staffId||staffMember.staff_id);})})]}),!rollingForm.staff_id&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Staff member is required\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"gameType\",children:[\"Game Type \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsxs(Select,{value:rollingForm.game_type,onValueChange:value=>setRollingForm(_objectSpread(_objectSpread({},rollingForm),{},{game_type:value})),children:[/*#__PURE__*/_jsx(SelectTrigger,{id:\"gameType\",children:/*#__PURE__*/_jsx(SelectValue,{})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"baccarat\",children:\"Baccarat\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"blackjack\",children:\"Blackjack\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"roulette\",children:\"Roulette\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"poker\",children:\"Poker\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"slots\",children:\"Slots\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"other\",children:\"Other\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Label,{htmlFor:\"rollingAmount\",children:[\"Rolling Amount (HK$) \",/*#__PURE__*/_jsx(\"span\",{className:\"text-red-500\",children:\"*\"})]}),/*#__PURE__*/_jsx(Input,{id:\"rollingAmount\",type:\"number\",placeholder:\"Enter rolling amount\",value:rollingForm.amount,onChange:e=>setRollingForm(_objectSpread(_objectSpread({},rollingForm),{},{amount:e.target.value})),className:!rollingForm.amount?\"border-red-300\":\"\",required:true}),!rollingForm.amount&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-500 mt-1\",children:\"Rolling amount is required\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"rollingNotes\",children:\"Notes (Optional)\"}),/*#__PURE__*/_jsx(Input,{id:\"rollingNotes\",type:\"text\",placeholder:\"Enter notes\",value:rollingForm.description,onChange:e=>setRollingForm(_objectSpread(_objectSpread({},rollingForm),{},{description:e.target.value}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end gap-2 mt-6\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>setShowAddRolling(false),disabled:saving,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleAddRolling,disabled:saving||!rollingForm.amount||!rollingForm.staff_id,children:saving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}),\"Adding...\"]}):'Add Rolling'})]})]})})]});}export default ProjectManagementComponent;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}