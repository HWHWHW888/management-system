{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Badge}from'./ui/badge';import{Button}from'./ui/button';import{Input}from'./ui/input';import{Label}from'./ui/label';import{Tabs,TabsList,TabsTrigger}from'./ui/tabs';import{Filter,Calendar,Eye,DollarSign,Clock,UserIcon,AlertCircle,CheckCircle,RefreshCw,Activity,Target,TrendingUp,TrendingDown,Database,Lock,Receipt,ArrowDownCircle,ArrowUpCircle,FileImage,Scan,Building2,Wallet,MapPin,Hash,ShieldCheck,CircleDollarSign}from'lucide-react';import{AlertDialog,AlertDialogCancel,AlertDialogContent,AlertDialogDescription,AlertDialogFooter,AlertDialogHeader,AlertDialogTitle}from'./ui/alert-dialog';import{withErrorHandler}from'./withErrorHandler';import{db}from'../utils/supabase/supabaseClients';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Real-time refresh interval (15 seconds)\nconst REAL_TIME_REFRESH_INTERVAL=15000;function StaffRollingHistoryComponent(_ref){let{user,currentStaff,showError,clearError}=_ref;const[records,setRecords]=useState([]);const[buyInOutRecords,setBuyInOutRecords]=useState([]);const[filteredRecords,setFilteredRecords]=useState([]);const[loading,setLoading]=useState(true);const[isRefreshing,setIsRefreshing]=useState(false);const[selectedRecord,setSelectedRecord]=useState(null);const[filterDateRange,setFilterDateRange]=useState({start:'',end:''});const[filterGameType,setFilterGameType]=useState('');const[filterCustomer,setFilterCustomer]=useState('');const[filterVerified,setFilterVerified]=useState('all');const[viewMode,setViewMode]=useState('my_records');const[lastDataUpdate,setLastDataUpdate]=useState(null);const[isSaving,setIsSaving]=useState(false);// Check if user has admin privileges to see all records\nconst isAdmin=user.role==='admin';const isStaff=user.role==='staff';// Load real-time data from Supabase\nconst loadRealTimeData=useCallback(async()=>{try{setIsRefreshing(true);clearError();console.log('🔄 Loading real-time rolling history from Supabase...');// Load all data in parallel\nconst[rollingRecords,buyInOutData]=await Promise.all([db.get('rolling_records',[]),db.get('buy_in_out_records',[])]);setBuyInOutRecords(buyInOutData);// Filter records based on user role\nlet filteredRollingRecords=rollingRecords;// Staff users can only see their own records\nif(isStaff&&!isAdmin){filteredRollingRecords=rollingRecords.filter(record=>record.staffId===currentStaff.id);console.log(\"\\uD83D\\uDD12 Staff user: filtered to \".concat(filteredRollingRecords.length,\" own records out of \").concat(rollingRecords.length,\" total\"));}// Sort by recorded date (most recent first)\nconst sortedRecords=filteredRollingRecords.sort((a,b)=>new Date(b.recordedAt).getTime()-new Date(a.recordedAt).getTime());setRecords(sortedRecords);setLastDataUpdate(new Date());console.log(\"\\u2705 Loaded real-time rolling history: \".concat(sortedRecords.length,\" records, \").concat(buyInOutData.length,\" buy-in/out records\"));}catch(error){console.error('❌ Failed to load real-time rolling records:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to load rolling records: \".concat(errorMessage));}finally{setLoading(false);setIsRefreshing(false);}},[clearError,showError,currentStaff.id,isStaff,isAdmin]);// Initial load and real-time sync\nuseEffect(()=>{loadRealTimeData();// Set up real-time refresh interval\nconst refreshInterval=setInterval(()=>{console.log('🔄 Real-time rolling history refresh triggered');loadRealTimeData();},REAL_TIME_REFRESH_INTERVAL);return()=>{clearInterval(refreshInterval);};},[loadRealTimeData]);const applyFilters=useCallback(()=>{let filtered=[...records];// For staff users, always filter to their own records (double safety)\nif(isStaff&&!isAdmin){filtered=filtered.filter(record=>record.staffId===currentStaff.id);}else if(isAdmin){// For admin users, respect the view mode selection\nif(viewMode==='my_records'){filtered=filtered.filter(record=>record.staffId===currentStaff.id);}// For 'all' mode, show all records (no additional filtering)\n}// Date range filter\nif(filterDateRange.start){filtered=filtered.filter(record=>new Date(record.sessionStartTime)>=new Date(filterDateRange.start));}if(filterDateRange.end){filtered=filtered.filter(record=>new Date(record.sessionStartTime)<=new Date(filterDateRange.end));}// Game type filter\nif(filterGameType){filtered=filtered.filter(record=>record.gameType.toLowerCase().includes(filterGameType.toLowerCase()));}// Customer filter\nif(filterCustomer){filtered=filtered.filter(record=>record.customerName.toLowerCase().includes(filterCustomer.toLowerCase()));}// Verified status filter\nif(filterVerified!=='all'){filtered=filtered.filter(record=>filterVerified==='verified'?record.verified:!record.verified);}setFilteredRecords(filtered);},[records,filterDateRange,filterGameType,filterCustomer,filterVerified,viewMode,isStaff,isAdmin,currentStaff.id]);useEffect(()=>{applyFilters();},[applyFilters]);const toggleVerification=async recordId=>{const record=records.find(r=>r.id===recordId);if(!record)return;// Staff users can only verify their own records\nif(isStaff&&!isAdmin&&record.staffId!==currentStaff.id){showError('You can only verify your own records.');return;}const updatedRecord=_objectSpread(_objectSpread({},record),{},{verified:!record.verified,verifiedBy:!record.verified?user.id:undefined,verifiedAt:!record.verified?new Date().toISOString():undefined});try{setIsSaving(true);// Get all records from database (admin needs to update the full dataset)\nconst allRecords=await db.get('rolling_records',[]);const updatedAllRecords=allRecords.map(r=>r.id===recordId?updatedRecord:r);// Save to Supabase immediately\nawait db.save('rollingRecords',updatedAllRecords);// Update local state with filtered records\nconst updatedLocalRecords=records.map(r=>r.id===recordId?updatedRecord:r);setRecords(updatedLocalRecords);console.log(\"\\u2705 Updated verification status for record \".concat(recordId));// Refresh data to ensure consistency\nawait loadRealTimeData();}catch(error){console.error('❌ Failed to update verification status:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';showError(\"Failed to update verification status: \".concat(errorMessage));}finally{setIsSaving(false);}};// Get buy-in/buy-out data for a specific record\nconst getBuyInOutForRecord=record=>{const customerBuyInOut=buyInOutRecords.filter(bio=>bio.customerId===record.customerId&&// Match records from same session timeframe (within 1 hour)\nMath.abs(new Date(bio.timestamp).getTime()-new Date(record.sessionStartTime).getTime())<=3600000);const buyInAmount=customerBuyInOut.filter(bio=>bio.transactionType==='buy-in').reduce((sum,bio)=>sum+bio.amount,0);const buyOutAmount=customerBuyInOut.filter(bio=>bio.transactionType==='buy-out').reduce((sum,bio)=>sum+bio.amount,0);return{buyInAmount,buyOutAmount,netCashFlow:buyOutAmount-buyInAmount};};const getWinLossIndicator=winLoss=>{if(winLoss===0){return{text:'Break Even',icon:Target,bgColor:'bg-gray-100',textColor:'text-gray-700',iconColor:'text-gray-600'};}else if(winLoss>0){return{text:'Customer Win',icon:TrendingUp,bgColor:'bg-green-100',textColor:'text-green-700',iconColor:'text-green-600'};}else{return{text:'House Win',icon:TrendingDown,bgColor:'bg-red-100',textColor:'text-red-700',iconColor:'text-red-600'};}};const calculateTotals=()=>{return filteredRecords.reduce((totals,record)=>{const buyInOut=getBuyInOutForRecord(record);return{totalRolling:totals.totalRolling+(record.rollingAmount||0),totalWinLoss:totals.totalWinLoss+(record.winLoss||0),totalBuyIn:totals.totalBuyIn+buyInOut.buyInAmount,totalBuyOut:totals.totalBuyOut+buyInOut.buyOutAmount,recordCount:totals.recordCount+1};},{totalRolling:0,totalWinLoss:0,totalBuyIn:0,totalBuyOut:0,recordCount:0});};const totals=calculateTotals();if(loading){return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"flex items-center justify-center py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Loading real-time rolling history from Supabase...\"})]})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-green-50 border border-green-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Database,{className:\"w-4 h-4 text-green-600 mr-2\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-green-800\",children:\"\\u2705 Real-time Rolling History from Supabase\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-green-600\",children:[isStaff&&!isAdmin?'Showing only your records for privacy and security':'Rolling records and buy-in/buy-out data update automatically',lastDataUpdate&&\" \\u2022 Last sync: \".concat(lastDataUpdate.toLocaleTimeString())]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[isSaving&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-blue-600\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4 mr-1 animate-pulse\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Saving...\"})]}),isRefreshing&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-orange-600\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-4 h-4 mr-1 animate-spin\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"Syncing...\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:loadRealTimeData,disabled:isSaving||isRefreshing,className:\"text-xs\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Refresh\"]})]})]})}),isStaff&&!isAdmin&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-blue-50 border border-blue-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Lock,{className:\"w-4 h-4 text-blue-600 mr-2\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-blue-800\",children:\"Staff Privacy Protection\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-600\",children:\"You can only view and manage your own rolling records. Records from other staff members are not accessible for privacy and security reasons.\"})]})]})}),isAdmin&&/*#__PURE__*/_jsx(Tabs,{value:viewMode,onValueChange:value=>setViewMode(value),children:/*#__PURE__*/_jsxs(TabsList,{className:\"grid w-full grid-cols-2\",children:[/*#__PURE__*/_jsxs(TabsTrigger,{value:\"my_records\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"My Records\"}),/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"text-xs\",children:records.filter(r=>r.staffId===currentStaff.id).length})]}),/*#__PURE__*/_jsxs(TabsTrigger,{value:\"all\",className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Receipt,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"All Records\"}),/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"text-xs\",children:records.length})]})]})}),isStaff&&!isAdmin&&/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-5 h-5 text-gray-600\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"My Rolling Records\"}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs\",children:[records.length,\" records\"]}),/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs bg-blue-50 text-blue-700\",children:[/*#__PURE__*/_jsx(Lock,{className:\"w-3 h-3 mr-1\"}),\"Private\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\",children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(DollarSign,{className:\"w-5 h-5 text-blue-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Total Rolling\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold\",children:[\"$\",totals.totalRolling.toLocaleString()]})]})]})})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[totals.totalWinLoss>=0?/*#__PURE__*/_jsx(TrendingUp,{className:\"w-5 h-5 text-green-600\"}):/*#__PURE__*/_jsx(TrendingDown,{className:\"w-5 h-5 text-red-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Total Win/Loss\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold \".concat(totals.totalWinLoss>=0?'text-green-600':'text-red-600'),children:[\"$\",totals.totalWinLoss.toLocaleString()]})]})]})})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(ArrowDownCircle,{className:\"w-5 h-5 text-blue-500\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Total Buy-in\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold text-blue-600\",children:[\"$\",totals.totalBuyIn.toLocaleString()]})]})]})})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(ArrowUpCircle,{className:\"w-5 h-5 text-purple-500\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Total Buy-out\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold text-purple-600\",children:[\"$\",totals.totalBuyOut.toLocaleString()]})]})]})})}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(CardContent,{className:\"p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(FileImage,{className:\"w-5 h-5 text-orange-600\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:isStaff&&!isAdmin?'My Records':'Records'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold\",children:totals.recordCount}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[\"Net: $\",(totals.totalBuyOut-totals.totalBuyIn).toLocaleString()]})]})]})})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsxs(CardTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Filter,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Filters\"}),/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"text-xs bg-green-50 text-green-700\",children:\"Real-time Data\"}),isStaff&&!isAdmin&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-xs bg-blue-50 text-blue-700\",children:[/*#__PURE__*/_jsx(Lock,{className:\"w-3 h-3 mr-1\"}),\"Own Records Only\"]})]})}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-5 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium\",children:\"Start Date\"}),/*#__PURE__*/_jsx(Input,{type:\"date\",value:filterDateRange.start,onChange:e=>setFilterDateRange(_objectSpread(_objectSpread({},filterDateRange),{},{start:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium\",children:\"End Date\"}),/*#__PURE__*/_jsx(Input,{type:\"date\",value:filterDateRange.end,onChange:e=>setFilterDateRange(_objectSpread(_objectSpread({},filterDateRange),{},{end:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium\",children:\"Game Type\"}),/*#__PURE__*/_jsx(Input,{placeholder:\"Filter by game...\",value:filterGameType,onChange:e=>setFilterGameType(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium\",children:\"Customer\"}),/*#__PURE__*/_jsx(Input,{placeholder:\"Filter by customer...\",value:filterCustomer,onChange:e=>setFilterCustomer(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium\",children:\"Status\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"w-full px-3 py-2 border border-gray-300 rounded-md\",value:filterVerified,onChange:e=>setFilterVerified(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Records\"}),/*#__PURE__*/_jsx(\"option\",{value:\"verified\",children:\"Verified Only\"}),/*#__PURE__*/_jsx(\"option\",{value:\"unverified\",children:\"Unverified Only\"})]})]})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:filteredRecords.length===0?/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(Receipt,{className:\"w-12 h-12 mx-auto text-gray-400 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No rolling records found.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400 mt-2\",children:isStaff&&!isAdmin?'You haven\\'t recorded any rolling amounts yet.':viewMode==='my_records'?'You haven\\'t recorded any rolling amounts yet.':'No rolling records match the current filters.'}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:loadRealTimeData,className:\"mt-4\",disabled:isRefreshing,children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-4 h-4 mr-2\"}),\"Refresh Data\"]})]})}):filteredRecords.map(record=>{const indicator=getWinLossIndicator(record.winLoss||0);const IconComponent=indicator.icon;const buyInOut=getBuyInOutForRecord(record);return/*#__PURE__*/_jsxs(Card,{className:\"overflow-hidden\",children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:record.gameType}),record.verified?/*#__PURE__*/_jsxs(Badge,{variant:\"default\",className:\"bg-green-100 text-green-800\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-3 h-3 mr-1\"}),\"Verified\"]}):/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-orange-600 border-orange-200\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-3 h-3 mr-1\"}),\"Unverified\"]}),record.ocrData&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-blue-50 text-blue-700\",children:[/*#__PURE__*/_jsx(Scan,{className:\"w-3 h-3 mr-1\"}),\"OCR\"]}),/*#__PURE__*/_jsxs(Badge,{className:\"\".concat(indicator.bgColor,\" \").concat(indicator.textColor,\" flex items-center space-x-1\"),children:[/*#__PURE__*/_jsx(IconComponent,{className:\"w-3 h-3 \".concat(indicator.iconColor)}),/*#__PURE__*/_jsx(\"span\",{children:indicator.text})]}),record.venue==='Okada Casino'&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-purple-50 text-purple-700 border-purple-200\",children:[/*#__PURE__*/_jsx(Building2,{className:\"w-3 h-3 mr-1\"}),\"Okada\"]}),(buyInOut.buyInAmount>0||buyInOut.buyOutAmount>0)&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-indigo-50 text-indigo-700 border-indigo-200\",children:[/*#__PURE__*/_jsx(Wallet,{className:\"w-3 h-3 mr-1\"}),\"Cash Flow\"]})]}),/*#__PURE__*/_jsxs(CardDescription,{className:\"flex items-center space-x-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(UserIcon,{className:\"w-4 h-4 mr-1\"}),record.customerName]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Calendar,{className:\"w-4 h-4 mr-1\"}),new Date(record.sessionStartTime).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-4 h-4 mr-1\"}),new Date(record.sessionStartTime).toLocaleTimeString()]}),record.venue&&/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 mr-1\"}),record.venue]}),record.tableNumber&&/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(Hash,{className:\"w-4 h-4 mr-1\"}),record.tableNumber]}),isAdmin&&viewMode==='all'&&/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(ShieldCheck,{className:\"w-4 h-4 mr-1\"}),record.staffName]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>setSelectedRecord(record),children:[/*#__PURE__*/_jsx(Eye,{className:\"w-4 h-4 mr-2\"}),\"Details\"]}),(user.role==='admin'||user.role==='staff'&&record.staffId===currentStaff.id)&&/*#__PURE__*/_jsx(Button,{variant:record.verified?\"outline\":\"default\",size:\"sm\",onClick:()=>toggleVerification(record.id),disabled:isSaving,children:isSaving?/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4 animate-spin\"}):record.verified?'Unverify':'Verify'})]})]})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-6 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Rolling Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold\",children:[\"$\",(record.rollingAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Win/Loss\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold \".concat((record.winLoss||0)>=0?'text-green-600':'text-red-600'),children:[\"$\",(record.winLoss||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Buy-in\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold text-blue-600\",children:[\"$\",buyInOut.buyInAmount.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Buy-out\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold text-purple-600\",children:[\"$\",buyInOut.buyOutAmount.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Net Cash Flow\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold \".concat(buyInOut.netCashFlow>=0?'text-green-600':'text-red-600'),children:[\"$\",buyInOut.netCashFlow.toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Session Duration\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:record.sessionEndTime?\"\".concat(Math.round((new Date(record.sessionEndTime).getTime()-new Date(record.sessionStartTime).getTime())/(1000*60)),\" min\"):'Ongoing'}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[\"Recorded: \",new Date(record.recordedAt).toLocaleString()]})]})]}),record.notes&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 pt-4 border-t\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-500\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-700 mt-1\",children:record.notes})]})]})]},record.id);})}),selectedRecord&&/*#__PURE__*/_jsx(AlertDialog,{open:!!selectedRecord,onOpenChange:()=>setSelectedRecord(null),children:/*#__PURE__*/_jsxs(AlertDialogContent,{className:\"max-w-5xl max-h-[85vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(AlertDialogHeader,{children:[/*#__PURE__*/_jsxs(AlertDialogTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Rolling Record Details\"}),/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"bg-green-50 text-green-700\",children:\"Real-time Data\"}),isStaff&&!isAdmin&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-blue-50 text-blue-700\",children:[/*#__PURE__*/_jsx(Lock,{className:\"w-3 h-3 mr-1\"}),\"Own Record\"]})]}),/*#__PURE__*/_jsx(AlertDialogDescription,{children:\"Complete information for this rolling record including buy-in/buy-out data\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Customer\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg\",children:selectedRecord.customerName})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Agent\"}),/*#__PURE__*/_jsx(\"p\",{children:selectedRecord.agentName})]}),(isAdmin||selectedRecord.staffId===currentStaff.id)&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Staff\"}),/*#__PURE__*/_jsx(\"p\",{children:selectedRecord.staffName})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Game Type\"}),/*#__PURE__*/_jsx(\"p\",{children:selectedRecord.gameType})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Venue\"}),/*#__PURE__*/_jsx(\"p\",{children:selectedRecord.venue||'Not specified'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Table Number\"}),/*#__PURE__*/_jsx(\"p\",{children:selectedRecord.tableNumber||'Not specified'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Session Start\"}),/*#__PURE__*/_jsx(\"p\",{children:new Date(selectedRecord.sessionStartTime).toLocaleString()})]}),selectedRecord.sessionEndTime&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Session End\"}),/*#__PURE__*/_jsx(\"p\",{children:new Date(selectedRecord.sessionEndTime).toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Recorded At\"}),/*#__PURE__*/_jsx(\"p\",{children:new Date(selectedRecord.recordedAt).toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Verification Status\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2 mt-1\",children:selectedRecord.verified?/*#__PURE__*/_jsxs(Badge,{className:\"bg-green-100 text-green-800\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-3 h-3 mr-1\"}),\"Verified\"]}):/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"text-orange-600 border-orange-200\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-3 h-3 mr-1\"}),\"Unverified\"]})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium mb-3 flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(CircleDollarSign,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Financial Summary\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Rolling Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold\",children:[\"$\",(selectedRecord.rollingAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Win/Loss\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold \".concat((selectedRecord.winLoss||0)>=0?'text-green-600':'text-red-600'),children:[\"$\",(selectedRecord.winLoss||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Buy-in Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold text-blue-600\",children:[\"$\",(selectedRecord.buyInAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Buy-out Amount\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold text-purple-600\",children:[\"$\",(selectedRecord.buyOutAmount||0).toLocaleString()]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{className:\"text-sm font-medium text-gray-500\",children:\"Net Cash Flow\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xl font-bold \".concat((selectedRecord.buyOutAmount||0)-(selectedRecord.buyInAmount||0)>=0?'text-green-600':'text-red-600'),children:[\"$\",((selectedRecord.buyOutAmount||0)-(selectedRecord.buyInAmount||0)).toLocaleString()]})]})]})]}),selectedRecord.ocrData&&/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-medium mb-2 flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Scan,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"OCR Extraction Results\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Confidence:\"}),\" \",Math.round(selectedRecord.ocrData.confidence*100),\"%\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[selectedRecord.ocrData.extractedFields.amount&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",children:[\"Rolling: $\",selectedRecord.ocrData.extractedFields.amount]}),selectedRecord.ocrData.extractedFields.buyIn&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-blue-50 text-blue-700\",children:[\"Buy-in: $\",selectedRecord.ocrData.extractedFields.buyIn]}),selectedRecord.ocrData.extractedFields.buyOut&&/*#__PURE__*/_jsxs(Badge,{variant:\"outline\",className:\"bg-purple-50 text-purple-700\",children:[\"Buy-out: $\",selectedRecord.ocrData.extractedFields.buyOut]})]}),/*#__PURE__*/_jsxs(\"details\",{children:[/*#__PURE__*/_jsx(\"summary\",{className:\"cursor-pointer font-medium\",children:\"View extracted text\"}),/*#__PURE__*/_jsx(\"pre\",{className:\"mt-2 p-2 bg-gray-50 rounded text-xs whitespace-pre-wrap\",children:selectedRecord.ocrData.extractedText})]})]})]}),selectedRecord.attachments&&selectedRecord.attachments.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium mb-2\",children:\"Attachments\"}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:selectedRecord.attachments.map(attachment=>/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded p-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium\",children:attachment.name}),attachment.type.startsWith('image/')&&/*#__PURE__*/_jsx(\"img\",{src:attachment.data,alt:attachment.name,className:\"mt-2 max-h-32 w-auto rounded\"})]},attachment.id))})]}),selectedRecord.notes&&/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium mb-2\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700\",children:selectedRecord.notes})]})]}),/*#__PURE__*/_jsx(AlertDialogFooter,{children:/*#__PURE__*/_jsx(AlertDialogCancel,{children:\"Close\"})})]})})]});}// Export with error handler wrapper\nexport const StaffRollingHistory=withErrorHandler(StaffRollingHistoryComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}