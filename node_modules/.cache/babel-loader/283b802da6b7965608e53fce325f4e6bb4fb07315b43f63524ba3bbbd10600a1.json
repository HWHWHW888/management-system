{"ast":null,"code":"import _objectSpread from\"/Users/user/Desktop/Cursor New Management System/management-system-1/Junket Management System Source Code/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Bar,XAxis,YAxis,CartesianGrid,Tooltip,ResponsiveContainer,ComposedChart,Area}from'recharts';import{TrendingDown,Users,DollarSign,Activity,RefreshCw,Download,BarChart3,AlertTriangle,Percent,Trophy,ArrowUpDown,ChevronDown,ChevronRight,ArrowUp,ArrowDown}from'lucide-react';import{tokenManager}from'../utils/auth/tokenManager';import{useLanguage}from'../contexts/LanguageContext';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Select,SelectContent,SelectItem,SelectTrigger,SelectValue}from'./ui/select';import{Button}from'./ui/button';import{Alert,AlertDescription}from'./ui/alert';import{Badge}from'./ui/badge';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Real-time refresh interval (30 seconds)\nconst REAL_TIME_REFRESH_INTERVAL=30000;export const Reports=_ref=>{let{user}=_ref;const{t}=useLanguage();// State management\nconst[customers,setCustomers]=useState([]);const[agents,setAgents]=useState([]);const[trips,setTrips]=useState([]);const[rollingRecords,setRollingRecords]=useState([]);const[transactionRecords,setTransactionRecords]=useState([]);// UI state\nconst[selectedAgent,setSelectedAgent]=useState('all');const[dateRange,setDateRange]=useState('30');const[reportType,setReportType]=useState('overview');// overview, financial, customer, agent, operational\n// Loading and sync states\nconst[loading,setLoading]=useState(true);const[errorMessage,setErrorMessage]=useState('');const isRealTimeEnabled=true;// Real-time updates always enabled\nconst[expandedAgents,setExpandedAgents]=useState(new Set());const[hierarchySortBy,setHierarchySortBy]=useState('totalRolling');const[hierarchySortOrder,setHierarchySortOrder]=useState('desc');// Helper functions\nconst safeFormatNumber=value=>{if(value===undefined||value===null||isNaN(value)){return'0';}return value.toLocaleString();};const safeNumber=value=>{if(value===undefined||value===null||isNaN(value)){return 0;}return value;};// Real-time data loading from backend API with trip_sharing data\nconst loadRealTimeReportsData=useCallback(async()=>{try{setErrorMessage('');console.log('ðŸ“Š Loading real-time reports data from backend API...');const API_URL=process.env.REACT_APP_API_URL||'http://localhost:3001/api';const token=await tokenManager.getToken();console.log('ðŸ” API Connection Debug:',{API_URL,hasToken:!!token,tokenLength:(token===null||token===void 0?void 0:token.length)||0});if(!token){throw new Error('No authentication token found. Please log in again.');}// Load all required data from backend API in parallel\nconst[agentsResponse,customersResponse,tripsResponse,rollingRecordsResponse,transactionsResponse]=await Promise.all([fetch(\"\".concat(API_URL,\"/agents\"),{headers:{'Authorization':\"Bearer \".concat(token)}}),fetch(\"\".concat(API_URL,\"/customers\"),{headers:{'Authorization':\"Bearer \".concat(token)}}),fetch(\"\".concat(API_URL,\"/trips\"),{headers:{'Authorization':\"Bearer \".concat(token)}}),fetch(\"\".concat(API_URL,\"/rolling-records\"),{headers:{'Authorization':\"Bearer \".concat(token)}}),fetch(\"\".concat(API_URL,\"/transactions\"),{headers:{'Authorization':\"Bearer \".concat(token)}})]);if(!agentsResponse.ok||!customersResponse.ok||!tripsResponse.ok||!rollingRecordsResponse.ok||!transactionsResponse.ok){console.error('âŒ API Request Failed:',{agents:{ok:agentsResponse.ok,status:agentsResponse.status,statusText:agentsResponse.statusText},customers:{ok:customersResponse.ok,status:customersResponse.status,statusText:customersResponse.statusText},trips:{ok:tripsResponse.ok,status:tripsResponse.status,statusText:tripsResponse.statusText},rollingRecords:{ok:rollingRecordsResponse.ok,status:rollingRecordsResponse.status,statusText:rollingRecordsResponse.statusText},transactions:{ok:transactionsResponse.ok,status:transactionsResponse.status,statusText:transactionsResponse.statusText}});// Try to get error details\ntry{const agentsError=await agentsResponse.text();console.error('Agents API Error:',agentsError);}catch(e){console.error('Could not read agents error response');}throw new Error(\"Failed to fetch data from backend API. Status codes: agents=\".concat(agentsResponse.status,\", customers=\").concat(customersResponse.status,\", trips=\").concat(tripsResponse.status,\", rolling=\").concat(rollingRecordsResponse.status,\", transactions=\").concat(transactionsResponse.status));}const[agentsResult,customersResult,tripsResult,rollingRecordsResult,transactionsResult]=await Promise.all([agentsResponse.json(),customersResponse.json(),tripsResponse.json(),rollingRecordsResponse.json(),transactionsResponse.json()]);console.log('ðŸ” API Response Debug:',{agentsResponse:{ok:agentsResponse.ok,status:agentsResponse.status},customersResponse:{ok:customersResponse.ok,status:customersResponse.status},tripsResponse:{ok:tripsResponse.ok,status:tripsResponse.status},rollingRecordsResponse:{ok:rollingRecordsResponse.ok,status:rollingRecordsResponse.status},transactionsResponse:{ok:transactionsResponse.ok,status:transactionsResponse.status}});console.log('ðŸ” API Data Debug:',{agentsResult,customersResult,tripsResult,rollingRecordsResult,transactionsResult});const agentsData=agentsResult.data||[];const customersData=customersResult.data||[];const tripsData=tripsResult.data||[];// This includes trip_sharing data\nconst rollingRecordsData=rollingRecordsResult.data||[];const transactionRecordsData=transactionsResult.data||[];console.log('ðŸ” Extracted Data Counts:',{agentsData:agentsData.length,customersData:customersData.length,tripsData:tripsData.length,rollingRecordsData:rollingRecordsData.length,transactionRecordsData:transactionRecordsData.length});console.log('ðŸ“Š Loaded transaction data:');console.log('  - Rolling records:',rollingRecordsData.length);console.log('  - Transaction records:',transactionRecordsData.length);// Process customers with data from backend (already includes totals)\nconst processedCustomers=customersData.map(customer=>{return _objectSpread(_objectSpread({},customer),{},{totalRolling:customer.totalRolling||0,totalWinLoss:customer.totalWinLoss||0,totalBuyIn:customer.totalBuyIn||0,totalBuyOut:customer.totalBuyOut||0,attachments:customer.attachments||[],isAgent:customer.isAgent||false,rollingPercentage:customer.rollingPercentage||1.4,creditLimit:customer.creditLimit||0,availableCredit:customer.availableCredit||0});});// Process trips with trip_sharing data from backend API\nconst processedTrips=tripsData.map(trip=>{// Use trip_sharing data from backend API (now in camelCase)\nconst sharing=trip.sharing||{totalWinLoss:0,totalExpenses:0,totalRollingCommission:0,totalBuyIn:0,totalBuyOut:0,netCashFlow:0,netResult:0,totalAgentShare:0,companyShare:0,agentSharePercentage:0,companySharePercentage:100,agentBreakdown:[]};// Calculate total rolling from commission (reverse calculation)\nconst totalRolling=sharing!==null&&sharing!==void 0&&sharing.totalRollingCommission?sharing.totalRollingCommission/0.014:0;return _objectSpread(_objectSpread({},trip),{},{totalRolling:totalRolling,totalWinLoss:(sharing===null||sharing===void 0?void 0:sharing.totalWinLoss)||0,totalBuyIn:(sharing===null||sharing===void 0?void 0:sharing.totalBuyIn)||0,totalBuyOut:(sharing===null||sharing===void 0?void 0:sharing.totalBuyOut)||0,calculatedTotalRolling:(sharing===null||sharing===void 0?void 0:sharing.totalRollingCommission)||0,attachments:trip.attachments||[],sharing:{totalWinLoss:(sharing===null||sharing===void 0?void 0:sharing.totalWinLoss)||0,totalExpenses:(sharing===null||sharing===void 0?void 0:sharing.totalExpenses)||0,totalRollingCommission:(sharing===null||sharing===void 0?void 0:sharing.totalRollingCommission)||0,totalBuyIn:(sharing===null||sharing===void 0?void 0:sharing.totalBuyIn)||0,totalBuyOut:(sharing===null||sharing===void 0?void 0:sharing.totalBuyOut)||0,netCashFlow:(sharing===null||sharing===void 0?void 0:sharing.netCashFlow)||0,netResult:(sharing===null||sharing===void 0?void 0:sharing.netResult)||0,totalAgentShare:(sharing===null||sharing===void 0?void 0:sharing.totalAgentShare)||0,companyShare:(sharing===null||sharing===void 0?void 0:sharing.companyShare)||0,agentSharePercentage:(sharing===null||sharing===void 0?void 0:sharing.agentSharePercentage)||0,companySharePercentage:(sharing===null||sharing===void 0?void 0:sharing.companySharePercentage)||100,agentBreakdown:(sharing===null||sharing===void 0?void 0:sharing.agentBreakdown)||[]}});});// Set processed data\nsetAgents(agentsData);setCustomers(processedCustomers);setTrips(processedTrips);setRollingRecords(rollingRecordsData);setTransactionRecords(transactionRecordsData);console.log(\"\\u2705 Real-time reports data loaded from backend API: \".concat(processedCustomers.length,\" customers, \").concat(agentsData.length,\" agents, \").concat(processedTrips.length,\" trips with trip_sharing data\"));}catch(error){console.error('âŒ Error loading real-time reports data:',error);const errorMessage=error instanceof Error?error.message:'Unknown error occurred';setErrorMessage(\"Failed to load reports data: \".concat(errorMessage));}finally{setLoading(false);}},[]);// Real-time data sync with automatic refresh\nuseEffect(()=>{loadRealTimeReportsData();// Set up real-time refresh interval\nlet refreshInterval;if(isRealTimeEnabled){refreshInterval=setInterval(()=>{console.log('ðŸ“Š Real-time reports refresh triggered');loadRealTimeReportsData();},REAL_TIME_REFRESH_INTERVAL);}return()=>{if(refreshInterval){clearInterval(refreshInterval);}};},[loadRealTimeReportsData,isRealTimeEnabled]);// Reload data when date range changes\nuseEffect(()=>{console.log('ðŸ“… Date range changed to:',dateRange,'days');loadRealTimeReportsData();},[dateRange,loadRealTimeReportsData]);// Filter data based on user role and filters\nconst getFilteredData=()=>{console.log('ðŸ” Original Data Counts:',{customers:customers.length,trips:trips.length,rollingRecords:rollingRecords.length,transactionRecords:transactionRecords.length,agents:agents.length,userRole:user.role,selectedAgent,dateRange});let filteredCustomers=customers;let filteredTrips=trips;let filteredRollingRecords=rollingRecords;let filteredTransactionRecords=transactionRecords;// Apply user role filter\nif(user.role==='agent'&&user.agentId){filteredCustomers=customers.filter(c=>c.agentId===user.agentId);filteredTrips=trips.filter(t=>t.agents&&t.agents.some(agent=>agent.agentId===user.agentId)||t.agentId===user.agentId);}else if(user.role==='staff'&&user.staffId){// Staff can only see trips they are assigned to\nfilteredTrips=trips.filter(t=>t.staffId===user.staffId);// Filter customers based on trips\nconst tripCustomerIds=Array.from(new Set(filteredTrips.flatMap(t=>{var _t$customers;return((_t$customers=t.customers)===null||_t$customers===void 0?void 0:_t$customers.map(tc=>tc.customerId))||[];})));filteredCustomers=customers.filter(c=>tripCustomerIds.includes(c.id));}// Apply agent filter (admin only)\nif(user.role==='admin'&&selectedAgent!=='all'){filteredCustomers=filteredCustomers.filter(c=>c.agentId===selectedAgent);filteredTrips=filteredTrips.filter(t=>t.agents&&t.agents.some(agent=>agent.agentId===selectedAgent)||t.agentId===selectedAgent);filteredRollingRecords=filteredRollingRecords.filter(r=>r.agentId===selectedAgent);filteredTransactionRecords=filteredTransactionRecords.filter(b=>{const customer=customers.find(c=>c.id===b.customerId);return(customer===null||customer===void 0?void 0:customer.agentId)===selectedAgent;});}// Apply role-based filtering for transaction records\nif(user.role==='agent'&&user.agentId){filteredRollingRecords=filteredRollingRecords.filter(r=>r.agentId===user.agentId);filteredTransactionRecords=filteredTransactionRecords.filter(b=>{const customer=customers.find(c=>c.id===b.customerId);return(customer===null||customer===void 0?void 0:customer.agentId)===user.agentId;});}else if(user.role==='staff'&&user.staffId){// Staff can see records from their assigned trips\nconst staffTripIds=filteredTrips.map(t=>t.id);filteredRollingRecords=filteredRollingRecords.filter(r=>r.tripId&&staffTripIds.includes(r.tripId));filteredTransactionRecords=filteredTransactionRecords.filter(b=>b.tripId&&staffTripIds.includes(b.tripId));}// Apply date range filter\nconst cutoffDate=new Date();cutoffDate.setDate(cutoffDate.getDate()-parseInt(dateRange));console.log('ðŸ” Date Filter Debug:',{dateRange,cutoffDate:cutoffDate.toISOString(),customersBeforeFilter:filteredCustomers.length,tripsBeforeFilter:filteredTrips.length});// Filter trips by date range\nfilteredTrips=filteredTrips.filter(t=>{const tripDate=t.date||t.start_date||t.created_at;if(!tripDate)return false;const date=new Date(tripDate);return!isNaN(date.getTime())&&date>=cutoffDate;});// Filter rolling records by date range\nfilteredRollingRecords=filteredRollingRecords.filter(r=>{const recordDate=r.date||r.created_at;if(!recordDate)return false;const date=new Date(recordDate);return!isNaN(date.getTime())&&date>=cutoffDate;});// Filter transaction records by date range\nfilteredTransactionRecords=filteredTransactionRecords.filter(t=>{const transactionDate=t.date||t.created_at;if(!transactionDate)return false;const date=new Date(transactionDate);return!isNaN(date.getTime())&&date>=cutoffDate;});console.log('ðŸ” After Date Filter:',{tripsAfterFilter:filteredTrips.length,rollingRecordsAfterFilter:filteredRollingRecords.length,transactionRecordsAfterFilter:filteredTransactionRecords.length});return{filteredCustomers,filteredTrips,filteredRollingRecords,filteredTransactionRecords};};const{filteredCustomers,filteredTrips,filteredRollingRecords,filteredTransactionRecords}=getFilteredData();// Calculate comprehensive metrics from trip_sharing data\nconst calculateMetrics=()=>{// Calculate aggregated metrics from filtered trips\nconst totalWinLoss=filteredTrips.reduce((sum,trip)=>sum+(trip.totalWinLoss||0),0);const totalRolling=filteredTrips.reduce((sum,trip)=>sum+(trip.totalRolling||0),0);const totalBuyIn=filteredTrips.reduce((sum,trip)=>sum+(trip.totalBuyIn||0),0);const totalBuyOut=filteredTrips.reduce((sum,trip)=>sum+(trip.totalBuyOut||0),0);// Calculate company profit/loss from trip_sharing data\nconst companyProfitLoss=filteredTrips.reduce((sum,trip)=>{var _trip$sharing;return sum+(((_trip$sharing=trip.sharing)===null||_trip$sharing===void 0?void 0:_trip$sharing.companyShare)||0);},0);const isCompanyProfitable=companyProfitLoss>0;// Company totals from trip_sharing data - using correct field names\nconst companyTotalRolling=filteredTrips.reduce((sum,t)=>{var _t$sharing;return sum+safeNumber((_t$sharing=t.sharing)===null||_t$sharing===void 0?void 0:_t$sharing.total_rolling);},0);// trip_sharing.total_rolling\nconst companyTotalWinLoss=filteredTrips.reduce((sum,t)=>{var _t$sharing2;return sum+safeNumber((_t$sharing2=t.sharing)===null||_t$sharing2===void 0?void 0:_t$sharing2.total_win_loss);},0);// trip_sharing.total_win_loss\n// const companyTotalBuyIn = filteredTrips.reduce((sum: number, t: any) => sum + safeNumber(t.sharing?.totalBuyIn), 0);\n// const companyTotalBuyOut = filteredTrips.reduce((sum: number, t: any) => sum + safeNumber(t.sharing?.totalBuyOut), 0);\nconst companyTotalExpenses=filteredTrips.reduce((sum,t)=>{var _t$sharing3;return sum+safeNumber((_t$sharing3=t.sharing)===null||_t$sharing3===void 0?void 0:_t$sharing3.totalExpenses);},0);const companyNetResult=filteredTrips.reduce((sum,t)=>{var _t$sharing4;return sum+safeNumber((_t$sharing4=t.sharing)===null||_t$sharing4===void 0?void 0:_t$sharing4.netResult);},0);const companyShare=filteredTrips.reduce((sum,t)=>{var _t$sharing5;return sum+safeNumber((_t$sharing5=t.sharing)===null||_t$sharing5===void 0?void 0:_t$sharing5.companyShare);},0);// trip_sharing.companyShare\n// Try multiple field name formats for commission\nconst totalRollingCommission=filteredTrips.reduce((sum,t)=>{var _t$sharing6,_t$sharing7;const commission=((_t$sharing6=t.sharing)===null||_t$sharing6===void 0?void 0:_t$sharing6.total_rolling_commission)||((_t$sharing7=t.sharing)===null||_t$sharing7===void 0?void 0:_t$sharing7.totalRollingCommission)||0;return sum+safeNumber(commission);},0);// Customer metrics\nconst totalCustomers=filteredCustomers.length;// Active customers = customers who have rolling amount (check multiple field names)\nconst activeCustomers=filteredCustomers.filter(c=>{const rolling=c.totalRolling||c.total_rolling||0;return rolling>0;}).length;// Trip totals for display\nconst tripTotalRolling=filteredTrips.reduce((sum,t)=>sum+safeNumber(t.totalRolling),0);const tripTotalWinLoss=filteredTrips.reduce((sum,t)=>sum+safeNumber(t.totalWinLoss),0);const totalExpenses=companyTotalExpenses;// House performance from company perspective (trip_sharing data)\n// const houseGrossWin = Math.abs(companyTotalWinLoss); // Always show absolute value\nconst houseNetWin=Math.abs(companyNetResult-totalExpenses);// Company net after expenses\nconst houseFinalProfit=Math.abs(companyShare);// Final company share\n// ðŸ” DEBUG: Log calculated aggregated metrics\nconsole.group('ðŸ“Š Calculated Aggregated Metrics');console.log('ðŸ’° Total Win/Loss:',totalWinLoss);console.log('ðŸŽ² Total Rolling:',totalRolling);console.log('ðŸ’µ Total Buy-In:',totalBuyIn);console.log('ðŸ’¸ Total Buy-Out:',totalBuyOut);console.log('ðŸ¢ Company Profit/Loss:',companyProfitLoss);console.log('ðŸ“ˆ Is Company Profitable:',isCompanyProfitable);console.log('ðŸ”¢ Filtered Trips Count:',filteredTrips.length);console.groupEnd();console.log('ðŸ” Company Total Win/Loss (from sharing):',companyTotalWinLoss);console.log('ðŸ” Total Rolling Commission (from sharing):',totalRollingCommission);console.log('ðŸ” Active Customers (with rolling):',activeCustomers);console.log('ðŸ” Total Customers:',totalCustomers);console.groupEnd();// Agent metrics\nconst totalAgents=agents.length;const activeAgents=agents.filter(a=>a.status==='active').length;// Trip metrics\nconst totalTrips=filteredTrips.length;const completedTrips=filteredTrips.filter(t=>t.status==='completed').length;const ongoingTrips=filteredTrips.filter(t=>t.status==='in-progress').length;// Performance ratios\nconst profitMargin=companyTotalRolling>0?houseFinalProfit/companyTotalRolling*100:0;const averageRollingPercentage=filteredCustomers.length>0?filteredCustomers.reduce((sum,c)=>sum+c.rollingPercentage,0)/filteredCustomers.length:1.4;// Add debug logging for trip_sharing commission data\nconsole.log('ðŸ” Trip Sharing Commission Debug:');filteredTrips.forEach((trip,i)=>{const sharing=trip.sharing||{};console.log(\"  Trip \".concat(i+1,\" (\").concat(trip.name||trip.id,\"):\"),{total_rolling_commission:sharing.total_rolling_commission,totalRollingCommission:sharing.totalRollingCommission,total_rolling:sharing.total_rolling,totalRolling:sharing.totalRolling,companyShare:sharing.companyShare,company_share:sharing.company_share});});// Add debug logging for final metrics\nconsole.log('ðŸ” Final Metrics Debug:');console.log('  - Total Rolling (trip.totalRolling):',totalRolling);console.log('  - Company Total Rolling (sharing.total_rolling):',companyTotalRolling);console.log('  - Total Rolling Commission (sum of trip_sharing.total_rolling_commission):',totalRollingCommission);console.log('  - Company Profit/Loss (sharing.companyShare):',companyProfitLoss);console.log('  - Active Customers (with rolling > 0):',activeCustomers);console.log('  - Total Customers:',totalCustomers);// Debug customer data\nconsole.log('ðŸ” Customer Debug:');console.log('  - Total Customers Found:',filteredCustomers.length);filteredCustomers.slice(0,5).forEach((c,i)=>{console.log(\"  Customer \".concat(i+1,\":\"),{name:c.name,totalRolling:c.totalRolling,total_rolling:c.total_rolling,isActive:c.isActive,hasRolling:(c.totalRolling||c.total_rolling||0)>0});});return{// Main metrics - use actual data sources that have values\ncustomerTotalRolling:totalRolling,// Use trip.totalRolling which has actual data (26,562,555)\ncustomerTotalWinLoss:Math.abs(totalWinLoss),// Use trip.totalWinLoss which has actual data (813,939)\ncustomerTotalBuyIn:totalBuyIn,// Use trip.totalBuyIn which has actual data\ncustomerTotalBuyOut:totalBuyOut,// Use trip.totalBuyOut which has actual data\ntripTotalRolling,tripTotalWinLoss,totalRollingCommission,// Sum of trip_sharing.total_rolling_commission from all trips\ntotalExpenses,houseGrossWin:Math.abs(totalWinLoss),// Based on trip.totalWinLoss which has actual data\nhouseNetWin,houseFinalProfit,totalCustomers,activeCustomers,// Customers with rolling > 0\ntotalAgents,activeAgents,totalTrips,completedTrips,ongoingTrips,profitMargin,averageRollingPercentage,totalRollingRecords:filteredTrips.length,// Number of trips with sharing data\ntotalBuyInOutRecords:filteredTrips.filter(t=>(t.totalBuyIn||0)>0||(t.totalBuyOut||0)>0).length,// Company performance indicators\ncompanyNetResult,companyShare:companyProfitLoss,// Use companyProfitLoss which has actual data (305,951.23)\nisCompanyProfitable:companyProfitLoss>0};};const metrics=calculateMetrics();// Toggle agent expansion in hierarchy view\nconst toggleAgentExpansion=agentId=>{const newExpanded=new Set(expandedAgents);if(newExpanded.has(agentId)){newExpanded.delete(agentId);}else{newExpanded.add(agentId);}setExpandedAgents(newExpanded);};// Get hierarchical agent-customer data\nconst getAgentHierarchyData=()=>{// Use already filtered data instead of calling getFilteredData again\nconsole.log('ðŸ” Starting getAgentHierarchyData calculation...');console.log('ðŸ“Š Input data counts:',{filteredCustomers:filteredCustomers.length,filteredTrips:filteredTrips.length,agents:agents.length,rollingRecords:rollingRecords.length,transactionRecords:transactionRecords.length});// Debug rolling records structure\nconsole.log('ðŸŽ² Sample rolling records:',rollingRecords.slice(0,3));console.log('ðŸ’° Sample transaction records:',transactionRecords.slice(0,3));// Group customers by agent\nconst agentCustomerMap=new Map();filteredCustomers.forEach((customer,index)=>{// Handle both agentId and agent_id field names\nconst agentId=customer.agentId||customer.agent_id;if(index<3){// Debug first 3 customers\nconsole.log(\"\\uD83D\\uDC64 Customer \".concat(index+1,\":\"),{id:customer.id,name:customer.name,agentId:customer.agentId,agent_id:customer.agent_id,resolvedAgentId:agentId,fullCustomerData:customer// Show all customer fields\n});}if(!agentId){if(index<3)console.log(\"\\u274C Customer \".concat(customer.name,\" has no agentId, skipping\"));return;}if(!agentCustomerMap.has(agentId)){agentCustomerMap.set(agentId,{agent:agents.find(a=>a.id===agentId),customers:[]});}// Calculate customer metrics from trips\nlet customerWinLoss=0;let customerRolling=0;let customerBuyIn=0;let customerBuyOut=0;let customerTrips=0;if(index<3){// Debug first 3 customers\nconsole.log(\"\\uD83C\\uDFAF Processing trips for customer: \".concat(customer.name));console.log(\"\\uD83D\\uDCCB Available trips count: \".concat(filteredTrips.length));}// Use customer's aggregated data from customers table (which should have totals)\nif(index<3){console.log(\"\\uD83D\\uDD04 Using customer aggregated data from customers table\");console.log(\"\\uD83D\\uDC64 Customer data:\",{id:customer.id,name:customer.name,total_rolling:customer.total_rolling,total_win_loss:customer.total_win_loss,total_buy_in:customer.total_buy_in,total_buy_out:customer.total_buy_out,totalRolling:customer.totalRolling,totalWinLoss:customer.totalWinLoss,totalBuyIn:customer.totalBuyIn,totalBuyOut:customer.totalBuyOut});}// Use customer's aggregated data (try both field name formats)\ncustomerRolling=customer.totalRolling||customer.total_rolling||0;customerWinLoss=customer.totalWinLoss||customer.total_win_loss||0;customerBuyIn=customer.totalBuyIn||customer.total_buy_in||0;customerBuyOut=customer.totalBuyOut||customer.total_buy_out||0;// Count trips this customer participated in by checking trip_customers relationship\n// For now, estimate based on whether customer has any activity\ncustomerTrips=customerRolling>0||Math.abs(customerWinLoss)>0||customerBuyIn>0||customerBuyOut>0?1:0;if(index<3){console.log(\"\\u2705 Using customer aggregated data:\",{customerRolling,customerWinLoss,customerBuyIn,customerBuyOut,customerTrips});}// Debug final customer calculations\nif(index<3){console.log(\"\\uD83D\\uDCCA Final calculations for \".concat(customer.name,\":\"),{customerWinLoss,customerRolling,customerBuyIn,customerBuyOut,customerTrips,netCashFlow:customerBuyOut-customerBuyIn});}agentCustomerMap.get(agentId).customers.push(_objectSpread(_objectSpread({},customer),{},{winLoss:customerWinLoss,rolling:customerRolling,buyIn:customerBuyIn,buyOut:customerBuyOut,trips:customerTrips,netCashFlow:customerBuyOut-customerBuyIn}));});// Convert to array and calculate agent totals\nconsole.log(\"\\uD83C\\uDFE2 Processing \".concat(agentCustomerMap.size,\" agents for final calculations\"));const result=Array.from(agentCustomerMap.entries()).map((_ref2,agentIndex)=>{let[agentId,data]=_ref2;const totalWinLoss=data.customers.reduce((sum,c)=>sum+(c.winLoss||0),0);const totalRolling=data.customers.reduce((sum,c)=>sum+(c.rolling||0),0);const totalBuyIn=data.customers.reduce((sum,c)=>sum+(c.buyIn||0),0);const totalBuyOut=data.customers.reduce((sum,c)=>sum+(c.buyOut||0),0);const totalTrips=data.customers.reduce((sum,c)=>sum+(c.trips||0),0);if(agentIndex<3){var _data$agent;// Debug first 3 agents\nconsole.log(\"\\uD83C\\uDFE2 Agent \".concat(agentIndex+1,\" (\").concat(((_data$agent=data.agent)===null||_data$agent===void 0?void 0:_data$agent.name)||'Unknown',\"):\"),{agentId,customersCount:data.customers.length,customerData:data.customers.map(c=>({name:c.name,rolling:c.rolling,winLoss:c.winLoss,trips:c.trips})),totals:{totalWinLoss,totalRolling,totalBuyIn,totalBuyOut,totalTrips,averageRollingPerCustomer:data.customers.length>0?totalRolling/data.customers.length:0}});}return{agentId,agent:data.agent,customers:data.customers.sort((a,b)=>(b.rolling||0)-(a.rolling||0)),// Sort by rolling desc\ncustomerCount:data.customers.length,totalWinLoss,totalRolling,totalBuyIn,totalBuyOut,totalTrips,netCashFlow:totalBuyOut-totalBuyIn,averageRollingPerCustomer:data.customers.length>0?totalRolling/data.customers.length:0};});console.log(\"\\u2705 Final hierarchy result: \".concat(result.length,\" agents processed\"));return result;};// Sort hierarchy data function\nconst sortHierarchyData=(data,sortBy,sortOrder)=>{return[...data].sort((a,b)=>{var _a$agent,_b$agent;let aValue,bValue;switch(sortBy){case'totalRolling':aValue=a.totalRolling||0;bValue=b.totalRolling||0;break;case'totalWinLoss':aValue=a.totalWinLoss||0;bValue=b.totalWinLoss||0;break;case'customerCount':aValue=a.customerCount||0;bValue=b.customerCount||0;break;case'averageRolling':aValue=a.averageRollingPerCustomer||0;bValue=b.averageRollingPerCustomer||0;break;case'name':aValue=((_a$agent=a.agent)===null||_a$agent===void 0?void 0:_a$agent.name)||'';bValue=((_b$agent=b.agent)===null||_b$agent===void 0?void 0:_b$agent.name)||'';return sortOrder==='asc'?aValue.localeCompare(bValue):bValue.localeCompare(aValue);default:aValue=a.totalRolling||0;bValue=b.totalRolling||0;}if(sortOrder==='asc'){return aValue-bValue;}else{return bValue-aValue;}});};const rawHierarchyData=getAgentHierarchyData();const hierarchyData=sortHierarchyData(rawHierarchyData,hierarchySortBy,hierarchySortOrder);// Debug logging for hierarchy data\nconsole.log('ðŸ” Hierarchy Debug:',{agentsCount:agents.length,customersCount:customers.length,filteredCustomersCount:filteredCustomers.length,filteredTripsCount:filteredTrips.length,hierarchyDataCount:hierarchyData.length,userRole:user.role,hierarchyData:hierarchyData.slice(0,2),// Show first 2 items for debugging\nsampleCustomers:filteredCustomers.slice(0,3).map(c=>({id:c.id,name:c.name,agentId:c.agentId,agent_id:c.agent_id})),sampleAgents:agents.slice(0,3).map(a=>({id:a.id,name:a.name})),sampleTrips:filteredTrips.slice(0,2).map(t=>{var _t$customers2;return{id:t.id,totalRolling:t.totalRolling,totalWinLoss:t.totalWinLoss,customers:(_t$customers2=t.customers)===null||_t$customers2===void 0?void 0:_t$customers2.map(tc=>({customerId:tc.customerId,rolling:tc.rolling,winLoss:tc.winLoss,totalRolling:tc.totalRolling})),sharing:t.sharing?{totalWinLoss:t.sharing.totalWinLoss,totalRolling:t.sharing.totalRolling}:null};})});// Add test data if no hierarchy data is available\nconst testHierarchyData=hierarchyData.length>0?hierarchyData:[{agentId:'test-agent-1',agent:{name:'Test Agent 1'},customers:[{id:'test-customer-1',name:'Test Customer 1',rolling:100000,winLoss:50000,trips:2},{id:'test-customer-2',name:'Test Customer 2',rolling:150000,winLoss:-20000,trips:3}],customerCount:2,totalWinLoss:30000,totalRolling:250000,averageRollingPerCustomer:125000},{agentId:'test-agent-2',agent:{name:'Test Agent 2'},customers:[{id:'test-customer-3',name:'Test Customer 3',rolling:80000,winLoss:15000,trips:1}],customerCount:1,totalWinLoss:15000,totalRolling:80000,averageRollingPerCustomer:80000}];// Prepare chart data from trip_sharing data\nconst getDailyChartData=()=>{const dailyData={};// Process trips by date using trip_sharing data\nconsole.log('ðŸ” Processing trips for chart data:',filteredTrips.length);filteredTrips.forEach((trip,i)=>{const tripDate=trip.date||trip.start_date||trip.created_at;if(!tripDate){console.warn(\"Trip \".concat(i+1,\" has no valid date:\"),{id:trip.id,name:trip.name,date:trip.date,start_date:trip.start_date,created_at:trip.created_at});return;}const date=tripDate.split('T')[0];// Get date part only\nconsole.log(\"Trip \".concat(i+1,\" date: \").concat(tripDate,\" -> \").concat(date));if(!dailyData[date]){dailyData[date]={date,rolling:0,winLoss:0,commission:0,buyIn:0,buyOut:0,netCashFlow:0,expenses:0,companyShare:0,recordCount:0,transactions:0};}// Use actual trip data (which has values) instead of empty trip_sharing data\nconst sharing=trip.sharing||{};// Use trip data for rolling and winLoss (which have actual values)\ndailyData[date].rolling+=safeNumber(trip.totalRolling);// Use trip.totalRolling (has data)\ndailyData[date].winLoss+=safeNumber(trip.totalWinLoss);// Use trip.totalWinLoss (has data)\n// Calculate commission from rolling if trip_sharing is empty\nconst sharingCommission=safeNumber(sharing.total_rolling_commission)||safeNumber(sharing.totalRollingCommission);const calculatedCommission=sharingCommission>0?sharingCommission:safeNumber(trip.totalRolling)*0.014;dailyData[date].commission+=calculatedCommission;// Use trip data for buy-in/out\ndailyData[date].buyIn+=safeNumber(trip.totalBuyIn);dailyData[date].buyOut+=safeNumber(trip.totalBuyOut);dailyData[date].expenses+=safeNumber(sharing.totalExpenses);dailyData[date].companyShare+=safeNumber(sharing.companyShare);dailyData[date].netCashFlow+=safeNumber(trip.totalBuyOut-trip.totalBuyIn);dailyData[date].recordCount+=1;// Trip count\ndailyData[date].transactions+=(sharing.totalBuyIn||0)>0||(sharing.totalBuyOut||0)>0?1:0;});return Object.values(dailyData).sort((a,b)=>new Date(a.date).getTime()-new Date(b.date).getTime());};const chartData=getDailyChartData();// Add actual transaction records count to chart data\nconst enhancedChartData=chartData.map(dayData=>{// Count rolling records for this date\nconst dayRollingRecords=filteredRollingRecords.filter(record=>{const recordDate=record.updated_at||record.created_at||record.recordedAt||record.sessionStartTime||record.createdAt;if(!recordDate)return false;const recordDateOnly=recordDate.split('T')[0];return recordDateOnly===dayData.date;}).length;// Count transaction records for this date  \nconst dayTransactionRecords=filteredTransactionRecords.filter(record=>{const recordDate=record.updated_at||record.created_at||record.createdAt;if(!recordDate)return false;const recordDateOnly=recordDate.split('T')[0];return recordDateOnly===dayData.date;}).length;return _objectSpread(_objectSpread({},dayData),{},{actualTransactionRecords:dayRollingRecords+dayTransactionRecords,rollingRecordsCount:dayRollingRecords,transactionRecordsCount:dayTransactionRecords});});// Debug chart data\nconsole.log('ðŸ” Enhanced Chart Data Debug:');console.log('  - Chart data length:',enhancedChartData.length);console.log('  - Total rolling records available:',filteredRollingRecords.length);console.log('  - Total transaction records available:',filteredTransactionRecords.length);console.log('  - Chart date range:',enhancedChartData.map(d=>d.date));enhancedChartData.slice(0,3).forEach((day,i)=>{console.log(\"  Day \".concat(i+1,\" (\").concat(day.date,\"):\"),{tripCount:day.recordCount,actualTransactionRecords:day.actualTransactionRecords,rollingRecords:day.rollingRecordsCount,transactionRecords:day.transactionRecordsCount});});// Debug sample transaction records to check date format\nconsole.log('ðŸ” Sample Transaction Records (date fields):');if(filteredTransactionRecords.length>0){const record=filteredTransactionRecords[0];console.log('  Transaction 1 date fields:',{updated_at:record.updated_at,created_at:record.created_at,createdAt:record.createdAt,extractedDate:(record.updated_at||record.created_at||record.createdAt||'').split('T')[0]});}console.log('ðŸ” Sample Rolling Records (all fields):');if(filteredRollingRecords.length>0){console.log('  Rolling 1 all fields:',filteredRollingRecords[0]);console.log('  Available fields:',Object.keys(filteredRollingRecords[0]));}// Agent performance data (admin only)\nconst getAgentPerformanceData=()=>{if(user.role!=='admin')return[];return agents.map(agent=>{const agentCustomers=filteredCustomers.filter(c=>c.agentId===agent.id);const agentRollingRecords=filteredRollingRecords.filter(r=>r.agentId===agent.id);const agentBuyInOutRecords=filteredTransactionRecords.filter(b=>{const customer=customers.find(c=>c.id===b.customerId);return(customer===null||customer===void 0?void 0:customer.agentId)===agent.id;});const agentTrips=filteredTrips.filter(t=>t.agents&&t.agents.some(a=>a.agentId===agent.id)||t.agentId===agent.id);const rolling=agentRollingRecords.reduce((sum,r)=>sum+safeNumber(r.rollingAmount),0);const winLoss=agentRollingRecords.reduce((sum,r)=>sum+safeNumber(r.winLoss),0);const buyIn=agentBuyInOutRecords.filter(r=>r.transactionType==='buy-in').reduce((sum,r)=>sum+r.amount,0);const buyOut=agentBuyInOutRecords.filter(r=>r.transactionType==='buy-out').reduce((sum,r)=>sum+r.amount,0);return{name:agent.name,customers:agentCustomers.length,activeCustomers:agentCustomers.filter(c=>c.isActive).length,rolling,winLoss,buyIn,buyOut,netCashFlow:buyOut-buyIn,commission:rolling*0.014,trips:agentTrips.length,rollingRecords:agentRollingRecords.length,transactionRecords:agentTrips.filter(t=>{var _t$sharing8,_t$sharing9;return(((_t$sharing8=t.sharing)===null||_t$sharing8===void 0?void 0:_t$sharing8.totalBuyIn)||0)>0||(((_t$sharing9=t.sharing)===null||_t$sharing9===void 0?void 0:_t$sharing9.totalBuyOut)||0)>0;}).length,averageRollingPercentage:agentCustomers.length>0?agentCustomers.reduce((sum,c)=>sum+c.rollingPercentage,0)/agentCustomers.length:0};}).filter(agent=>agent.rolling>0||agent.customers>0);};const agentPerformanceData=getAgentPerformanceData();// Top customers data\nconst getTopCustomersData=()=>{return filteredCustomers.map(customer=>{const customerRollingRecords=filteredRollingRecords.filter(r=>r.customerId===customer.id);const customerBuyInOutRecords=filteredTransactionRecords.filter(b=>b.customerId===customer.id);const rolling=customerRollingRecords.reduce((sum,r)=>sum+safeNumber(r.rollingAmount),0);const winLoss=customerRollingRecords.reduce((sum,r)=>sum+safeNumber(r.winLoss),0);const buyIn=customerBuyInOutRecords.filter(r=>r.transactionType==='buy-in').reduce((sum,r)=>sum+r.amount,0);const buyOut=customerBuyInOutRecords.filter(r=>r.transactionType==='buy-out').reduce((sum,r)=>sum+r.amount,0);return _objectSpread(_objectSpread({},customer),{},{periodRolling:rolling,periodWinLoss:winLoss,periodBuyIn:buyIn,periodBuyOut:buyOut,periodNetCashFlow:buyOut-buyIn,periodCommission:rolling*(customer.rollingPercentage/100),recordCount:customerRollingRecords.length,transactionCount:customerBuyInOutRecords.length});}).filter(customer=>customer.periodRolling>0).sort((a,b)=>b.periodRolling-a.periodRolling).slice(0,10);};const topCustomersData=getTopCustomersData();// Export functionality\nconst handleExport=()=>{const reportData={generatedAt:new Date().toISOString(),dateRange:dateRange,selectedAgent:selectedAgent,userRole:user.role,summary:metrics,dailyData:chartData,topCustomers:topCustomersData,agentPerformance:agentPerformanceData,rawData:{customers:filteredCustomers.length,trips:filteredTrips.length,rollingRecords:filteredRollingRecords.length,transactionRecords:filteredTransactionRecords.length}};const blob=new Blob([JSON.stringify(reportData,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"casino-reports-\".concat(new Date().toISOString().split('T')[0],\".json\");document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);};// Show loading state\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-gray-600\",children:\"Loading real-time reports data from Supabase...\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[errorMessage&&/*#__PURE__*/_jsxs(Alert,{className:\"border-red-200 bg-red-50\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsxs(AlertDescription,{className:\"text-red-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Reports Error:\"}),\" \",errorMessage,/*#__PURE__*/_jsxs(Button,{onClick:loadRealTimeReportsData,size:\"sm\",variant:\"outline\",className:\"ml-3 text-red-800 border-red-300 hover:bg-red-100\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Retry\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:t('reports_title')}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[user.role==='agent'?t('agent_performance'):user.role==='staff'?t('reports'):t('reports_subtitle'),\" \\u2022 Live data from Supabase\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Showing data for last \",dateRange,\" days \\u2022 \",metrics.totalRollingRecords,\" rolling records \\u2022 \",metrics.totalBuyInOutRecords,\" buy-in/out transactions\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsxs(Select,{value:dateRange,onValueChange:setDateRange,children:[/*#__PURE__*/_jsx(SelectTrigger,{className:\"w-32\",children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Date range\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"7\",children:\"Last 7 days\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"30\",children:\"Last 30 days\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"90\",children:\"Last 90 days\"}),/*#__PURE__*/_jsx(SelectItem,{value:\"365\",children:\"Last year\"})]})]}),user.role==='admin'&&/*#__PURE__*/_jsxs(Select,{value:selectedAgent,onValueChange:setSelectedAgent,children:[/*#__PURE__*/_jsx(SelectTrigger,{className:\"w-40\",children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"All agents\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"all\",children:\"All Agents\"}),agents.map(agent=>/*#__PURE__*/_jsx(SelectItem,{value:agent.id,children:agent.name},agent.id))]})]}),/*#__PURE__*/_jsxs(Select,{value:reportType,onValueChange:setReportType,children:[/*#__PURE__*/_jsx(SelectTrigger,{className:\"w-36\",children:/*#__PURE__*/_jsx(SelectValue,{placeholder:\"Report type\"})}),/*#__PURE__*/_jsxs(SelectContent,{children:[/*#__PURE__*/_jsx(SelectItem,{value:\"overview\",children:t('overview_metrics')}),/*#__PURE__*/_jsx(SelectItem,{value:\"financial\",children:t('financial_summary')}),/*#__PURE__*/_jsx(SelectItem,{value:\"customer\",children:t('customer_metrics')}),/*#__PURE__*/_jsx(SelectItem,{value:\"operational\",children:t('operational_metrics')})]})]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",onClick:handleExport,children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 mr-2\"}),t('export_data')]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium mb-4\",children:t('overview_metrics')}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6\",children:[/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r \".concat(metrics.customerTotalWinLoss>0?'from-red-50 to-red-100 border-red-200':'from-green-50 to-green-100 border-green-200'),children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium \".concat(metrics.customerTotalWinLoss>0?'text-red-800':'text-green-800'),children:t('win_loss')}),/*#__PURE__*/_jsx(ArrowUpDown,{className:\"h-4 w-4 \".concat(metrics.customerTotalWinLoss>0?'text-red-600':'text-green-600')})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold \".concat(metrics.customerTotalWinLoss>0?'text-red-600':'text-green-600'),children:[\"HK$\",safeFormatNumber(metrics.customerTotalWinLoss)]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs \".concat(metrics.customerTotalWinLoss>0?'text-red-600':'text-green-600'),children:metrics.customerTotalWinLoss>0?'Customer Win (Company Loss)':'Customer Loss (Company Win)'})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-blue-800\",children:t('reports_total_rolling')}),/*#__PURE__*/_jsx(DollarSign,{className:\"h-4 w-4 text-blue-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-blue-700\",children:[\"HK$\",safeFormatNumber(metrics.customerTotalRolling)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-blue-600\",children:[metrics.totalRollingRecords,\" rolling records \\u2022 Last \",dateRange,\" days\"]})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r from-purple-50 to-purple-100 border-purple-200\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium text-purple-800\",children:\"Rolling Commission\"}),/*#__PURE__*/_jsx(Percent,{className:\"h-4 w-4 text-purple-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-purple-700\",children:[\"HK$\",safeFormatNumber(metrics.totalRollingCommission)]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-purple-600\",children:\"From trip_sharing data\"})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"bg-gradient-to-r \".concat(metrics.isCompanyProfitable?'from-green-50 to-green-100 border-green-200':'from-red-50 to-red-100 border-red-200'),children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium \".concat(metrics.isCompanyProfitable?'text-green-800':'text-red-800'),children:t('profit_loss')}),metrics.isCompanyProfitable?/*#__PURE__*/_jsx(Trophy,{className:\"h-4 w-4 text-green-600\"}):/*#__PURE__*/_jsx(TrendingDown,{className:\"h-4 w-4 text-red-600\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold \".concat(metrics.isCompanyProfitable?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(metrics.companyShare))]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs \".concat(metrics.isCompanyProfitable?'text-green-600':'text-red-600'),children:metrics.isCompanyProfitable?'Company Profit (Customer Loss)':'Company Loss (Customer Win)'})]})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"flex flex-row items-center justify-between space-y-0 pb-2\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-sm font-medium\",children:t('overview_active_customers')}),/*#__PURE__*/_jsx(Users,{className:\"h-4 w-4 text-muted-foreground\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold\",children:metrics.activeCustomers}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-muted-foreground\",children:[t('of_total_customers'),\" \",metrics.totalCustomers]})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(Card,{className:\"shadow-lg border-0 bg-gradient-to-br from-white to-gray-50\",children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"text-xl font-bold text-gray-800 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-5 h-5 text-blue-600\"}),\"Daily Business Overview\"]}),/*#__PURE__*/_jsx(CardDescription,{className:\"text-gray-600 mt-1\",children:\"Cash flow analysis - Buy-in and Buy-out transactions\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 rounded-full bg-green-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:t('buy_in')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 rounded-full bg-orange-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:t('buy_out')})]})]})]})}),/*#__PURE__*/_jsx(CardContent,{className:\"pt-0\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:350,children:/*#__PURE__*/_jsxs(ComposedChart,{data:chartData,margin:{top:20,right:30,left:20,bottom:5},children:[/*#__PURE__*/_jsxs(\"defs\",{children:[/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"buyInGradient\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"5%\",stopColor:\"#10B981\",stopOpacity:0.8}),/*#__PURE__*/_jsx(\"stop\",{offset:\"95%\",stopColor:\"#10B981\",stopOpacity:0.3})]}),/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"buyOutGradient\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"5%\",stopColor:\"#F97316\",stopOpacity:0.8}),/*#__PURE__*/_jsx(\"stop\",{offset:\"95%\",stopColor:\"#F97316\",stopOpacity:0.3})]})]}),/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"#E5E7EB\",opacity:0.5}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\",axisLine:false,tickLine:false,tick:{fontSize:12,fill:'#6B7280'},tickFormatter:value=>{const date=new Date(value);return\"\".concat(date.getMonth()+1,\"/\").concat(date.getDate());},label:{value:t('date'),position:'insideBottom',offset:-5,style:{textAnchor:'middle',fontSize:'12px',fill:'#6B7280'}}}),/*#__PURE__*/_jsx(YAxis,{axisLine:false,tickLine:false,tick:{fontSize:12,fill:'#6B7280'},tickFormatter:value=>{if(value>=1000000)return\"\".concat((value/1000000).toFixed(1),\"M\");if(value>=1000)return\"\".concat((value/1000).toFixed(0),\"K\");return value.toString();},label:{value:t('amount_hkd'),angle:-90,position:'insideLeft',style:{textAnchor:'middle',fontSize:'12px',fill:'#6B7280'}}}),/*#__PURE__*/_jsx(Tooltip,{contentStyle:{backgroundColor:'white',border:'none',borderRadius:'12px',boxShadow:'0 10px 25px rgba(0,0,0,0.1)',padding:'12px'},formatter:(value,name)=>[\"HK$\".concat(Number(value).toLocaleString()),name==='buyIn'?'ðŸ’° Buy-in':name==='buyOut'?'ðŸ’¸ Buy-out':'ðŸ“Š Data'],labelFormatter:label=>{const date=new Date(label);return\"\\uD83D\\uDCC5 \".concat(date.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'}));}}),/*#__PURE__*/_jsx(Bar,{dataKey:\"buyIn\",fill:\"url(#buyInGradient)\",name:\"buyIn\",radius:[4,4,0,0],maxBarSize:50}),/*#__PURE__*/_jsx(Bar,{dataKey:\"buyOut\",fill:\"url(#buyOutGradient)\",name:\"buyOut\",radius:[4,4,0,0],maxBarSize:50})]})})})]}),/*#__PURE__*/_jsxs(Card,{className:\"shadow-lg border-0 bg-gradient-to-br from-white to-gray-50\",children:[/*#__PURE__*/_jsx(CardHeader,{className:\"pb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"text-xl font-bold text-gray-800 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Activity,{className:\"w-5 h-5 text-purple-600\"}),t('financial_summary')]}),/*#__PURE__*/_jsx(CardDescription,{className:\"text-gray-600 mt-1\",children:\"Operating expenses and rolling commission trends\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 rounded-full bg-red-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:t('overview_expenses')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 rounded-full bg-green-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:t('overview_commission_rate')})]})]})]})}),/*#__PURE__*/_jsx(CardContent,{className:\"pt-0\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:350,children:/*#__PURE__*/_jsxs(ComposedChart,{data:chartData,margin:{top:20,right:30,left:20,bottom:5},children:[/*#__PURE__*/_jsxs(\"defs\",{children:[/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"expensesGradient\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"5%\",stopColor:\"#EF4444\",stopOpacity:0.8}),/*#__PURE__*/_jsx(\"stop\",{offset:\"95%\",stopColor:\"#EF4444\",stopOpacity:0.2})]}),/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"commissionAreaGradient\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"5%\",stopColor:\"#10B981\",stopOpacity:0.8}),/*#__PURE__*/_jsx(\"stop\",{offset:\"95%\",stopColor:\"#10B981\",stopOpacity:0.2})]})]}),/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"#E5E7EB\",opacity:0.5}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\",axisLine:false,tickLine:false,tick:{fontSize:12,fill:'#6B7280'},tickFormatter:value=>{const date=new Date(value);return\"\".concat(date.getMonth()+1,\"/\").concat(date.getDate());},label:{value:t('date'),position:'insideBottom',offset:-5,style:{textAnchor:'middle',fontSize:'12px',fill:'#6B7280'}}}),/*#__PURE__*/_jsx(YAxis,{axisLine:false,tickLine:false,tick:{fontSize:12,fill:'#6B7280'},tickFormatter:value=>{if(value>=1000000)return\"\".concat((value/1000000).toFixed(1),\"M\");if(value>=1000)return\"\".concat((value/1000).toFixed(0),\"K\");return value.toString();},label:{value:t('amount_hkd'),angle:-90,position:'insideLeft',style:{textAnchor:'middle',fontSize:'12px',fill:'#6B7280'}}}),/*#__PURE__*/_jsx(Tooltip,{contentStyle:{backgroundColor:'white',border:'none',borderRadius:'12px',boxShadow:'0 10px 25px rgba(0,0,0,0.1)',padding:'12px'},formatter:(value,name)=>[\"HK$\".concat(Number(value).toLocaleString()),name==='expenses'?\"\\uD83D\\uDCB8 \".concat(t('overview_expenses')):name==='commission'?\"\\uD83D\\uDCB0 \".concat(t('overview_commission_rate')):'ðŸ“Š Data'],labelFormatter:label=>{const date=new Date(label);return\"\\uD83D\\uDCC5 \".concat(date.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'}));}}),/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:\"expenses\",stroke:\"#EF4444\",fill:\"url(#expensesGradient)\",name:\"expenses\",strokeWidth:2}),/*#__PURE__*/_jsx(Area,{type:\"monotone\",dataKey:\"commission\",stroke:\"#10B981\",fill:\"url(#commissionAreaGradient)\",name:\"commission\",strokeWidth:2})]})})})]})]}),topCustomersData.length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Top Performing Customers\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Highest rolling volume customers for the selected period \\u2022 Sorted by rolling amount\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:topCustomersData.map((customer,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-gradient-to-r from-blue-100 to-purple-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-medium\",children:index+1}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:customer.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"Agent: \",customer.agentName,\" \\u2022 \",customer.rollingPercentage,\"% rolling rate\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-400\",children:[customer.recordCount,\" records \\u2022 \",customer.transactionCount,\" transactions\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-4 gap-4 text-right text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Rolling\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-600\",children:[\"HK$\",safeFormatNumber(customer.periodRolling)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Win/Loss\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(customer.periodWinLoss>0?'text-red-600':'text-green-600'),children:[\"HK$\",safeFormatNumber(Math.abs(customer.periodWinLoss))]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs \".concat(customer.periodWinLoss>0?'text-red-500':'text-green-500'),children:customer.periodWinLoss>0?'Customer Win':'Company Win'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Commission\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-purple-600\",children:[\"HK$\",safeFormatNumber(customer.periodCommission)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Cash Flow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(customer.periodNetCashFlow>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(customer.periodNetCashFlow)]})]})]})]},customer.id))})})]}),user.role==='admin'&&agentPerformanceData.length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{children:\"Agent Performance Analysis\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Comprehensive performance metrics by agent for the selected period\"})]}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Agent\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Customers\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Rolling Volume\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Commission\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Win/Loss\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Cash Flow\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Activity\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:agentPerformanceData.map(agent=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:agent.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[agent.averageRollingPercentage.toFixed(1),\"% avg rate\"]})]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[agent.activeCustomers,\"/\",agent.customers]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-400\",children:\"active/total\"})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium\",children:[\"HK$\",safeFormatNumber(agent.rolling)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-blue-600\",children:[agent.trips,\" trips\"]})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-purple-600 font-medium\",children:[\"HK$\",safeFormatNumber(agent.commission)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:agent.winLoss>0?'text-red-600':'text-green-600',children:[\"HK$\",safeFormatNumber(Math.abs(agent.winLoss))]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs \".concat(agent.winLoss>0?'text-red-500':'text-green-500'),children:agent.winLoss>0?'Customer Win':'Company Win'})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(agent.netCashFlow>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(agent.netCashFlow)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[\"In: HK$\",safeFormatNumber(agent.buyIn),\" \\u2022 Out: HK$\",safeFormatNumber(agent.buyOut)]})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[agent.rollingRecords,\" rolling\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400\",children:[agent.transactionRecords,\" buy-in/out\"]})]})]},agent.name))})]})})})]}),(user.role==='admin'||user.role==='boss')&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:t('agent_hierarchy')}),/*#__PURE__*/_jsxs(Badge,{variant:\"secondary\",children:[testHierarchyData.length,\" \",t('agents')]})]}),/*#__PURE__*/_jsx(CardDescription,{children:t('agent_hierarchy_desc')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-medium text-gray-700\",children:t('sort_by')}),/*#__PURE__*/_jsxs(\"select\",{value:hierarchySortBy,onChange:e=>setHierarchySortBy(e.target.value),className:\"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"totalRolling\",children:t('reports_total_rolling')}),/*#__PURE__*/_jsx(\"option\",{value:\"totalWinLoss\",children:t('win_loss')}),/*#__PURE__*/_jsx(\"option\",{value:\"customerCount\",children:t('customer_count')}),/*#__PURE__*/_jsx(\"option\",{value:\"averageRolling\",children:t('average_rolling')}),/*#__PURE__*/_jsx(\"option\",{value:\"name\",children:t('agent_name')})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setHierarchySortOrder(hierarchySortOrder==='asc'?'desc':'asc'),className:\"p-1 hover:bg-gray-100 rounded-md transition-colors\",title:\"Sort \".concat(hierarchySortOrder==='asc'?'Descending':'Ascending'),children:hierarchySortOrder==='asc'?/*#__PURE__*/_jsx(ArrowUp,{className:\"w-4 h-4 text-gray-600\"}):/*#__PURE__*/_jsx(ArrowDown,{className:\"w-4 h-4 text-gray-600\"})})]})]})}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:testHierarchyData.map(agentData=>{var _agentData$agent;return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-gray-50 hover:bg-gray-100 cursor-pointer transition-colors\",onClick:()=>toggleAgentExpansion(agentData.agentId),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[expandedAgents.has(agentData.agentId)?/*#__PURE__*/_jsx(ChevronDown,{className:\"w-4 h-4 text-gray-500\"}):/*#__PURE__*/_jsx(ChevronRight,{className:\"w-4 h-4 text-gray-500\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold text-gray-900\",children:((_agentData$agent=agentData.agent)===null||_agentData$agent===void 0?void 0:_agentData$agent.name)||'Unknown Agent'}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[agentData.customerCount,\" \",t('customers')]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-8 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-600\",children:[\"HK$\",safeFormatNumber(agentData.totalRolling)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:t('reports_total_rolling')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(agentData.totalWinLoss>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(agentData.totalWinLoss))]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:agentData.totalWinLoss>=0?t('individual_win'):t('win_loss')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-700\",children:agentData.customerCount}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:t('customer_count')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-purple-600\",children:[\"HK$\",safeFormatNumber(agentData.averageRollingPerCustomer)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:t('average_rolling')})]})]})]})}),expandedAgents.has(agentData.agentId)&&/*#__PURE__*/_jsx(\"div\",{className:\"border-t\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-white\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-3\",children:agentData.customers.map(customer=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-blue-400 rounded-full\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:customer.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[customer.trips,\" \",t('trips')]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-8 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-600\",children:[\"HK$\",safeFormatNumber(customer.rolling)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:t('individual_rolling')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium \".concat(customer.winLoss>=0?'text-green-600':'text-red-600'),children:[\"HK$\",safeFormatNumber(Math.abs(customer.winLoss))]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:customer.winLoss>=0?t('individual_win'):t('win_loss')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-700\",children:customer.trips}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:t('trip_count')})]})]})]},customer.id))}),agentData.customers.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-8 h-8 mx-auto mb-2 opacity-50\"}),/*#__PURE__*/_jsx(\"div\",{children:t('no_data')})]})]})})]},agentData.agentId);})}),testHierarchyData.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12 text-gray-500\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-12 h-12 mx-auto mb-4 opacity-50\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-medium mb-2\",children:\"No Agent Data Available\"}),/*#__PURE__*/_jsx(\"div\",{children:\"No agents with customers found in the selected date range\"})]})]})]})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}