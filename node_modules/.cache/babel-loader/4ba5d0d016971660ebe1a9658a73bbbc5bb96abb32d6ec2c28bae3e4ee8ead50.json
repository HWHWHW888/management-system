{"ast":null,"code":"import React,{useState}from'react';import{Button}from'./ui/button';import{Input}from'./ui/input';import{Label}from'./ui/label';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{Alert,AlertDescription}from'./ui/alert';import{Badge}from'./ui/badge';import{db}from'../utils/supabase/supabaseClients';import{db as databaseWrapper}from'../utils/api/databaseWrapper';import{Database,Shield,Info,AlertTriangle,CheckCircle,Key,Users,RefreshCw,Bug}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export function LoginForm(_ref){let{onLogin}=_ref;const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[isLoading,setIsLoading]=useState(false);const[showTestCredentials,setShowTestCredentials]=useState(false);const[debugMode,setDebugMode]=useState(false);const[connectionTest,setConnectionTest]=useState(null);const handleSubmit=async e=>{e.preventDefault();setError('');setIsLoading(true);try{console.log('üîê Starting login process...');console.log('üë§ Username:',username);console.log('üîë Password length:',password.length);// First check if Supabase is healthy\nconsole.log('üîç Checking database health...');const isHealthy=await db.isHealthy();if(!isHealthy){throw new Error('Database connection failed. Please check your internet connection and try again.');}console.log('‚úÖ Database health check passed, attempting login...');const user=await databaseWrapper.login(username,password);console.log('‚úÖ Login successful for user:',user);console.log('üîç User object structure:',JSON.stringify(user,null,2));console.log('üîç User role:',user===null||user===void 0?void 0:user.role);console.log('üîç User token:',user!==null&&user!==void 0&&user.token?'Present':'Missing');onLogin(user);}catch(error){var _error$message;console.error('‚ùå Login error:',error);// If login fails and it's admin credentials, try to initialize admin account\nif(username==='admin'&&password==='admin123'&&(_error$message=error.message)!==null&&_error$message!==void 0&&_error$message.includes('Invalid')){console.log('üîß Login failed for admin, attempting to initialize admin account...');try{await db.initializeSampleDataIfNeeded();console.log('‚úÖ Admin account initialized, retrying login...');// Retry login after initialization\nconst retryUser=await databaseWrapper.login(username,password);console.log('‚úÖ Retry login successful for user:',retryUser);onLogin(retryUser);return;// Exit early if retry succeeds\n}catch(initError){console.error('‚ùå Failed to initialize admin account:',initError);setError(\"Login failed. Admin initialization error: \".concat(initError.message));return;}}setError(error.message||'Login failed');// If login fails, run a connection test for debugging\nif(debugMode){try{const testResult=await db.testConnection();setConnectionTest(testResult);}catch(testError){console.error('Connection test failed:',testError);}}}finally{setIsLoading(false);}};const fillTestCredentials=role=>{switch(role){case'admin':setUsername('admin');setPassword('admin123');break;case'agent':setUsername('agent1');setPassword('agent123');break;case'staff':setUsername('staff1');setPassword('staff123');break;}setError('');};const testDatabaseConnection=async()=>{setIsLoading(true);try{const testResult=await db.testConnection();setConnectionTest(testResult);if(testResult.success){setError('');console.log('‚úÖ Database connection test successful');}else{setError(\"Connection test failed: \".concat(testResult.message));console.error('‚ùå Database connection test failed:',testResult);}}catch(error){setError(\"Connection test error: \".concat(error.message));console.error('‚ùå Connection test error:',error);}finally{setIsLoading(false);}};const initializeAdminAccount=async()=>{setIsLoading(true);try{console.log('üîß Manually initializing admin account...');await db.initializeSampleDataIfNeeded();setError('');alert('Admin account initialized successfully! Try logging in with admin/admin123');}catch(error){setError(\"Initialization failed: \".concat(error.message));console.error('‚ùå Admin initialization error:',error);}finally{setIsLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md w-full\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"text-center\",children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-2xl\",children:\"Casino Management System\"}),/*#__PURE__*/_jsx(CardDescription,{children:\"Sign in to access the management dashboard\"})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"username\",children:\"Username\"}),/*#__PURE__*/_jsx(Input,{id:\"username\",type:\"text\",value:username,onChange:e=>setUsername(e.target.value),placeholder:\"Enter username\",required:true,disabled:isLoading})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"password\",children:\"Password\"}),/*#__PURE__*/_jsx(Input,{id:\"password\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Enter password\",required:true,disabled:isLoading})]}),error&&/*#__PURE__*/_jsxs(Alert,{className:\"border-red-200 bg-red-50\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"w-4 h-4 text-red-600\"}),/*#__PURE__*/_jsxs(AlertDescription,{className:\"text-red-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Login Failed:\"}),\" \",error,error.includes('Invalid credentials')&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-xs\",children:[\"Make sure you're using the correct credentials:\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Admin: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-red-100 px-1 rounded\",children:\"admin / admin123\"}),/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Agent: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-red-100 px-1 rounded\",children:\"agent1 / agent123\"}),/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Staff: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-red-100 px-1 rounded\",children:\"staff1 / staff123\"})]})]})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",className:\"w-full\",disabled:isLoading,children:isLoading?'Signing In...':'Sign In'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-yellow-50 border border-yellow-200 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Key,{className:\"w-4 h-4 text-yellow-600 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-yellow-800\",children:\"Test Credentials\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-yellow-700 mt-1\",children:\"Click to auto-fill login credentials for testing.\"})]})]}),/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",onClick:()=>setShowTestCredentials(!showTestCredentials),className:\"text-xs\",children:showTestCredentials?'Hide':'Show'})]}),showTestCredentials&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",onClick:()=>fillTestCredentials('admin'),disabled:isLoading,className:\"text-xs\",children:\"Admin\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",onClick:()=>fillTestCredentials('agent'),disabled:isLoading,className:\"text-xs\",children:\"Agent\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"sm\",onClick:()=>fillTestCredentials('staff'),disabled:isLoading,className:\"text-xs\",children:\"Staff\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-yellow-600 space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Admin:\"}),/*#__PURE__*/_jsx(\"code\",{className:\"bg-yellow-100 px-1 rounded\",children:\"admin / admin123\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Agent:\"}),/*#__PURE__*/_jsx(\"code\",{className:\"bg-yellow-100 px-1 rounded\",children:\"agent1 / agent123\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Staff:\"}),/*#__PURE__*/_jsx(\"code\",{className:\"bg-yellow-100 px-1 rounded\",children:\"staff1 / staff123\"})]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-blue-50 border border-blue-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Bug,{className:\"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-blue-800\",children:\"Troubleshooting\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-700 mt-1\",children:\"If login fails, try these troubleshooting steps.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:testDatabaseConnection,disabled:isLoading,className:\"text-xs\",children:[/*#__PURE__*/_jsx(Database,{className:\"w-3 h-3 mr-1\"}),\"Test Connection\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:initializeAdminAccount,disabled:isLoading,className:\"text-xs\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:\"w-3 h-3 mr-1\"}),\"Reset Admin\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"outline\",size:\"sm\",onClick:()=>setDebugMode(!debugMode),className:\"text-xs\",children:[/*#__PURE__*/_jsx(Bug,{className:\"w-3 h-3 mr-1\"}),debugMode?'Hide':'Show',\" Debug\"]})]})]})]})}),debugMode&&connectionTest&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-gray-50 border border-gray-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Info,{className:\"w-4 h-4 text-gray-600 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-800\",children:\"Debug Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-xs text-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Status: \",connectionTest.success?'‚úÖ Success':'‚ùå Failed']}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Message: \",connectionTest.message]}),connectionTest.details&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Details: \",connectionTest.details]})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-green-50 border border-green-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-green-800\",children:\"Fresh Start System\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-green-700 mt-1\",children:[\"The system starts with clean data. Only admin credentials are preset:\",/*#__PURE__*/_jsx(\"code\",{className:\"bg-green-100 px-1 rounded ml-1\",children:\"admin / admin123\"})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-purple-50 border border-purple-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Database,{className:\"w-4 h-4 text-purple-600 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-purple-800\",children:\"Secure Cloud Storage\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-purple-700 mt-1\",children:\"All data is securely stored in Supabase cloud database with automatic backups and enterprise-grade security.\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-gray-50 border border-gray-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 text-gray-600 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-800\",children:\"User Roles\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"text-xs bg-red-50 text-red-700\",children:\"Admin\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-700\",children:\"Full system access\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"text-xs bg-blue-50 text-blue-700\",children:\"Agent\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-700\",children:\"Customer & project management\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Badge,{variant:\"outline\",className:\"text-xs bg-green-50 text-green-700\",children:\"Staff\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-700\",children:\"Rolling records & reports\"})]})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-red-50 border border-red-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Shield,{className:\"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-red-800\",children:\"Security Notice\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-600 mt-1\",children:\"This system contains sensitive business information. Unauthorized access is prohibited. Admin credentials can be changed in Data Management after login.\"})]})]})})]})]})]})})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}