{"ast":null,"code":"import React,{useState}from'react';import{Input}from'./ui/input';import{Label}from'./ui/label';import{Card,CardContent,CardDescription,CardHeader,CardTitle}from'./ui/card';import{db}from'../utils/supabase/supabaseClients';import{db as databaseWrapper}from'../utils/api/databaseWrapper';import{Loader2}from'lucide-react';import{DSButton,DSNotification,DSFormLayout,typography}from'./common/DesignSystem';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export function LoginForm(_ref){let{onLogin}=_ref;const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const[isLoading,setIsLoading]=useState(false);const handleSubmit=async e=>{e.preventDefault();setError('');setIsLoading(true);try{console.log('🔐 Starting login process...');console.log('👤 Username:',username);console.log('🔑 Password length:',password.length);// First check if Supabase is healthy\nconsole.log('🔍 Checking database health...');const isHealthy=await db.isHealthy();if(!isHealthy){throw new Error('Database connection failed. Please check your internet connection and try again.');}console.log('✅ Database health check passed, attempting login...');const user=await databaseWrapper.login(username,password);console.log('✅ Login successful for user:',user);console.log('🔍 User object structure:',JSON.stringify(user,null,2));console.log('🔍 User role:',user===null||user===void 0?void 0:user.role);console.log('🔍 User token:',user!==null&&user!==void 0&&user.token?'Present':'Missing');onLogin(user);}catch(error){var _error$message;console.error('❌ Login error:',error);// If login fails and it's admin credentials, try to initialize admin account\nif(username==='admin'&&password==='admin123'&&(_error$message=error.message)!==null&&_error$message!==void 0&&_error$message.includes('Invalid')){console.log('🔧 Login failed for admin, attempting to initialize admin account...');try{await db.initializeSampleDataIfNeeded();console.log('✅ Admin account initialized, retrying login...');// Retry login after initialization\nconst retryUser=await databaseWrapper.login(username,password);console.log('✅ Retry login successful for user:',retryUser);onLogin(retryUser);return;// Exit early if retry succeeds\n}catch(initError){console.error('❌ Failed to initialize admin account:',initError);setError(\"Login failed. Admin initialization error: \".concat(initError.message));return;}}setError(error.message||'Login failed');}finally{setIsLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-6 sm:py-12 px-2 sm:px-4 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md w-full\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:/*#__PURE__*/_jsx(DSNotification,{type:\"error\",title:\"Authentication Failed\",message:error,onClose:()=>setError(''),autoClose:false})}),/*#__PURE__*/_jsxs(Card,{className:\"bg-white/95 backdrop-blur-sm border-2 border-amber-300 shadow-2xl shadow-amber-500/20\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"text-center pb-6 sm:pb-8 pt-6 sm:pt-8 px-4 sm:px-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 sm:w-16 sm:h-16 mx-auto bg-gradient-to-br from-amber-400 to-amber-600 rounded-full flex items-center justify-center shadow-lg\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-lg sm:text-2xl font-bold text-white\",children:\"HW\"})})}),/*#__PURE__*/_jsx(CardTitle,{className:\"\".concat(typography.h2,\" sm:text-3xl font-bold bg-gradient-to-r from-amber-600 to-amber-800 bg-clip-text text-transparent\"),children:\"Hoe Win Junket Management System\"}),/*#__PURE__*/_jsx(CardDescription,{className:\"\".concat(typography.body,\" text-slate-600 mt-3 font-medium\"),children:\"Professional Gaming Management Platform\"})]}),/*#__PURE__*/_jsx(CardContent,{className:\"px-4 sm:px-8 pb-6 sm:pb-8\",children:/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(DSFormLayout,{columns:1,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"username\",className:\"\".concat(typography.label,\" text-slate-700 font-semibold\"),children:\"Username\"}),/*#__PURE__*/_jsx(Input,{id:\"username\",type:\"text\",value:username,onChange:e=>setUsername(e.target.value),placeholder:\"Enter username\",required:true,disabled:isLoading,className:\"h-10 sm:h-12 border-2 border-slate-200 focus:border-amber-400 focus:ring-amber-400/20 bg-white/80 backdrop-blur-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"password\",className:\"\".concat(typography.label,\" text-slate-700 font-semibold\"),children:\"Password\"}),/*#__PURE__*/_jsx(Input,{id:\"password\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Enter password\",required:true,disabled:isLoading,className:\"h-10 sm:h-12 border-2 border-slate-200 focus:border-amber-400 focus:ring-amber-400/20 bg-white/80 backdrop-blur-sm\"})]}),error.includes('Invalid credentials')&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 p-3 bg-amber-50/80 border border-amber-200 rounded-md\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(typography.small,\" font-semibold mb-2 text-amber-800\"),children:\"Valid Credentials:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(typography.small,\" space-y-1 text-amber-700\"),children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Admin: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-amber-200 px-2 py-1 rounded font-mono text-xs\",children:\"admin / admin123\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Agent: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-amber-200 px-2 py-1 rounded font-mono text-xs\",children:\"agent1 / agent123\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Staff: \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-amber-200 px-2 py-1 rounded font-mono text-xs\",children:\"staff1 / staff123\"})]})]})]}),/*#__PURE__*/_jsx(DSButton,{type:\"submit\",variant:\"primary\",size:\"mobile\",disabled:isLoading,className:\"h-10 sm:h-12 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold shadow-lg shadow-amber-500/25 border-0 transition-all duration-200\",icon:isLoading?/*#__PURE__*/_jsx(Loader2,{className:\"w-4 h-4 animate-spin\"}):undefined,children:isLoading?'Authenticating...':'Access Dashboard'})]})})})]})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}